(function(B){var O,ay="2.5.1",x=this,T=Math.round,Z,t=0,e=1,aM=2,s=3,ar=4,q=5,Q=6,au={},aG={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},ai=(typeof module!=="undefined"&&module.exports&&typeof require!=="undefined"),b=/^\/?Date\((\-?\d+)/i,aV=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,aA=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,al=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Y=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,f=/\d\d?/,aa=/\d{1,3}/,C=/\d{1,4}/,a2=/[+\-]?\d{1,6}/,aR=/\d+/,G=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,n=/Z|[\+\-]\d\d:?\d\d/gi,j=/T/i,aJ=/[\+\-]?\d+(\.\d{1,3})?/,X=/\d/,o=/\d\d/,aU=/\d{3}/,aI=/\d{4}/,ae=/[+-]?\d{6}/,V=/[+-]?\d+/,aE=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,R="YYYY-MM-DDTHH:mm:ssZ",aT=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],E=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],W=/([\+\-]|\d\d)/gi,aB="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),A={Milliseconds:1,Seconds:1000,Minutes:60000,Hours:3600000,Days:86400000,Months:2592000000,Years:31536000000},c={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},aQ={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},ah={},aL="DDD w W M D d".split(" "),aj="M D H h m s w W".split(" "),aN={M:function(){return this.month()+1},MMM:function(a4){return this.lang().monthsShort(this,a4)},MMMM:function(a4){return this.lang().months(this,a4)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a4){return this.lang().weekdaysMin(this,a4)},ddd:function(a4){return this.lang().weekdaysShort(this,a4)},dddd:function(a4){return this.lang().weekdays(this,a4)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return H(this.year()%100,2)},YYYY:function(){return H(this.year(),4)},YYYYY:function(){return H(this.year(),5)},YYYYYY:function(){var a5=this.year(),a4=a5>=0?"+":"-";return a4+H(Math.abs(a5),6)},gg:function(){return H(this.weekYear()%100,2)},gggg:function(){return H(this.weekYear(),4)},ggggg:function(){return H(this.weekYear(),5)},GG:function(){return H(this.isoWeekYear()%100,2)},GGGG:function(){return H(this.isoWeekYear(),4)},GGGGG:function(){return H(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),true)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),false)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return J(this.milliseconds()/100)},SS:function(){return H(J(this.milliseconds()/10),2)},SSS:function(){return H(this.milliseconds(),3)},SSSS:function(){return H(this.milliseconds(),3)},Z:function(){var a5=-this.zone(),a4="+";if(a5<0){a5=-a5;a4="-"}return a4+H(J(a5/60),2)+":"+H(J(a5)%60,2)},ZZ:function(){var a5=-this.zone(),a4="+";if(a5<0){a5=-a5;a4="-"}return a4+H(J(a5/60),2)+H(J(a5)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},S=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];function ac(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false}}function L(a5,a4){return function(a6){return H(a5.call(this,a6),a4)}}function g(a4,a5){return function(a6){return this.lang().ordinal(a4.call(this,a6),a5)}}while(aL.length){Z=aL.pop();aN[Z+"o"]=g(aN[Z],Z)}while(aj.length){Z=aj.pop();aN[Z+Z]=L(aN[Z],2)}aN.DDDD=L(aN.DDD,3);function aC(){}function I(a4){aZ(a4);aw(this,a4)}function ab(a7){var ba=l(a7),a9=ba.year||0,a5=ba.month||0,a4=ba.week||0,bd=ba.day||0,bb=ba.hour||0,a8=ba.minute||0,bc=ba.second||0,a6=ba.millisecond||0;this._milliseconds=+a6+bc*1000+a8*60000+bb*3600000;this._days=+bd+a4*7;this._months=+a5+a9*12;this._data={};this._bubble()}function aw(a5,a4){for(var a6 in a4){if(a4.hasOwnProperty(a6)){a5[a6]=a4[a6]}}if(a4.hasOwnProperty("toString")){a5.toString=a4.toString}if(a4.hasOwnProperty("valueOf")){a5.valueOf=a4.valueOf}return a5}function a1(a5){var a4={},a6;for(a6 in a5){if(a5.hasOwnProperty(a6)&&aG.hasOwnProperty(a6)){a4[a6]=a5[a6]}}return a4}function k(a4){if(a4<0){return Math.ceil(a4)}else{return Math.floor(a4)}}function H(a8,a7,a6){var a5=""+Math.abs(a8),a4=a8>=0;while(a5.length<a7){a5="0"+a5}return(a4?(a6?"+":""):"-")+a5}function D(a7,a6,ba,a9){var a5=a6._milliseconds,bc=a6._days,a4=a6._months,a8,bb;if(a5){a7._d.setTime(+a7._d+a5*ba)}if(bc||a4){a8=a7.minute();bb=a7.hour()}if(bc){a7.date(a7.date()+bc*ba)}if(a4){a7.month(a7.month()+a4*ba)}if(a5&&!a9){O.updateOffset(a7)}if(bc||a4){a7.minute(a8);a7.hour(bb)}}function a(a4){return Object.prototype.toString.call(a4)==="[object Array]"}function d(a4){return Object.prototype.toString.call(a4)==="[object Date]"||a4 instanceof Date}function aK(a9,a8,a5){var a4=Math.min(a9.length,a8.length),a6=Math.abs(a9.length-a8.length),ba=0,a7;for(a7=0;a7<a4;a7++){if((a5&&a9[a7]!==a8[a7])||(!a5&&J(a9[a7])!==J(a8[a7]))){ba++}}return ba+a6}function aP(a5){if(a5){var a4=a5.toLowerCase().replace(/(.)s$/,"$1");a5=c[a5]||aQ[a4]||a4}return a5}function l(a6){var a5={},a4,a7;for(a7 in a6){if(a6.hasOwnProperty(a7)){a4=aP(a7);if(a4){a5[a4]=a6[a7]}}}return a5}function ao(a5){var a4,a6;if(a5.indexOf("week")===0){a4=7;a6="day"}else{if(a5.indexOf("month")===0){a4=12;a6="month"}else{return}}O[a5]=function(bb,a8){var ba,a7,bc=O.fn._lang[a5],a9=[];if(typeof bb==="number"){a8=bb;bb=B}a7=function(be){var bd=O().utc().set(a6,be);return bc.call(O.fn._lang,bd,bb||"")};if(a8!=null){return a7(a8)}else{for(ba=0;ba<a4;ba++){a9.push(a7(ba))}return a9}}}function J(a4){var a6=+a4,a5=0;if(a6!==0&&isFinite(a6)){if(a6>=0){a5=Math.floor(a6)}else{a5=Math.ceil(a6)}}return a5}function aX(a4,a5){return new Date(Date.UTC(a4,a5+1,0)).getUTCDate()}function aS(a4){return aF(a4)?366:365}function aF(a4){return(a4%4===0&&a4%100!==0)||a4%400===0}function aZ(a4){var a5;if(a4._a&&a4._pf.overflow===-2){a5=a4._a[e]<0||a4._a[e]>11?e:a4._a[aM]<1||a4._a[aM]>aX(a4._a[t],a4._a[e])?aM:a4._a[s]<0||a4._a[s]>23?s:a4._a[ar]<0||a4._a[ar]>59?ar:a4._a[q]<0||a4._a[q]>59?q:a4._a[Q]<0||a4._a[Q]>999?Q:-1;if(a4._pf._overflowDayOfYear&&(a5<t||a5>aM)){a5=aM}a4._pf.overflow=a5}}function ax(a4){if(a4._isValid==null){a4._isValid=!isNaN(a4._d.getTime())&&a4._pf.overflow<0&&!a4._pf.empty&&!a4._pf.invalidMonth&&!a4._pf.nullInput&&!a4._pf.invalidFormat&&!a4._pf.userInvalidated;if(a4._strict){a4._isValid=a4._isValid&&a4._pf.charsLeftOver===0&&a4._pf.unusedTokens.length===0}}return a4._isValid}function z(a4){return a4?a4.toLowerCase().replace("_","-"):a4}function u(a4,a5){return a5._isUTC?O(a4).zone(a5._offset||0):O(a4).local()}aw(aC.prototype,{set:function(a4){var a6,a5;for(a5 in a4){a6=a4[a5];if(typeof a6==="function"){this[a5]=a6}else{this["_"+a5]=a6}}},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(a4){return this._months[a4.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(a4){return this._monthsShort[a4.month()]},monthsParse:function(a4){var a5,a7,a6;if(!this._monthsParse){this._monthsParse=[]}for(a5=0;a5<12;a5++){if(!this._monthsParse[a5]){a7=O.utc([2000,a5]);a6="^"+this.months(a7,"")+"|^"+this.monthsShort(a7,"");this._monthsParse[a5]=new RegExp(a6.replace(".",""),"i")}if(this._monthsParse[a5].test(a4)){return a5}}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(a4){return this._weekdays[a4.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(a4){return this._weekdaysShort[a4.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(a4){return this._weekdaysMin[a4.day()]},weekdaysParse:function(a7){var a4,a6,a5;if(!this._weekdaysParse){this._weekdaysParse=[]}for(a4=0;a4<7;a4++){if(!this._weekdaysParse[a4]){a6=O([2000,1]).day(a4);a5="^"+this.weekdays(a6,"")+"|^"+this.weekdaysShort(a6,"")+"|^"+this.weekdaysMin(a6,"");this._weekdaysParse[a4]=new RegExp(a5.replace(".",""),"i")}if(this._weekdaysParse[a4].test(a7)){return a4}}},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(a5){var a4=this._longDateFormat[a5];if(!a4&&this._longDateFormat[a5.toUpperCase()]){a4=this._longDateFormat[a5.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a6){return a6.slice(1)});this._longDateFormat[a5]=a4}return a4},isPM:function(a4){return((a4+"").toLowerCase().charAt(0)==="p")},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(a4,a5,a6){if(a4>11){return a6?"pm":"PM"}else{return a6?"am":"AM"}},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(a5,a6){var a4=this._calendar[a5];return typeof a4==="function"?a4.apply(a6):a4},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a7,a6,a5,a8){var a4=this._relativeTime[a5];return(typeof a4==="function")?a4(a7,a6,a5,a8):a4.replace(/%d/i,a7)},pastFuture:function(a6,a4){var a5=this._relativeTime[a6>0?"future":"past"];return typeof a5==="function"?a5(a4):a5.replace(/%s/i,a4)},ordinal:function(a4){return this._ordinal.replace("%d",a4)},_ordinal:"%d",preparse:function(a4){return a4},postformat:function(a4){return a4},week:function(a4){return y(a4,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}});function ag(a5,a4){a4.abbr=a5;if(!au[a5]){au[a5]=new aC()}au[a5].set(a4);return au[a5]}function aW(a4){delete au[a4]}function av(a8){var a7=0,a5,ba,a9,a6,a4=function(bb){if(!au[bb]&&ai){try{require("./lang/"+bb)}catch(bc){}}return au[bb]};if(!a8){return O.fn._lang}if(!a(a8)){ba=a4(a8);if(ba){return ba}a8=[a8]}while(a7<a8.length){a6=z(a8[a7]).split("-");a5=a6.length;a9=z(a8[a7+1]);a9=a9?a9.split("-"):null;while(a5>0){ba=a4(a6.slice(0,a5).join("-"));if(ba){return ba}if(a9&&a9.length>=a5&&aK(a6,a9,true)>=a5-1){break}a5--}a7++}return O.fn._lang}function af(a4){if(a4.match(/\[[\s\S]/)){return a4.replace(/^\[|\]$/g,"")}return a4.replace(/\\/g,"")}function p(a6){var a7=a6.match(al),a4,a5;for(a4=0,a5=a7.length;a4<a5;a4++){if(aN[a7[a4]]){a7[a4]=aN[a7[a4]]}else{a7[a4]=af(a7[a4])}}return function(a9){var a8="";for(a4=0;a4<a5;a4++){a8+=a7[a4] instanceof Function?a7[a4].call(a9,a6):a7[a4]}return a8}}function ak(a4,a5){if(!a4.isValid()){return a4.lang().invalidDate()}a5=a3(a5,a4.lang());if(!ah[a5]){ah[a5]=p(a5)}return ah[a5](a4)}function a3(a6,a7){var a4=5;function a5(a8){return a7.longDateFormat(a8)||a8}Y.lastIndex=0;while(a4>=0&&Y.test(a6)){a6=a6.replace(Y,a5);Y.lastIndex=0;a4-=1}return a6}function an(a7,a6){var a5,a4=a6._strict;switch(a7){case"DDDD":return aU;case"YYYY":case"GGGG":case"gggg":return a4?aI:C;case"Y":case"G":case"g":return V;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return a4?ae:a2;case"S":if(a4){return X}case"SS":if(a4){return o}case"SSS":if(a4){return aU}case"DDD":return aa;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return G;case"a":case"A":return av(a6._l)._meridiemParse;case"X":return aJ;case"Z":case"ZZ":return n;case"T":return j;case"SSSS":return aR;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return a4?o:f;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return f;default:a5=new RegExp(a0(aq(a7.replace("\\","")),"i"));return a5}}function v(a5){a5=a5||"";var a4=(a5.match(n)||[]),a8=a4[a4.length-1]||[],a7=(a8+"").match(W)||["-",0,0],a6=+(a7[1]*60)+J(a7[2]);return a7[0]==="+"?-a6:a6}function ap(a8,a6,a7){var a5,a4=a7._a;switch(a8){case"M":case"MM":if(a6!=null){a4[e]=J(a6)-1}break;case"MMM":case"MMMM":a5=av(a7._l).monthsParse(a6);if(a5!=null){a4[e]=a5}else{a7._pf.invalidMonth=a6}break;case"D":case"DD":if(a6!=null){a4[aM]=J(a6)}break;case"DDD":case"DDDD":if(a6!=null){a7._dayOfYear=J(a6)}break;case"YY":a4[t]=J(a6)+(J(a6)>68?1900:2000);break;case"YYYY":case"YYYYY":case"YYYYYY":a4[t]=J(a6);break;case"a":case"A":a7._isPm=av(a7._l).isPM(a6);break;case"H":case"HH":case"h":case"hh":a4[s]=J(a6);break;case"m":case"mm":a4[ar]=J(a6);break;case"s":case"ss":a4[q]=J(a6);break;case"S":case"SS":case"SSS":case"SSSS":a4[Q]=J(("0."+a6)*1000);break;case"X":a7._d=new Date(parseFloat(a6)*1000);break;case"Z":case"ZZ":a7._useUTC=true;a7._tzm=v(a6);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":a8=a8.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":a8=a8.substr(0,2);if(a6){a7._w=a7._w||{};a7._w[a8]=a6}break}}function ad(a8){var ba,a9,bd=[],a6,bc,a5,be,bf,a7,bb,a4;if(a8._d){return}a6=m(a8);if(a8._w&&a8._a[aM]==null&&a8._a[e]==null){a5=function(bh){var bg=parseInt(bh,10);return bh?(bh.length<3?(bg>68?1900+bg:2000+bg):bg):(a8._a[t]==null?O().weekYear():a8._a[t])};be=a8._w;if(be.GG!=null||be.W!=null||be.E!=null){bf=r(a5(be.GG),be.W||1,be.E,4,1)}else{a7=av(a8._l);bb=be.d!=null?aY(be.d,a7):(be.e!=null?parseInt(be.e,10)+a7._week.dow:0);a4=parseInt(be.w,10)||1;if(be.d!=null&&bb<a7._week.dow){a4++}bf=r(a5(be.gg),a4,bb,a7._week.doy,a7._week.dow)}a8._a[t]=bf.year;a8._dayOfYear=bf.dayOfYear}if(a8._dayOfYear){bc=a8._a[t]==null?a6[t]:a8._a[t];if(a8._dayOfYear>aS(bc)){a8._pf._overflowDayOfYear=true}a9=F(bc,0,a8._dayOfYear);a8._a[e]=a9.getUTCMonth();a8._a[aM]=a9.getUTCDate()}for(ba=0;ba<3&&a8._a[ba]==null;++ba){a8._a[ba]=bd[ba]=a6[ba]}for(;ba<7;ba++){a8._a[ba]=bd[ba]=(a8._a[ba]==null)?(ba===2?1:0):a8._a[ba]}bd[s]+=J((a8._tzm||0)/60);bd[ar]+=J((a8._tzm||0)%60);a8._d=(a8._useUTC?F:am).apply(null,bd)}function az(a5){var a4;if(a5._d){return}a4=l(a5._i);a5._a=[a4.year,a4.month,a4.day,a4.hour,a4.minute,a4.second,a4.millisecond];ad(a5)}function m(a5){var a4=new Date();if(a5._useUTC){return[a4.getUTCFullYear(),a4.getUTCMonth(),a4.getUTCDate()]}else{return[a4.getFullYear(),a4.getMonth(),a4.getDate()]}}function N(a7){a7._a=[];a7._pf.empty=true;var a6=av(a7._l),ba=""+a7._i,a9,a5,bd,a8,bc,a4=ba.length,bb=0;bd=a3(a7._f,a6).match(al)||[];for(a9=0;a9<bd.length;a9++){a8=bd[a9];a5=(ba.match(an(a8,a7))||[])[0];if(a5){bc=ba.substr(0,ba.indexOf(a5));if(bc.length>0){a7._pf.unusedInput.push(bc)}ba=ba.slice(ba.indexOf(a5)+a5.length);bb+=a5.length}if(aN[a8]){if(a5){a7._pf.empty=false}else{a7._pf.unusedTokens.push(a8)}ap(a8,a5,a7)}else{if(a7._strict&&!a5){a7._pf.unusedTokens.push(a8)}}}a7._pf.charsLeftOver=a4-bb;if(ba.length>0){a7._pf.unusedInput.push(ba)}if(a7._isPm&&a7._a[s]<12){a7._a[s]+=12}if(a7._isPm===false&&a7._a[s]===12){a7._a[s]=0}ad(a7);aZ(a7)}function aq(a4){return a4.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a5,a9,a8,a7,a6){return a9||a8||a7||a6})}function a0(a4){return a4.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function aO(a4){var a8,a6,a7,a5,a9;if(a4._f.length===0){a4._pf.invalidFormat=true;a4._d=new Date(NaN);return}for(a5=0;a5<a4._f.length;a5++){a9=0;a8=aw({},a4);a8._pf=ac();a8._f=a4._f[a5];N(a8);if(!ax(a8)){continue}a9+=a8._pf.charsLeftOver;a9+=a8._pf.unusedTokens.length*10;a8._pf.score=a9;if(a7==null||a9<a7){a7=a9;a6=a8}}aw(a4,a6||a8)}function h(a7){var a8,a4,a6=a7._i,a5=aE.exec(a6);if(a5){a7._pf.iso=true;for(a8=0,a4=aT.length;a8<a4;a8++){if(aT[a8][1].exec(a6)){a7._f=aT[a8][0]+(a5[6]||" ");break}}for(a8=0,a4=E.length;a8<a4;a8++){if(E[a8][1].exec(a6)){a7._f+=E[a8][0];break}}if(a6.match(n)){a7._f+="Z"}N(a7)}else{a7._d=new Date(a6)}}function M(a6){var a5=a6._i,a4=b.exec(a5);if(a5===B){a6._d=new Date()}else{if(a4){a6._d=new Date(+a4[1])}else{if(typeof a5==="string"){h(a6)}else{if(a(a5)){a6._a=a5.slice(0);ad(a6)}else{if(d(a5)){a6._d=new Date(+a5)}else{if(typeof(a5)==="object"){az(a6)}else{a6._d=new Date(a5)}}}}}}}function am(bb,a4,a9,a8,ba,a7,a6){var a5=new Date(bb,a4,a9,a8,ba,a7,a6);if(bb<1970){a5.setFullYear(bb)}return a5}function F(a5){var a4=new Date(Date.UTC.apply(null,arguments));if(a5<1970){a4.setUTCFullYear(a5)}return a4}function aY(a4,a5){if(typeof a4==="string"){if(!isNaN(a4)){a4=parseInt(a4,10)}else{a4=a5.weekdaysParse(a4);if(typeof a4!=="number"){return null}}}return a4}function aD(a4,a6,a5,a7,a8){return a8.relativeTime(a6||1,!!a5,a4,a7)}function w(a6,a4,a5){var bb=T(Math.abs(a6)/1000),a7=T(bb/60),ba=T(a7/60),bc=T(ba/24),a8=T(bc/365),a9=bb<45&&["s",bb]||a7===1&&["m"]||a7<45&&["mm",a7]||ba===1&&["h"]||ba<22&&["hh",ba]||bc===1&&["d"]||bc<=25&&["dd",bc]||bc<=45&&["M"]||bc<345&&["MM",T(bc/30)]||a8===1&&["y"]||["yy",a8];a9[2]=a4;a9[3]=a6>0;a9[4]=a5;return aD.apply({},a9)}function y(a8,a6,a9){var a5=a9-a6,a4=a9-a8.day(),a7;if(a4>a5){a4-=7}if(a4<a5-7){a4+=7}a7=O(a8).add("d",a4);return{week:Math.ceil(a7.dayOfYear()/7),year:a7.year()}}function r(a8,a7,a9,bb,a4){var ba=F(a8,0,1).getUTCDay(),a6,a5;a9=a9!=null?a9:a4;a6=a4-ba+(ba>bb?7:0)-(ba<a4?7:0);a5=7*(a7-1)+(a9-a4)+a6+1;return{year:a5>0?a8:a8-1,dayOfYear:a5>0?a5:aS(a8-1)+a5}}function K(a5){var a4=a5._i,a6=a5._f;if(a4===null){return O.invalid({nullInput:true})}if(typeof a4==="string"){a5._i=a4=av().preparse(a4)}if(O.isMoment(a4)){a5=a1(a4);a5._d=new Date(+a4._d)}else{if(a6){if(a(a6)){aO(a5)}else{N(a5)}}else{M(a5)}}return new I(a5)}O=function(a5,a6,a7,a4){var a8;if(typeof(a7)==="boolean"){a4=a7;a7=B}a8={};a8._isAMomentObject=true;a8._i=a5;a8._f=a6;a8._l=a7;a8._strict=a4;a8._isUTC=false;a8._pf=ac();return K(a8)};O.utc=function(a5,a6,a7,a4){var a8;if(typeof(a7)==="boolean"){a4=a7;a7=B}a8={};a8._isAMomentObject=true;a8._useUTC=true;a8._isUTC=true;a8._l=a7;a8._i=a5;a8._f=a6;a8._strict=a4;a8._pf=ac();return K(a8).utc()};O.unix=function(a4){return O(a4*1000)};O.duration=function(a5,a9){var ba=a5,a8=null,a4,a7,a6;if(O.isDuration(a5)){ba={ms:a5._milliseconds,d:a5._days,M:a5._months}}else{if(typeof a5==="number"){ba={};if(a9){ba[a9]=a5}else{ba.milliseconds=a5}}else{if(!!(a8=aV.exec(a5))){a4=(a8[1]==="-")?-1:1;ba={y:0,d:J(a8[aM])*a4,h:J(a8[s])*a4,m:J(a8[ar])*a4,s:J(a8[q])*a4,ms:J(a8[Q])*a4}}else{if(!!(a8=aA.exec(a5))){a4=(a8[1]==="-")?-1:1;a6=function(bc){var bb=bc&&parseFloat(bc.replace(",","."));return(isNaN(bb)?0:bb)*a4};ba={y:a6(a8[2]),M:a6(a8[3]),d:a6(a8[4]),h:a6(a8[5]),m:a6(a8[6]),s:a6(a8[7]),w:a6(a8[8])}}}}}a7=new ab(ba);if(O.isDuration(a5)&&a5.hasOwnProperty("_lang")){a7._lang=a5._lang}return a7};O.version=ay;O.defaultFormat=R;O.updateOffset=function(){};O.lang=function(a5,a4){var a6;if(!a5){return O.fn._lang._abbr}if(a4){ag(z(a5),a4)}else{if(a4===null){aW(a5);a5="en"}else{if(!au[a5]){av(a5)}}}a6=O.duration.fn._lang=O.fn._lang=av(a5);return a6._abbr};O.langData=function(a4){if(a4&&a4._lang&&a4._lang._abbr){a4=a4._lang._abbr}return av(a4)};O.isMoment=function(a4){return a4 instanceof I||(a4!=null&&a4.hasOwnProperty("_isAMomentObject"))};O.isDuration=function(a4){return a4 instanceof ab};for(Z=S.length-1;Z>=0;--Z){ao(S[Z])}O.normalizeUnits=function(a4){return aP(a4)};O.invalid=function(a5){var a4=O.utc(NaN);if(a5!=null){aw(a4._pf,a5)}else{a4._pf.userInvalidated=true}return a4};O.parseZone=function(a4){return O(a4).parseZone()};aw(O.fn=I.prototype,{clone:function(){return O(this)},valueOf:function(){return +this._d+((this._offset||0)*60000)},unix:function(){return Math.floor(+this/1000)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var a4=O(this).utc();if(0<a4.year()&&a4.year()<=9999){return ak(a4,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}else{return ak(a4,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}},toArray:function(){var a4=this;return[a4.year(),a4.month(),a4.date(),a4.hours(),a4.minutes(),a4.seconds(),a4.milliseconds()]},isValid:function(){return ax(this)},isDSTShifted:function(){if(this._a){return this.isValid()&&aK(this._a,(this._isUTC?O.utc(this._a):O(this._a)).toArray())>0}return false},parsingFlags:function(){return aw({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){this.zone(0);this._isUTC=false;return this},format:function(a5){var a4=ak(this,a5||O.defaultFormat);return this.lang().postformat(a4)},add:function(a4,a6){var a5;if(typeof a4==="string"){a5=O.duration(+a6,a4)}else{a5=O.duration(a4,a6)}D(this,a5,1);return this},subtract:function(a4,a6){var a5;if(typeof a4==="string"){a5=O.duration(+a6,a4)}else{a5=O.duration(a4,a6)}D(this,a5,-1);return this},diff:function(a8,a7,a4){var a9=u(a8,this),a5=(this.zone()-a9.zone())*60000,ba,a6;a7=aP(a7);if(a7==="year"||a7==="month"){ba=(this.daysInMonth()+a9.daysInMonth())*43200000;a6=((this.year()-a9.year())*12)+(this.month()-a9.month());a6+=((this-O(this).startOf("month"))-(a9-O(a9).startOf("month")))/ba;a6-=((this.zone()-O(this).startOf("month").zone())-(a9.zone()-O(a9).startOf("month").zone()))*60000/ba;if(a7==="year"){a6=a6/12}}else{ba=(this-a9);a6=a7==="second"?ba/1000:a7==="minute"?ba/60000:a7==="hour"?ba/3600000:a7==="day"?(ba-a5)/86400000:a7==="week"?(ba-a5)/604800000:ba}return a4?a6:k(a6)},from:function(a5,a4){return O.duration(this.diff(a5)).lang(this.lang()._abbr).humanize(!a4)},fromNow:function(a4){return this.from(O(),a4)},calendar:function(){var a4=u(O(),this).startOf("day"),a6=this.diff(a4,"days",true),a5=a6<-6?"sameElse":a6<-1?"lastWeek":a6<0?"lastDay":a6<1?"sameDay":a6<2?"nextDay":a6<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(a5,this))},isLeapYear:function(){return aF(this.year())},isDST:function(){return(this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone())},day:function(a5){var a4=this._isUTC?this._d.getUTCDay():this._d.getDay();if(a5!=null){a5=aY(a5,this.lang());return this.add({d:a5-a4})}else{return a4}},month:function(a4){var a5=this._isUTC?"UTC":"",a6;if(a4!=null){if(typeof a4==="string"){a4=this.lang().monthsParse(a4);if(typeof a4!=="number"){return this}}a6=this.date();this.date(1);this._d["set"+a5+"Month"](a4);this.date(Math.min(a6,this.daysInMonth()));O.updateOffset(this);return this}else{return this._d["get"+a5+"Month"]()}},startOf:function(a4){a4=aP(a4);switch(a4){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}if(a4==="week"){this.weekday(0)}else{if(a4==="isoWeek"){this.isoWeekday(1)}}return this},endOf:function(a4){a4=aP(a4);return this.startOf(a4).add((a4==="isoWeek"?"week":a4),1).subtract("ms",1)},isAfter:function(a5,a4){a4=typeof a4!=="undefined"?a4:"millisecond";return +this.clone().startOf(a4)>+O(a5).startOf(a4)},isBefore:function(a5,a4){a4=typeof a4!=="undefined"?a4:"millisecond";return +this.clone().startOf(a4)<+O(a5).startOf(a4)},isSame:function(a5,a4){a4=a4||"ms";return +this.clone().startOf(a4)===+u(a5,this).startOf(a4)},min:function(a4){a4=O.apply(null,arguments);return a4<this?this:a4},max:function(a4){a4=O.apply(null,arguments);return a4>this?this:a4},zone:function(a4){var a5=this._offset||0;if(a4!=null){if(typeof a4==="string"){a4=v(a4)}if(Math.abs(a4)<16){a4=a4*60}this._offset=a4;this._isUTC=true;if(a5!==a4){D(this,O.duration(a5-a4,"m"),1,true)}}else{return this._isUTC?a5:this._d.getTimezoneOffset()}return this},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){if(this._tzm){this.zone(this._tzm)}else{if(typeof this._i==="string"){this.zone(this._i)}}return this},hasAlignedHourOffset:function(a4){if(!a4){a4=0}else{a4=O(a4).zone()}return(this.zone()-a4)%60===0},daysInMonth:function(){return aX(this.year(),this.month())},dayOfYear:function(a4){var a5=T((O(this).startOf("day")-O(this).startOf("year"))/86400000)+1;return a4==null?a5:this.add("d",(a4-a5))},quarter:function(){return Math.ceil((this.month()+1)/3)},weekYear:function(a4){var a5=y(this,this.lang()._week.dow,this.lang()._week.doy).year;return a4==null?a5:this.add("y",(a4-a5))},isoWeekYear:function(a4){var a5=y(this,1,4).year;return a4==null?a5:this.add("y",(a4-a5))},week:function(a4){var a5=this.lang().week(this);return a4==null?a5:this.add("d",(a4-a5)*7)},isoWeek:function(a4){var a5=y(this,1,4).week;return a4==null?a5:this.add("d",(a4-a5)*7)},weekday:function(a4){var a5=(this.day()+7-this.lang()._week.dow)%7;return a4==null?a5:this.add("d",a4-a5)},isoWeekday:function(a4){return a4==null?this.day()||7:this.day(this.day()%7?a4:a4-7)},get:function(a4){a4=aP(a4);return this[a4]()},set:function(a4,a5){a4=aP(a4);if(typeof this[a4]==="function"){this[a4](a5)}return this},lang:function(a4){if(a4===B){return this._lang}else{this._lang=av(a4);return this}}});function aH(a4,a5){O.fn[a4]=O.fn[a4+"s"]=function(a6){var a7=this._isUTC?"UTC":"";if(a6!=null){this._d["set"+a7+a5](a6);O.updateOffset(this);return this}else{return this._d["get"+a7+a5]()}}}for(Z=0;Z<aB.length;Z++){aH(aB[Z].toLowerCase().replace(/s$/,""),aB[Z])}aH("year","FullYear");O.fn.days=O.fn.day;O.fn.months=O.fn.month;O.fn.weeks=O.fn.week;O.fn.isoWeeks=O.fn.isoWeek;O.fn.toJSON=O.fn.toISOString;aw(O.duration.fn=ab.prototype,{_bubble:function(){var a6=this._milliseconds,bb=this._days,a4=this._months,a9=this._data,ba,a8,a5,a7;a9.milliseconds=a6%1000;ba=k(a6/1000);a9.seconds=ba%60;a8=k(ba/60);a9.minutes=a8%60;a5=k(a8/60);a9.hours=a5%24;bb+=k(a5/24);a9.days=bb%30;a4+=k(bb/30);a9.months=a4%12;a7=k(a4/12);a9.years=a7},weeks:function(){return k(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*86400000+(this._months%12)*2592000000+J(this._months/12)*31536000000},humanize:function(a5){var a6=+this,a4=w(a6,!a5,this.lang());if(a5){a4=this.lang().pastFuture(a6,a4)}return this.lang().postformat(a4)},add:function(a4,a6){var a5=O.duration(a4,a6);this._milliseconds+=a5._milliseconds;this._days+=a5._days;this._months+=a5._months;this._bubble();return this},subtract:function(a4,a6){var a5=O.duration(a4,a6);this._milliseconds-=a5._milliseconds;this._days-=a5._days;this._months-=a5._months;this._bubble();return this},get:function(a4){a4=aP(a4);return this[a4.toLowerCase()+"s"]()},as:function(a4){a4=aP(a4);return this["as"+a4.charAt(0).toUpperCase()+a4.slice(1)+"s"]()},lang:O.fn.lang,toIsoString:function(){var a7=Math.abs(this.years()),a4=Math.abs(this.months()),a9=Math.abs(this.days()),a5=Math.abs(this.hours()),a6=Math.abs(this.minutes()),a8=Math.abs(this.seconds()+this.milliseconds()/1000);if(!this.asSeconds()){return"P0D"}return(this.asSeconds()<0?"-":"")+"P"+(a7?a7+"Y":"")+(a4?a4+"M":"")+(a9?a9+"D":"")+((a5||a6||a8)?"T":"")+(a5?a5+"H":"")+(a6?a6+"M":"")+(a8?a8+"S":"")}});function U(a4){O.duration.fn[a4]=function(){return this._data[a4]}}function at(a4,a5){O.duration.fn["as"+a4]=function(){return +this/a5}}for(Z in A){if(A.hasOwnProperty(Z)){at(Z,A[Z]);U(Z.toLowerCase())}}at("Weeks",604800000);O.duration.fn.asMonths=function(){return(+this-this.years()*31536000000)/2592000000+this.years()*12};O.lang("en",{ordinal:function(a6){var a4=a6%10,a5=(J(a6%100/10)===1)?"th":(a4===1)?"st":(a4===2)?"nd":(a4===3)?"rd":"th";return a6+a5}});function P(a5){var a4=false,a6=O;if(typeof ender!=="undefined"){return}if(a5){x.moment=function(){if(!a4&&console&&console.warn){a4=true;console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")}return a6.apply(null,arguments)};aw(x.moment,a6)}else{x.moment=O}}if(ai){module.exports=O;P(true)}else{if(typeof define==="function"&&define.amd){define("moment",function(a5,a4,a6){if(a6.config&&a6.config()&&a6.config().noGlobal!==true){P(a6.config().noGlobal===B)}return O})}else{P()}}}).call(this);(function(a){if(typeof define==="function"&&define.amd){define(["moment"],a)}else{if(typeof exports==="object"){module.exports=a(require("../moment"))}else{a(window.moment)}}}(function(e){function c(j,h){var g=j.split("_");return h%10===1&&h%100!==11?g[0]:(h%10>=2&&h%10<=4&&(h%100<10||h%100>=20)?g[1]:g[2])}function f(j,h,g){var k={mm:"минута_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"};if(g==="m"){return h?"минута":"минуту"}else{return j+" "+c(k[g],+j)}}function d(h,k){var g={nominative:"январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),accusative:"января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_")},j=(/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/).test(k)?"accusative":"nominative";return g[j][h.month()]}function b(g,k){var j={nominative:"янв_фев_мар_апр_май_июнь_июль_авг_сен_окт_ноя_дек".split("_"),accusative:"янв_фев_мар_апр_мая_июня_июля_авг_сен_окт_ноя_дек".split("_")},h=(/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/).test(k)?"accusative":"nominative";return j[h][g.month()]}function a(g,k){var h={nominative:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),accusative:"воскресенье_понедельник_вторник_среду_четверг_пятницу_субботу".split("_")},j=(/\[ ?[Вв] ?(?:прошлую|следующую)? ?\] ?dddd/).test(k)?"accusative":"nominative";return h[j][g.day()]}return e.lang("ru",{months:d,monthsShort:b,weekdays:a,weekdaysShort:"вс_пн_вт_ср_чт_пт_сб".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),monthsParse:[/^янв/i,/^фев/i,/^мар/i,/^апр/i,/^ма[й|я]/i,/^июн/i,/^июл/i,/^авг/i,/^сен/i,/^окт/i,/^ноя/i,/^дек/i],longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., LT",LLLL:"dddd, D MMMM YYYY г., LT"},calendar:{sameDay:"[Сегодня в] LT",nextDay:"[Завтра в] LT",lastDay:"[Вчера в] LT",nextWeek:function(){return this.day()===2?"[Во] dddd [в] LT":"[В] dddd [в] LT"},lastWeek:function(){switch(this.day()){case 0:return"[В прошлое] dddd [в] LT";case 1:case 2:case 4:return"[В прошлый] dddd [в] LT";case 3:case 5:case 6:return"[В прошлую] dddd [в] LT"}},sameElse:"L"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:f,mm:f,h:"час",hh:f,d:"день",dd:f,M:"месяц",MM:f,y:"год",yy:f},meridiem:function(g,j,h){if(g<4){return"ночи"}else{if(g<12){return"утра"}else{if(g<17){return"дня"}else{return"вечера"}}}},ordinal:function(g,h){switch(h){case"M":case"d":case"DDD":return g+"-й";case"D":return g+"-го";case"w":case"W":return g+"-я";default:return g}},week:{dow:1,doy:7}})}));var uAdmin=(function(){var onLoadEventHandlers={};function uAdmin(){if(uAdmin.prototype.instance==null){uAdmin.prototype.instance=new uAdmin.prototype.get()}register(arguments);return uAdmin.prototype.instance}function register(){var checkClass=function(parent,parent_str){for(var module in parent.reg){if(parent.reg[parent_str]){return parent.reg[parent_str]}else{return checkClass(parent.reg[module],parent_str)}}return false};var name;var value;var parent;var params=arguments[0];if(!params.length){return false}if(typeof params[0]==="object"){if(Object.prototype.toString.call(params[0])==="[object Array]"){return false}for(var i in params[0]){register([i,params[0][i],params[1]||null])}return true}else{if(typeof params[0]==="string"){if(typeof params[1]==="undefined"){return false}name=params[0];value=params[1];parent=params[2]||null}else{return false}}if(!parent){parent=uAdmin}if(typeof parent==="string"){parent=checkClass(uAdmin,parent)}if(typeof parent!=="function"){return false}var isClass=false;name=name.split(".");if(name.length>1){isClass=true}name=name.pop();var reg=function(){parent.reg[name]=value;if(isClass){parent.reg[name].isclass=true}};if(!parent.reg){parent.reg=reg}reg();return true}uAdmin.prototype.get=function(){return this};uAdmin.prototype.get.prototype=uAdmin.prototype;uAdmin.prototype.init=function(){uAdmin.load(uAdmin);delete uAdmin.reg;if(uAdmin.csrf){jQuery(document).ajaxSend(function(event,jqXhr,settings){if(settings.data instanceof FormData){settings.data.append("csrf",uAdmin.csrf);return}if(!settings||!settings.type||(typeof settings.data!=="string"&&typeof settings.data!=="undefined")){return true}switch(settings.type){case"POST":if(typeof settings.data=="undefined"){settings.data=""}settings.data+=settings.data.length?"&csrf="+uAdmin.csrf:"csrf="+uAdmin.csrf;break;case"GET":settings.url+=~settings.url.indexOf("?")?"&csrf="+uAdmin.csrf:"?csrf="+uAdmin.csrf;break}})}var images=document.getElementsByTagName("img");for(var i=0;i<images.length;i++){if(images[i].getAttribute("umi:field-name")=="photo"){if(!!images[i].width){images[i].style.maxWidth=images[i].width+"px"}if(!!images[i].height){images[i].style.maxHeight=images[i].height+"px"}}}};if(typeof JSON=="undefined"){JSON={parse:function(str){try{if(str.match(/^{/g)){var val=eval("("+str+")");if(Object.prototype.toString.call(val)=="[object Object]"){return val}}throw new SyntaxError("JSON.parse: unexpected end of data")}catch(e){throw new SyntaxError("JSON.parse: unexpected end of data")}}}}uAdmin.onLoad=function(module,handler){if(typeof handler!=="function"){return false}if(module in onLoadEventHandlers===false){onLoadEventHandlers[module]=[]}onLoadEventHandlers[module].push(handler);return handler in onLoadEventHandlers[module]};uAdmin.load=function(parent){for(var module in parent.reg){if(parent.reg[module].reg){uAdmin.load(parent.reg[module])}if(parent.reg[module].isclass){var extend=function(usedClass,extendClass){for(var i in extendClass){usedClass.prototype[i]=extendClass[i]}return new usedClass()};if(parent==uAdmin){parent[module]=new parent.reg[module](extend)}else{parent.prototype[module]=new parent.reg[module](extend)}}else{if(parent==uAdmin){parent[module]=parent.reg[module]}else{parent.prototype[module]=parent.reg[module]}}var moduleOnLoadEventHandlers=onLoadEventHandlers[module];if(moduleOnLoadEventHandlers!=undefined&&moduleOnLoadEventHandlers.length>0){for(var j=0;j<moduleOnLoadEventHandlers.length;j++){if(typeof moduleOnLoadEventHandlers[j]==="function"){moduleOnLoadEventHandlers[j]()}}}}};var pageData;if(window.pageData){pageData=window.pageData}else{var data=jQuery.ajax({url:location.pathname+".json"+location.search,dataType:"json",async:false});pageData=JSON.parse(data.responseText)}uAdmin("data",pageData);return uAdmin})();jQuery(document).ready(function(){uAdmin().init()});uAdmin(".panel",function(b){function a(){var c=this;$("html").addClass("u-eip");this.panelHolder=this.addPanelHolder();this.quickpanel=this.addQuickpanel();this.showHideBtn=this.addShowHideBtn();this.drawControls();$(document).bind("click",function(f){if(!$(f.target).parents("#u-quickpanel").length){c.changeAct()}});if(!$.cookie("eip-panel-state-first")){this.quickpanel.css({overflow:"hidden",height:"0"});this.showHideBtn.addClass("collapse");this.quickpanel.delay(500).animate({height:"38px"},500,function(){$(this).css("overflow","visible");c.showHideBtn.removeClass("collapse")});this.quickpanel.fadeTo(300,0.3);this.quickpanel.fadeTo(300,1);$.cookie("eip-panel-state","",{path:"/",expires:0});var e=new Date();e.setTime(e.getTime()+(30*24*60*60*1000));$.cookie("eip-panel-state-first","Y",{path:"/",expires:e})}var d=c.getUrlPrefix()+"/admin/content/frontendPanel/.json?links";d+="&ts="+Math.round(Math.random()*1000);$.ajax({url:d,dataType:"json",success:this.onLoadData})}a.prototype.getUrlPrefix=function(){return uAdmin.lang_prefix?"/"+uAdmin.lang_prefix:""};a.prototype.drawControls=function(){this.exitButton=this.addExitButton();this.helpButton=this.addHelpButton();this.butterfly=this.addButtrfly();this.eipHolder=this.addEipHolder();this.editMenu=this.addEditMenu();this.lastDoc=this.addLastDoc();this.changelogDd=this.addChangelogDd();this.note=this.addNote();this.metaHolder=this.addMetaHolder()};a.prototype.addPanelHolder=function(){return $('<div id="u-panel-holder" />').appendTo("body")};a.prototype.addQuickpanel=function(){if(!this.panelHolder.length){return null}return $('<div id="u-quickpanel" />').appendTo(this.panelHolder)};a.prototype.addShowHideBtn=function(){if(!this.panelHolder.length){return null}var c=this;return $('<div id="u-show_hide_btn" />').appendTo(this.panelHolder).click(function(){c.swap(this)})};a.prototype.addExitButton=function(){if(!this.quickpanel.length){return null}var c=this;return $('\n			<div id="exit" title="'+getLabel("js-panel-exit")+'">&#160;</div>\n		').appendTo(this.quickpanel).click(function(){window.location=c.getUrlPrefix()+"/users/logout/";return false})};a.prototype.addHelpButton=function(){if(!this.quickpanel.length){return null}return $('\n			<div id="help" title="'+getLabel("js-panel-documentation")+'">&#160;</div>\n		').appendTo(this.quickpanel).click(function(){window.open("http://help.docs.umi-cms.ru");return false})};a.prototype.addButtrfly=function(){if(!this.quickpanel.length){return null}return $('\n			<div id="butterfly">\n				<span class="in_ico_bg">&#160;</span>'+getLabel("js-panel-modules")+'\n				<div class="bg">\n					<ul id="u-mods-cont-left" />\n					<ul id="u-mods-cont-right" />\n					<div class="clear separate" />\n					<ul id="u-mods-utils" />\n					<ul id="u-mods-admin" />\n					<div class="clear" />\n				</div>\n			</div>\n		').appendTo(this.quickpanel)};a.prototype.addEipHolder=function(){if(!this.quickpanel.length){return null}return $("<div />").attr({id:"eip_holder"}).appendTo(this.quickpanel)};a.prototype.addMetaHolder=function(){if(!this.quickpanel.length){return null}return $("<div />").attr({id:"meta_holder"}).appendTo(this.quickpanel)};a.prototype.addEditMenu=function(){if(!this.quickpanel.length){return null}return $('\n			<div id="edit_menu" title="'+getLabel("js-panel-edit-menu")+'">\n				<span class="in_ico_bg">&#160;</span>\n				<div>\n					<ul id="u-docs-edit"/>\n					<span class="clear" />\n				</div>\n			</div>\n		').appendTo(this.quickpanel)};a.prototype.addLastDoc=function(){if(!this.quickpanel.length){return null}var c=this;return $('\n			<div id="last_doc">\n				<span class="in_ico_bg" />\n				'+getLabel("js-panel-last-documents")+'\n				<div>\n					<ul id="u-docs-recent" />\n					<span class="clear" />\n				</div>\n			</div>\n		').appendTo(this.quickpanel).click(function(){c.changeAct(this)})};a.prototype.addChangelogDd=function(){if(!this.quickpanel.length){return null}var c=this;return $('\n			<div id="changelog_dd" style="display:none;">\n				<span class="in_ico_bg">&#160;</span>\n				'+getLabel("js-panel-history-changes")+'\n				<div>\n					<ul id="u-changelog" />\n					<span class="clear" />\n				</div>\n			</div>\n		').appendTo(this.quickpanel).click(function(){c.changeAct(this)})};a.prototype.addNote=function(){if(!this.quickpanel.length){return null}return $('\n			<div id="note">\n				<span class="in_ico_bg">&#160;</span>\n				'+getLabel("js-panel-note")+"\n			</div>\n		").appendTo(this.quickpanel)};a.prototype.addSeoButton=function(){if(!this.quickpanel.length){return null}var c=this;return $('\n			<div id="seo">				<span class="in_ico_bg">&#160;</span>\n				'+getLabel("module-seo")+"\n			</div>\n		").appendTo(this.quickpanel).click(function(){window.location=c.getUrlPrefix()+"/admin/seo/"})};a.prototype.onLoadData=function(e){var l=uAdmin.panel;if(!l){return false}$('<link type="text/css" rel="stylesheet" href="/styles/skins/_eip/css/theme.css" />').appendTo("head");var g,c;for(g in e.documents.recent.page){g=e.documents.recent.page[g];$("ul#u-docs-recent",l.lastDoc).append('<li><a href="'+g.link+'">'+g.name+"</a></li>")}var f=0;for(g in e.documents.editable.page){g=e.documents.editable.page[g];if(typeof g!=="object"){continue}for(c in e.modules.module){c=e.modules.module[c];if(c.name==g.basetype.module){continue}}$("ul#u-docs-edit",l.quickpanel||null).append('<li><a href="'+l.getUrlPrefix()+g["edit-link"]+'">'+g.name+"</a></li>");f++}if(f&&l.editMenu){l.editMenu.click(function(){l.changeAct(this)})}else{if(l.editMenu){l.editMenu.hide(0)}}f=0;for(c in e.modules.module){c=e.modules.module[c];var d;switch(c.type){case"system":d="ul#u-mods-utils";break;case"util":d="ul#u-mods-admin";break;default:d=(++f%2)?"ul#u-mods-cont-left":"ul#u-mods-cont-right"}$(d,l.butterfly||null).append('<li><a href="'+l.getUrlPrefix()+"/admin/"+c.name+'/">'+c.label+"</a></li>")}if(f&&l.butterfly){l.butterfly.click(function(){l.changeAct(this)}).addClass("butterfly_hover")}if(typeof e.changelog!="undefined"&&l.changelogDd){for(var j in e.changelog.revision){j=e.changelog.revision[j];var k=j.date.std+(j.author.name?" - "+j.author.name:"")+(j.active=="active"?"&nbsp;&nbsp;&nbsp;&larr;":"");var h=j.link+"?force-redirect="+window.location.pathname;$("#u-changelog",l.changelogDd).append('<li><a href="'+h+'">'+k+"</a></li>")}l.changelogDd.css("display","")}else{if(l.changelogDd){l.changelogDd.css("display","none")}}if(typeof e.tickets!="undefined"&&typeof uAdmin.tickets=="object"){uAdmin.tickets.draw(e)}else{if(l.note){l.note.remove()}}};a.prototype.swap=function(d){var c=$("#u-quickpanel").css("height");if(c=="0px"){return this.expand(d)}else{if(uAdmin.eip.meta.enabled){$("#u-quickpanel #meta").trigger("click")}return this.collapse(d)}};a.prototype.expand=function(d){var c=$("#u-quickpanel");c.css("overflow","visible");c.animate({height:"38px"},700);$(d).removeClass("collapse");$.cookie("eip-panel-state","",{path:"/",expires:0})};a.prototype.collapse=function(e){var d=$("#u-quickpanel");d.css("overflow","hidden");d.animate({height:"0"},700);$(e).addClass("collapse");var c=new Date();c.setTime(c.getTime()+(30*24*60*60*1000));$.cookie("eip-panel-state","collapsed",{path:"/",expires:c})};a.prototype.loadRes=function(c,e,f){var d;switch(c){case"js":case"text/javascript":d=document.createElement("script");d.src=e;d.charset="utf-8";break;case"css":case"text/css":d=document.createElement("link");d.href=e;d.rel="stylesheet";break;default:return}document.body.parentNode.firstChild.appendChild(d);if(typeof f=="function"){$(document).one("ready",f)}};a.prototype.changeAct=function(f){var d=(uAdmin.eip&&uAdmin.eip.enabled)?"[id != 'edit'][id != 'ieditor-switcher']":"",c=$("#save_edit");if(!f){$("#u-quickpanel .act div:first").hide();$("#u-quickpanel .act"+d).removeClass("act")}else{if($(f).hasClass("act")){$("#u-quickpanel .act div:first").hide();$("#u-quickpanel .act"+d).removeClass("act");if(f.id=="edit"){c.css("display","none")}}else{var e=$("#u-quickpanel .act"),g=false;if(e.length){$("#u-quickpanel .act div:first").hide();$("#u-quickpanel .act"+d).removeClass("act");if(f.id=="edit"&&!d){c.css("display","none")}}if($.browser.opera){g=$(f).width()}$(f).addClass("act");if(g){$(f).width(g)}$("#u-quickpanel .act div:first").show();if(f.id=="edit"){c.css("display","block")}}}if($(f).attr("id")!="meta"&&uAdmin.eip&&uAdmin.eip.meta.enabled){$("#u-quickpanel #meta").addClass("act")}};a.prototype.editInAdmin=function(c){if(c=="enable"){$(document).bind("keypress",this.editInAdmin.bindEvents)}if(c=="disable"){$(document).unbind("keypress",this.editInAdmin.bindEvents)}};a.prototype.editInAdmin.bindEvents=function(c){if(c.shiftKey){switch(c.charCode||c.keyCode){case 68:case 100:case 1042:case 1074:$("#u-quickpanel #edit_menu").each(function(d,e){uAdmin.panel.changeAct(e)});break}}};return b(a,this)});uAdmin(".tickets",function(b){function a(){var d=100;this.defaultColor="#FFFFE1";this.colorProperty="ticketsColor";this.buttonSelector="#u-quickpanel #note, #quickpanel #note";var c=function(f){jQuery.jGrowl(f,{header:"UMI.CMS",life:5000})};var e=function(h){var f=this;f.params=h;(function g(){if(h.message){f.createMessage()}f.update()})()};e.prototype.rollbackParams=function(){if(this.params.oldWidth){this.params.width=this.params.oldWidth}if(this.params.oldHeight){this.params.height=this.params.oldHeight}if(this.params.oldX){this.params.x=this.params.oldX}if(this.params.oldY){this.params.y=this.params.oldY}if(this.params.oldMessage){this.params.message.text=this.params.oldMessage}};e.prototype.resetSelection=function(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var f=window.getSelection();if(f&&f.removeAllRanges){f.removeAllRanges()}}}};e.prototype.createMessage=function(){var f=this;f.messageNode=jQuery('<div class="u-ticket-comment"><div /><textarea /><a /></div>').appendTo("body");f.messageNode.css("background-color",f.params.message.color);f.messageNode.draggable({scroll:false,containment:document.body,stop:function(g,h){f.params.oldX=f.params.x;f.params.oldY=f.params.y;f.params.x=h.position.left;f.params.y=h.position.top;f.save()}});if(f.params.message){jQuery("div",f.messageNode).html("<span>"+f.params.message.authorName+" ("+f.params.message.authorLogin+")</span>");jQuery("textarea",f.messageNode).prop("value",f.params.message.text)}f.messageNode.resizable({minWidth:jQuery("div:first-child span",f.messageNode).outerWidth(),minHeight:d,containment:document.body,start:function(){jQuery(f.messageNode).css("cursor","default")},stop:function(g,h){f.params.oldWidth=f.params.width;f.params.oldHeight=f.params.height;f.params.width=h.size.width;f.params.height=h.size.height;f.save();jQuery(f.messageNode).css("cursor","move")}});jQuery("a",f.messageNode).html(getLabel("js-ticket-delete"));jQuery("textarea",f.messageNode).bind("change",function(){f.save()});jQuery("textarea",f.messageNode).bind("focus",function(){f.params.oldMessage=jQuery(this).prop("value")});jQuery("a",f.messageNode).bind("click",function(){f.del()})};e.prototype.del=function(){var f=this;if(f.params.id){var g="/tickets/manage/delete/"+f.params.id+"/";jQuery.ajax({url:g,dataType:"json",type:"get",success:function(j){if(j&&typeof j.error=="string"){c(j.error);return}h(f.node,f.messageNode)}})}else{h(f.node,f.messageNode)}function h(k,j){if(k&&typeof k.remove=="function"){k.remove()}if(j&&typeof j.remove=="function"){j.remove()}}};e.prototype.save=function(){var f=this;var h=f.params.id?"modify":"create";var g="/tickets/manage/"+h+"/"+f.params.id+"/";g+="?ts="+Math.round(Math.random()*1000);jQuery.ajax({type:"POST",url:g,dataType:"json",data:{x:f.params.x,y:f.params.y,width:f.params.width,height:f.params.height,message:jQuery("textarea",f.messageNode).prop("value"),color:f.params.message.color||uAdmin.tickets.defaultColor,referer:window.location.href.split("#")[0]},success:function(j){if(j&&typeof j.error=="string"){c(j.error);f.rollbackParams();f.update();return}f.params.id=j.id}})};e.prototype.update=function(){var f=this;f.params.width=f.params.width||f.messageNode.outerWidth();f.params.height=f.params.height||f.messageNode.outerHeight();if(f.messageNode){jQuery("textarea",f.messageNode).prop("value",f.params.message.text);f.messageNode.css({top:parseInt(f.params.y),left:parseInt(f.params.x),width:f.params.width,height:f.params.height})}};this.ticket=e}a.prototype.initNewTicket=function(){this.changeState(jQuery(this.buttonSelector).get(0));if(!uAdmin.tickets.created){alert(getLabel("js-panel-note-add"));uAdmin.tickets.created=true}if(uAdmin.tickets.isInit){return false}uAdmin.tickets.isInit=true;var d=this;var e=uAdmin.tickets.user.fname;var c=(uAdmin.tickets.user.lname==null)?"":" "+uAdmin.tickets.user.lname;jQuery(document).one("mousedown",function(f){new uAdmin.tickets.ticket({x:f.pageX,y:f.pageY,message:{authorName:e+c,authorLogin:uAdmin.tickets.user.login,color:uAdmin.tickets.user[d.colorProperty],text:getLabel("js-ticket-empty")}});uAdmin.tickets.isInit=false;d.changeState(jQuery(d.buttonSelector).get(0))})};a.prototype.changeState=function(e){var d=jQuery(e);if(typeof uAdmin.panel=="object"){uAdmin.panel.changeAct(e)}else{if(jQuery("#quickpanel").length>0){var c="act";if(d.hasClass(c)){d.removeClass(c)}else{d.addClass(c)}}}};a.prototype.swapVisible=function(){this.disabled?this.enable():this.disable()};a.prototype.disable=function(){var c=this;jQuery("div.u-ticket, div.u-ticket-comment, "+c.buttonSelector).hide();jQuery(document).unbind("keydown",c.bindEvents);jQuery(c.buttonSelector).unbind("click",c.bindEvents);c.disabled=true};a.prototype.enable=function(){var c=this;jQuery("div.u-ticket, div.u-ticket-comment, "+c.buttonSelector).show();jQuery(document).bind("keydown",c.bindEvents);jQuery(c.buttonSelector).bind("click",c.bindEvents);c.disabled=false};a.prototype.bindEvents=function(c){if(c.delegateTarget!==document){c.preventDefault()}if((c.shiftKey&&(c.keyCode==67||c.keyCode==99)&&(c.target.nodeName!="INPUT"&&c.target.nodeName!="TEXTAREA"))||(c.type=="click"&&document.getElementById("note").id=="note")){uAdmin.tickets.initNewTicket()}};a.prototype.draw=function(j){var d=this;uAdmin.tickets.user=j.user;for(var f in j.tickets.ticket){f=j.tickets.ticket[f];var k=f.position,h=f.author;var g=h.fname;var c=(h.lname==null)?"":" "+h.lname;var e=new this.ticket({id:f.id,x:k.x,y:k.y,width:k.width,height:k.height,message:{authorName:g+c,authorLogin:h.login,color:h[d.colorProperty]||d.defaultColor,text:f.message}});e.update()}};a.prototype.disabled=true;a.prototype.isInit=false;return b(a,this)});uAdmin(".eip",function(b){function a(){this.isMac=(navigator.userAgent.indexOf("Mac OS")!=-1);this.drawControls();if(uAdmin.data&&uAdmin.data.pageId){this.metaInit()}else{uAdmin.onLoad("data",function(){uAdmin.eip.metaInit()})}this.bindEditorEvents();if(!uAdmin.tickets&&uAdmin.panel){uAdmin.onLoad("tickets",this.activateByCookie)}else{if(uAdmin.tickets&&!uAdmin.panel){uAdmin.onLoad("panel",this.activateByCookie)}else{uAdmin.onLoad("eip",this.activateByCookie)}}this.init();this.bindGlobalEvents()}a.prototype.init=function(){this.deleteButtonsTimeout=null;this.initEditBoxes()};a.prototype.initEditBoxes=function(){var c=this;jQuery(document).on("mouseover",".u-eip-edit-box",function(){c.editBoxMouseoverHandler(this)});jQuery(document).on("mouseout",".u-eip-edit-box-hover",function(){c.editBoxMouseoutHandler(this)})};a.prototype.editBoxMouseoverHandler=function(d){var c=this,e=jQuery(d).addClass("u-eip-edit-box-hover"),f=c.searchAttr(d);if(e.attr("umi:delete")&&f.id){c.addDeleteButton(d,f)}else{c.dropDeleteButtons()}d.onclick=function(g){d.onclick=function(){return true};if(window.event){return window.event.ctrlKey}else{return g.ctrlKey}}};a.prototype.editBoxMouseoutHandler=function(d){var e=jQuery(d).removeClass("u-eip-edit-box-hover"),c=this;if(e.attr("umi:delete")){c.deleteButtonsTimeout=setTimeout(c.dropDeleteButtons,500)}e.click(function(){return true})};a.prototype.addDeleteButton=function(d,e){var c=this;if(this.deleteButtonsTimeout){clearTimeout(this.deleteButtonsTimeout)}this.dropDeleteButtons();var f=document.createElement("div");jQuery(f).attr("class","eip-del-button");document.body.appendChild(f);c.placeWith(d,f,"right","middle");jQuery(f).bind("mouseover",function(){if(c.deleteButtonsTimeout){clearTimeout(c.deleteButtonsTimeout)}}).bind("mouseout",function(){c.deleteButtonsTimeout=setTimeout(c.dropDeleteButtons,500)}).bind("click",function(){e["delete"]=true;c.queue.add(e);uAdmin.eip.normalizeBoxes()});return f};a.prototype.dropDeleteButtons=function(){jQuery(".eip-del-button").remove()};a.prototype.bindGlobalEvents=function(){this.bindKeyboardShortcut();window.onresize=function(){uAdmin.eip.normalizeBoxes()}};a.prototype.bindKeyboardShortcut=function(){jQuery(document).bind("keydown",function(c){if(c.keyCode==113){uAdmin.eip.swapEditor()}})};a.prototype.activateByCookie=function(){if(jQuery.cookie("eip-editor-state")){uAdmin.eip.swapEditor()}else{uAdmin.tickets.enable();uAdmin.panel.editInAdmin("enable")}};a.prototype.drawControls=function(){this.editorToggleButton=this.addEditorToggleButton();this.editorControlsHolder=this.addEditorControlsHolder();this.saveButton=this.addSaveButton();this.undoButton=this.addUndoButton();this.redoButton=this.addRedoButton()};a.prototype.addEditorControlsHolder=function(){return jQuery('\n			<div id="save_edit"></div>\n		').appendTo(uAdmin.panel.eipHolder)};a.prototype.addSaveButton=function(){var c=this;if(!this.editorControlsHolder){return null}return jQuery('\n			<div id="save" title="'+getLabel("js-panel-save")+" ("+(this.isMac?"Cmd":"Ctrl")+'+S)">&#160;</div>\n		').appendTo(this.editorControlsHolder).click(function(){c.queue.save();return false})};a.prototype.addUndoButton=function(){var c=this;if(!this.editorControlsHolder){return null}return jQuery('\n			<div id="edit_back" title="'+getLabel("js-panel-cancel")+" ("+(this.isMac?"Cmd":"Ctrl")+'+Z)">&#160;</div>\n		').appendTo(this.editorControlsHolder).click(function(){c.queue.back();return false})};a.prototype.addRedoButton=function(){var c=this;if(!this.editorControlsHolder){return null}return jQuery('\n			<div id="edit_next" title="'+getLabel("js-panel-repeat")+" ("+(this.isMac?"Cmd+Shift+Z":"Ctrl+Y")+')">&#160;</div>\n		').appendTo(this.editorControlsHolder).click(function(){c.queue.forward();return false})};a.prototype.addEditorToggleButton=function(){var c=this,d=jQuery('\n				<div id="edit">\n					<span class="in_ico_bg">&#160;</span>\n					<span class="edit-button-label"></span> (F2)				</div>\n			');d.appendTo(uAdmin.panel.eipHolder).click(function(){c.swapEditor();return false});d.setLabelText=function(e){if(e){d.find(".edit-button-label").text(e)}};d.setLabelText(getLabel("js-panel-edit"));return d};a.prototype.metaInit=function(){var c=this;this.meta.element_id=uAdmin.data.pageId;this.meta.old={alt_name:uAdmin.data.page["alt-name"]?uAdmin.data.page["alt-name"]:"",title:uAdmin.data.title?uAdmin.data.title:"",keywords:uAdmin.data.meta.keywords?uAdmin.data.meta.keywords:"",descriptions:uAdmin.data.meta.description?uAdmin.data.meta.description:""};this.meta["new"]={};this.metaToggleButton=this.addMetaToggleButton();this.metaPanel=this.addMetaPanel();this.metaSaveButton=this.getMetaSaveButton();this.metaPanel.find('input[type!="submit"]').bind("blur",function(f){var d=this.name.replace(/^meta_/g,"");c.meta["new"][d]=this.value}).bind("keyup mousedown blur",function(){var d=this.value.length;if(d>255){this.value=this.value.substring(0,255)}else{var e=this.id+"-count";jQuery("#"+e).html(d)}}).trigger("keyup")};a.prototype.addMetaToggleButton=function(){return jQuery('\n			<div id="meta">\n				<span class="in_ico_bg">&#160;</span>\n				'+getLabel("js-panel-meta")+"\n			</div>\n		").appendTo(uAdmin.panel.metaHolder).click(function(){uAdmin.panel.changeAct(this);uAdmin.eip.metaPanel.toggle();uAdmin.eip.meta.enabled=uAdmin.eip.metaPanel.is(":visible");return false})};a.prototype.addMetaPanel=function(){if(!uAdmin.panel.panelHolder){return null}var c=this;return jQuery('\n				<div id="u-quickpanel-meta">\n					<table>\n						<tr>\n							<td width="100px">'+getLabel("js-panel-meta-altname")+': </td>\n							<td>\n								<input type="text" name="alt_name" id="u-quickpanel-metaaltname" value="'+c.meta.old.alt_name+'"/>\n								<div class="meta_count" id="u-quickpanel-metaaltname-count"/>\n							</td>\n						</tr>\n						<tr>\n							<td width="100px">'+getLabel("js-panel-meta-title")+': </td>\n							<td>\n								<input type="text" name="title" id="u-quickpanel-metatitle" value="'+c.meta.old.title+'"/>\n								<div class="meta_count" id="u-quickpanel-metatitle-count"/>\n							</td>\n						</tr>\n						<tr>\n							<td>'+getLabel("js-panel-meta-keywords")+': </td>\n							<td>\n								<input type="text" name="meta_keywords" id="u-quickpanel-metakeywords" value="'+c.meta.old.keywords+'"/>\n								<div class="meta_count" id="u-quickpanel-metakeywords-count"/>\n								<div class="meta_buttons"><a href="/admin/seo/" style="color:white;">'+getLabel("js-panel-meta-analysis")+"</a></div>\n							</td>\n						</tr>\n						<tr>\n							<td>"+getLabel("js-panel-meta-descriptions")+':</td>\n							<td>\n								<input type="text" name="meta_descriptions" id="u-quickpanel-metadescription" value="'+c.meta.old.descriptions+'"/>\n								<div class="meta_count" id="u-quickpanel-metadescription-count"/>\n								<div class="meta_buttons">\n									<input type="submit" id="save_meta_button" value="'+getLabel("js-panel-save")+'">\n								</div>\n							</td>\n						</tr>\n					</table>\n				</div>\n			').appendTo(uAdmin.panel.panelHolder)};a.prototype.getMetaSaveButton=function(){if(!this.metaPanel){return null}var c=this;return this.metaPanel.find("#save_meta_button").click(function(){c.metaSave();return false})};a.prototype.metaSave=function(){var g={},d,c=this,f=0,e=0;for(d in c.meta["new"]){if(c.meta["new"][d]!=c.meta.old[d]){g["field-name"]=((d=="keywords"||d=="descriptions")?"meta_"+d:d);g["element-id"]=c.meta.element_id;g.value=c.meta["new"][d];f++;jQuery.post("/admin/content/editValue/save.json",g,function(h){if(h.error){c.message(h.error);return}e++;if(e==f){c.message(getLabel("js-panel-message-changes-saved"));uAdmin.eip.metaToggleButton.click()}},"json")}delete c.meta["new"][d]}};a.prototype.bindEditorEvents=function(){this.bind("Enable",this.enableEventHandler);this.bind("Disable",this.disableEventHandler);this.bind("Repaint",this.repaintEventHandler);this.bind("Save",this.saveEventHandler)};a.prototype.enableEventHandler=function(c){if(c=="after"){uAdmin.panel.changeAct(uAdmin.eip.editorToggleButton.get(0))}};a.prototype.disableEventHandler=function(c){if(c=="after"){uAdmin.panel.changeAct(uAdmin.eip.editorToggleButton.get(0))}};a.prototype.repaintEventHandler=function(c){};a.prototype.saveEventHandler=function(c){};a.prototype.swapEditor=function(){if(this.enabled){this.disable();this.editorToggleButton.setLabelText(getLabel("js-panel-edit"));jQuery("#on_edit_in_place").html(getLabel("js-on-eip"));uAdmin.tickets.enable();uAdmin.panel.editInAdmin("enable")}else{this.enable();this.editorToggleButton.setLabelText(getLabel("js-panel-view"));jQuery("#on_edit_in_place").html(getLabel("js-off-eip"));uAdmin.tickets.disable();uAdmin.panel.editInAdmin("disable")}this.bindEvents()};a.prototype.enable=function(){var c=this;c.onEnable("before");c.finishLast();c.inspectDocument();c.highlight();c.normalizeBoxes();jQuery(window).on("load",function(){setTimeout(function(){c.normalizeBoxes()},250)});c.enabled=true;if(c.queue.current>=0){c.queue.setSaveStatus(true)}var d=new Date();d.setTime(d.getTime()+(3*24*60*60*1000));jQuery.cookie("eip-editor-state","enabled",{path:"/",expires:d});c.message(getLabel("js-panel-message-edit-on"));jQuery(document).bind("keydown",c.bindHotkeys);c.onEnable("after")};a.prototype.disable=function(){this.onDisable("before");this.finishLast();this.unhighlight();this.enabled=false;jQuery.cookie("eip-editor-state","",{path:"/",expires:0});this.queue.setSaveStatus(false);this.message(getLabel("js-panel-message-edit-off"));if(this.queue.current>=0){jQuery.openPopupLayer({name:"save",width:200,height:200,data:'\n            						<div class="eip_win_head popupHeader">\n            							<div class="eip_win_close popupClose">&#160;</div>\n            								<div class="eip_win_body popupBody">\n            							<div class="popupText">'+getLabel("js-panel-message-save-confirm",self.save.count)+'</div>\n            							<div class="eip_buttons">\n            								<input type="button" class            								="primary ok" id="saveProgressBtn" value="OK" />\n            								<input type="button" id="closeProgressBtn"class            								="primary back" id="" value="Отмена"/>\n            								<div style="clear: both;" />\n            							</div>\n            						</div>\n            					'});jQuery("#saveProgressBtn").click(function(){jQuery.closePopupLayer("save");uAdmin.eip.queue.save()});jQuery("#closeProgressBtn").click(function(){jQuery.closePopupLayer("save")})}jQuery(document).unbind("keydown",this.bindHotkeys);this.onDisable("after")};a.prototype.bind=function(d,g){var c=this,e=(typeof c["on"+d]=="function")?c["on"+d]:function(){};c["on"+d]=function(h,f){e(h,f);g(h,f)}};a.prototype.trigger=function(e,d,c){if(typeof this["on"+e]=="function"){this["on"+e](d,c)}};a.prototype.bindHotkeys=function(d){var c=uAdmin.eip.queue;if(navigator.userAgent.indexOf("Mac OS")!=-1){if(d.metaKey){switch(d.keyCode){case 83:c.save();break;case 90:if(d.shiftKey){c.forward()}else{c.back()}break;default:return true}return false}}else{if(d.ctrlKey){switch(d.keyCode){case 83:c.save();break;case 90:c.back();break;case 89:c.forward();break;default:return true}return false}}return true};a.prototype.finishLast=function(){if(this.previousEditBox){this.previousEditBox.finish(true);this.previousEditBox=null}};a.prototype.normalizeBoxes=function(){var c=this;jQuery(c.listNodes).each(function(h,l){if(!l.boxNode){return}var f=c.nodePositionInfo(l);jQuery(l.boxNode).css({width:f.width,height:f.height,left:f.x,top:f.y});var j=l.addButtonNode;var k="bottom",e="left";if(j){var g;if((g=jQuery(l).attr("umi:button-position"))){var d=g.split(/ /);if(d.length==2){k=d[0];e=d[1]}}c.placeWith(l,j,k,e)}});c.onRepaint("after")};a.prototype.bindEvents=function(){var d=this,c=jQuery(".u-eip-edit-box");jQuery(document).off("click drop dragexit dragover",".u-eip-edit-box");c.unbind("click");c.unbind("drop");c.unbind("dragexit");c.unbind("dragover");var e="click";if(navigator.userAgent.toLowerCase().indexOf("firefox")||navigator.userAgent.toLowerCase().indexOf("chrome")){e=e+" drop";jQuery(document).on("dragexit",".u-eip-edit-box",function(f){f.stopPropagation();f.preventDefault()});jQuery(document).on("dragover",".u-eip-edit-box",function(f){f.stopPropagation();f.preventDefault()})}jQuery(document).on(e,".u-eip-edit-box",function(j){var h=j.target;if(j.ctrlKey||(navigator.userAgent.indexOf("Mac OS")!=-1&&j.metaKey)){if(this.tagName=="A"){location.href=this.href}return true}var g=(typeof h.onclick=="function")?h.onclick:function(){};var k=function(){return false};h.onclick=k;setTimeout(function(){if(h&&g!=k){h.onclick=g}},100);for(var f=0;f<25;f++){if(!h){return false}if(h.tagName!="TABLE"&&jQuery(h).attr("umi:field-name")){break}h=h.parentNode}if(!h){return false}j.stopPropagation();j.stopImmediatePropagation();j.preventDefault();d.edit(h,j&&j.originalEvent&&j.originalEvent.dataTransfer?j.originalEvent.dataTransfer.files:null);j.stopPropagation();j.stopImmediatePropagation();j.preventDefault();return false});window.onbeforeunload=function(){if(uAdmin.eip.queue.current>=0||uAdmin.eip.queue.save.count>0){return getLabel("js-panel-message-save-before-exit")}}};a.prototype.inspectDocument=function(){var c=this;c.editNodes=[];c.listNodes=[];var d=c.getRegions();d.each(function(e,f){if(jQuery(f).css("display")=="none"){return}c.inspectNode(f)})};a.prototype.inspectNode=function(c){if(c.tagName=="TABLE"){return}if(jQuery(c).attr("umi:field-name")){this.editNodes.push(c)}if(jQuery(c).attr("umi:module")){this.listNodes.push(c)}if(jQuery.browser.msie){jQuery(c).parents("a:first").each(function(){var d=this.href;jQuery(this).click(function(f){if(f.ctrlKey){window.location.href=d}});this.removeAttribute("href")})}};a.prototype.getRegions=function(){return jQuery("*[umi\\:field-name], *[umi\\:module]")};a.prototype.isParentOf=function(d,c){if(!c||!d){return false}if(c==d){return true}if(d.parentNode){return this.isParentOf(d.parentNode,c)}return false};a.prototype.highlight=function(d,c){var e=this;if(e.highlighted){e.unhighlight()}e.highlighted=true;jQuery(e.editNodes).each(function(f,g){if(e.isParentOf(g,d)==false){e.highlightNode(g)}});if(!c){jQuery(e.listNodes).each(function(f,g){if(e.isParentOf(g,d)==false){e.highlightListNode(g)}})}e.onRepaint("after");e.markInversedBoxes()};a.prototype.unhighlight=function(){var c=jQuery(".u-eip-edit-box");c.each(function(d,e){e=jQuery(e);var f=e.attr("umi:empty");if(f&&(e.attr("tagName")!="IMG")&&(e.html()==f)){e.html("")}e.attr("title","")});c.removeClass("u-eip-edit-box u-eip-edit-box-hover u-eip-modified u-eip-deleted u-eip-edit-box-inversed");c.unbind("click");c.unbind("mouseover");c.unbind("mouseout");c.unbind("mousedown");c.unbind("mouseup");jQuery(".u-eip-add-box, .u-eip-add-button, .u-eip-del-button").remove();jQuery(".u-eip-sortable").sortable("destroy");jQuery(".u-eip-sortable").removeClass("u-eip-sortable")};a.prototype.highlightNode=function(d){if(!jQuery(d).attr("umi:field-name")){return}var h=this.searchAttr(d);if(!h){return}var f=this.htmlTrim(jQuery(d).attr("umi:empty"));if(f&&this.htmlTrim(jQuery(d).html())==""&&(jQuery(d).attr("tagName")!="IMG")){try{jQuery(d).html(f)}catch(g){}jQuery(d).addClass("u-eip-empty-field")}jQuery(d).addClass("u-eip-edit-box");if(this.queue.search(h)){jQuery(d).addClass("u-eip-modified")}if(d.tagName=="A"||d.parentNode.tagName=="A"||jQuery("a",d).length>0){var c=getLabel("js-panel-link-to-go");if(navigator.userAgent.indexOf("Mac OS")!=-1){c=c.replace(/Ctrl/g,"Cmd")}jQuery(d).attr("title",c);jQuery(d).bind("dblclick",function(){return false})}else{jQuery(d).attr("title","")}this.markInversedBoxes(jQuery(d))};a.prototype.searchAttr=function(d,h,c){if(!d){return false}var f;c=c||20;if(d.tagName=="BODY"||d.tagName=="TABLE"){return false}if(!this.searchAttr.info.node&&jQuery(d).attr("umi:field-name")){this.searchAttr.info.node=d;var g=jQuery(d).attr("umi:field-name");if(!g&&typeof h!="function"){this.message("You should specify umi:field-name attribute");return false}if(!this.searchAttr.info.field_name){this.searchAttr.info.field_name=g}}var e=jQuery(d);if(typeof h!="function"||h(d)){if(e.attr("umi:element-id")){this.searchAttr.info.id=e.attr("umi:element-id");this.searchAttr.info.type="element";f=this.searchAttr.info;this.searchAttr.info={};return f}else{if(e.attr("umi:object-id")){this.searchAttr.info.id=e.attr("umi:object-id");this.searchAttr.info.type="object";f=this.searchAttr.info;this.searchAttr.info={};return f}}}if(d.parentNode){return this.searchAttr(d.parentNode,h,--c)}this.message("You should specify umi:element-id or umi:object attribute");return false};a.prototype.searchAttr.info={};a.prototype.searchRow=function(d,c){if(c){if(d.tagName=="BODY"||d.tagName=="TABLE"){return false}if(jQuery(d.parentNode).attr("umi:region")){return d.parentNode}else{return this.searchRow(d.parentNode,true)}}else{return jQuery("*[umi\\:region]",d).filter(function(){var e='[umi\\:element-id^="new"], [umi\\:object-id^="new"]';return !jQuery(this).find(e).length&&!jQuery(this).is(e)}).get(0)}};a.prototype.searchRowId=function(d){var c=jQuery(d).attr("umi:element-id");return c||(jQuery("*[umi\\:element-id]",d).length?jQuery("*[umi\\:element-id]",d).get(0).attr("umi:element-id"):null)};a.prototype.inlineAddPage=function(p){var n=this,f=n.searchRow(p);if(!f){n.message("Error, umi:region=row is not defined");return false}p=jQuery(p);var q={element:p.attr("umi:element-id"),object:p.attr("umi:object-id")},j=p.attr("umi:type-id");var g=false;jQuery(".u-eip-deleted").each(function(w,x){if(n.searchAttr(x).id==(q.element||q.object)){g=true;return}});if(g){n.message(getLabel("js-panel-message-cant-add"));return false}if(!j&&q.element){if(q.element.match(/^new/g)){var k=n.queue.search({id:q.element});j=k.type_id}else{var v=jQuery.ajax({url:"/admin/content/getTypeAdding/"+q.element+"/.json",async:false,dataType:"json"});v=JSON.parse(v.responseText);j=v.result}}if(!j){n.message("Error, umi:type-id is not defined");return false}var u=(p.attr("umi:method")=="lastlist"||jQuery(p).attr("umi:add-prepend")=="prepend"),d=jQuery(f).clone(),h=(u)?d.prependTo(f.parentNode):d.appendTo(f.parentNode);h.removeClass("blank_item");var m=function(y){var x,w;if(jQuery(y).attr("umi:field-name")){return y}else{if(y.children){for(w=0;w<y.children.length;w++){x=m(y.children[w]);if(x){return x}}}}return false};d=m(h.get(0));if(!d){n.message("Error, umi:field-name is not defined");return false}var s=n.searchAttr(d);s.id="new_"+new Date().getTime();s.type_id=j;s.add=true;s.node=h.get(0);if(q.object){s.parent=q.object;s.type="object"}if(q.element){s.parent=q.element;s.type="element"}delete s.field_name;if(jQuery(f).attr("umi:"+s.type+"-id")==""){jQuery(f).remove();jQuery(h).attr("umi:"+s.type+"-id",s.id);jQuery("*",h).each(function(w,x){if(!x.children.length){x.style.display=""}})}var e=jQuery.ajax({url:"/admin/content/getTypeFields/"+j+"/.json",async:false,dataType:"json"});e=jQuery.parseJSON(e.responseText);var o=[];for(var r in e){if(parseInt(r)==r){o.push(e[r])}}o.push("name");var c=function(w){var y="umi:"+s.type+"-id";if(jQuery(w).attr("tagName")=="TABLE"){return}if(jQuery(w).attr("umi:field-name")){if(jQuery.inArray(jQuery(w).attr("umi:field-name"),o)==-1){return false}var x=jQuery(w).attr("umi:empty");if(jQuery(w).is("img")&&x){jQuery(w).attr("src",x)}else{jQuery(w).html(x?x:"")}jQuery(w).addClass("u-eip-empty-field");n.editNodes[n.editNodes.length]=w}if(jQuery(w).attr(y)){jQuery(w).attr("umi:clone-source-id",jQuery(w).attr(y));jQuery(w).attr(y,s.id)}};var l=jQuery('*[umi\\:region="row"]',h).get(0);jQuery('*[umi\\:region="row"]',h).remove();c(h);h.addClass("u-eip-newitem");var t=jQuery("*",h);t.each(function(w,x){n.inspectNode(x);n.highlightListNode(x);if(jQuery(x).attr("umi:region")){jQuery(x).html(l);jQuery("*",x).each(function(y,z){z=jQuery(z);if(!z.children().length){z.text("");z.css("display","none")}if(z.attr("href")){z.attr("href","")}if(z.attr("umi:"+s.type+"-id")){z.attr("umi:"+s.type+"-id","")}})}c(x)});n.queue.add(s);n.normalizeBoxes();return true};a.prototype.onSuccessAddNewPage=function(c){if(!c||c.forceReload){document.location.reload();return false}var d=jQuery("[umi\\:element-id="+c.parentId+"][umi\\:region=list]");if(!d.length){return false}var e=function(g,f){g.removeClass("current blank_item");if(g.is("[umi\\:url-attribute]")){g.attr(g.attr("umi:url-attribute"),f.url)}else{if(g.is("a")){g.attr("href",f.url)}}if(g.is("[umi\\:element-id]")){g.attr("umi:element-id",f.elementId)}if(g.is("[umi\\:field-name=name]")){g.text(f.title)}g.children().each(function(){e(jQuery(this),f)})};d.each(function(){var f=jQuery(this);var g=f.find("[umi\\:region=row]").first().clone();e(g,c);g.appendTo(f)});jQuery.closePopupLayer(null,{})};a.prototype.htmlTrim=function(c){c=jQuery.trim(c);return c.replace(/<br ?\/?>/g,"").replace(/(<p>)|(<\/p>)/g,"")};a.prototype.markInversedBoxes=function(c){setTimeout(function(){if(!c){c=jQuery(".u-eip-edit-box")}c.each(function(e,g){var d=new RGBColor(jQuery(g).css("color"));var f=d.toHash();var h=(f.red/255+f.green/255+f.blue/224)/3;if(h>=0.9){jQuery(g).addClass("u-eip-edit-box-inversed")}})},500)};a.prototype.highlightListNode=function(f){var d=this;if(!jQuery(f).attr("umi:module")){return false}var e=document.createElement("div");document.body.appendChild(e);f.boxNode=e;var c=d.nodePositionInfo(f);if(!c.x&&!c.y){return false}jQuery(e).attr("class","u-eip-add-box");jQuery(e).css({position:"absolute",width:c.width,height:c.height,left:c.x,top:c.y});if(jQuery(f).attr("umi:add-method")!="none"){this.addAddButton(f,e)}if(jQuery(f).attr("umi:sortable")=="sortable"){this.setNodeSortable(f,e)}return e};a.prototype.addAddButton=function(k,j){var g=document.createElement("a");k.addButtonNode=g;jQuery(g).attr({"class":"u-eip-add-button"}).html(getLabel("js-panel-add"));jQuery(g).hover(function(){jQuery(this).addClass("u-eip-add-button-hover")},function(){jQuery(this).removeClass("u-eip-add-button-hover")});var h="bottom";var d="left";var f;if(f=jQuery(k).attr("umi:button-position")){var c=f.split(/ /);if(c.length==2){h=c[0];d=c[1]}}this.placeWith(k,g,h,d);var e=this;jQuery(g).bind("mouseup",function(){e.onAddButtonMouseup(k)}).bind("mouseover",function(){e.onAddButtonMouseover(j)}).bind("mouseout",function(){e.onAddButtonMouseout(j)});document.body.appendChild(g)};a.prototype.onAddButtonMouseup=function(h){var o=this;var l=jQuery(h).attr("umi:region");var f=o.searchRow(h);var k=jQuery(h).attr("umi:element-id");var g=jQuery(h).attr("umi:module");var d=jQuery(h).attr("umi:method");var j=jQuery(h).attr("umi:add-method");var c=jQuery(h).attr("umi:type-id");if(f&&(l=="list")&&(j!="popup")){o.inlineAddPage(h)}else{if(o.queue.current>=0){o.message(getLabel("js-panel-message-save-first"));return}var e="/admin/content/eip_add_page/choose/"+parseInt(k)+"/"+g+"/"+d+"/",m=uAdmin.csrf?"?csrf="+uAdmin.csrf:"",n=c?"&type-id="+c:"";jQuery.ajax({url:e+".json"+m,dataType:"json",success:function(p){if(p.data.error){uAdmin.eip.message(p.data.error);return}jQuery.openPopupLayer({name:"CreatePage",title:getLabel("js-eip-create-page"),url:e+m+n})},error:function(){uAdmin.eip.message(getLabel("error-require-more-permissions"));return}})}};a.prototype.onAddButtonMouseover=function(c){jQuery(c).addClass("u-eip-add-box-hover")};a.prototype.onAddButtonMouseout=function(c){jQuery(c).removeClass("u-eip-add-box-hover")};a.prototype.setNodeSortable=function(c,f){var l=this;jQuery(c).addClass("u-eip-sortable");var d=null,k=null,j,e,h=false,g=[];jQuery("*").each(function(p,q){if(q.tagName=="TABLE"){return}if(jQuery(q).attr("umi:sortable")!="sortable"){return}var o=false;jQuery(q).parents().each(function(r,n){if(n==c){o=true}});if(o){return}var m=false;jQuery("*",q).each(function(r,n){if(n==c){m=true}});if(m){return}g.push(q)});jQuery(c).sortable({items:'> [umi\\:region="row"]',tolerance:"pointer",cursor:"move",dropOnEmpty:true,revert:true,forcePlaceholderSize:true,placeholder:"u-eip-sortable-placeholder",update:function(p,q){j=q.item[0];if(!jQuery(j).hasClass("u-eip-newitem")&&!(window.cloudController&&window.cloudController.onController)){var o=jQuery.ajax({url:"/admin/content/eip_move_page/"+jQuery(j).attr("umi:element-id")+"/.json?check",async:false,dataType:"json",type:"GET"});var n=jQuery.parseJSON(o.responseText);if(n.error){jQuery(c).sortable("cancel");uAdmin.eip.message(n.error);return false}}var m=j.nextSibling;do{if(!m){break}if(m.nodeType!=1){continue}if(l.searchRowId(m)){break}}while(m=m.nextSibling);d=m;k=j.parentNode;var r=l.searchAttr(j.parentNode,function(t){return jQuery(t).attr("umi:sortable")=="sortable"});var s=parseInt(r?r.id:null);r.node=j;r.move=true;r.moved=l.searchRowId(j);r.next=m;r.old_next=d;r.parent_id=s;r.parent=j.parentNode;r.old_parent=k;delete r.field_name;d=null;k=null;l.normalizeBoxes();l.queue.add(r)}})};a.prototype.nodePositionInfo=function(c){c=jQuery(c);return{width:c.innerWidth(),height:c.innerHeight(),x:c.offset().left,y:c.offset().top}};a.prototype.placeWith=function(c,d,n,h){if(!c||!d){return}var g=this.nodePositionInfo(c);var l=jQuery(d);var m,k;switch(n){case"top":k=g.y-parseInt(l.css("height"));break;case"right":m=g.x+g.width;break;case"left":m=g.x-l.width();break;default:k=g.y+g.height}if(n=="top"||n=="bottom"){switch(h){case"right":m=g.x+g.width-l.width();break;case"middle":case"center":if(g.width-parseInt(l.css("width"))>0){m=g.x+Math.ceil((g.width-l.width())/2)}else{m=g.x}break;default:m=g.x;m+=parseInt(jQuery(c).css("padding-left"))}}else{switch(h){case"top":k=g.y;break;case"bottom":k=g.y+g.height-parseInt(l.css("height"));break;default:if(g.height-parseInt(l.css("height"))>0){k=g.y+Math.ceil((g.height-parseInt(l.css("height")))/2)}else{k=g.y}}}var o=l.width()+m;var f=jQuery(window);if(o>f.width()){m=f.width()-l.width()-30}try{l.css({position:"absolute",left:m+"px",top:k+"px","z-index":560})}catch(j){}};a.prototype.applyStyles=function(f,h,c){var e=["font-size","font-family","font-name","margin-left","margin-right","margin-top","margin-bottom","font-weight"],d;f=jQuery(f);h=jQuery(h);for(d in e){var g=e[d];h.css(g,f.css(g))}if(c!==false){h.width(f.outerWidth());h.height(f.outerHeight())}};a.prototype.message=function(c){jQuery.jGrowl("<p>"+c+"</p>",{header:"UMI.CMS",life:10000})};a.prototype.edit=function(d,c){if(jQuery(d).hasClass("u-eip-deleted")||jQuery(d).parents().hasClass("u-eip-deleted")){this.message(getLabel("js-panel-message-cant-edit"));return false}this.finishLast();jQuery(".eip-del-button").remove();this.previousEditBox=this.editor.get(d,c);if(this.previousEditBox){jQuery(".u-eip-add-button, .u-eip-add-box").css("display","none")}jQuery(d).removeClass("u-eip-edit-box u-eip-edit-box-hover u-eip-modified u-eip-deleted u-eip-empty-field u-eip-edit-box-inversed");if(this.previousEditBox){jQuery(d).addClass("u-eip-editing")}var e=this.htmlTrim(jQuery(d).attr("umi:empty"));if(e&&this.htmlTrim(jQuery(d).html())==e){jQuery(d).html("&nbsp;");jQuery(d).removeClass("u-eip-empty-field")}return true};a.prototype.queue=[];a.prototype.queue.add=function(c){if(this.current==-1){this.setSaveStatus(true)}if(this.current<this.length-1){for(var d=this.length-1;d>this.current;d--){this.pop()}this.current=(this.length)}else{++this.current}this.push(c);this.step();if(c.add){uAdmin.eip.message(getLabel("js-panel-message-add-after-save"));jQuery(c.node).css("display","")}if(c.move){jQuery(c.node.parentNode).addClass("u-eip-modified")}if(c["delete"]){uAdmin.eip.message(getLabel("js-panel-message-delete-after-save"));jQuery(c.node).addClass("u-eip-deleted")}jQuery(c.node).addClass("u-eip-modified");return this.length};a.prototype.queue.get=function(c){if(!parseInt(c)){c=this.current}return this[c]||null};a.prototype.queue._saveStatus=false;a.prototype.queue.setSaveStatus=function(d){var c=uAdmin.eip;if(d){jQuery("#save").addClass("save_me");c.editorToggleButton.setLabelText(getLabel("js-panel-edit-save"))}else{jQuery("#save").removeClass("save_me");c.editorToggleButton.setLabelText(c.enabled?getLabel("js-panel-view"):getLabel("js-panel-edit"))}uAdmin.eip.queue._saveStatus=d};a.prototype.queue.getSaveStatus=function(c){return uAdmin.eip.queue._saveStatus};a.prototype.queue.search=function(c){var d=this.current;while(d>=0){if(this[d].id==c.id&&(this[d].field_name==c.field_name||(this[d].add&&c.add)||(this[d].move&&c.move)||(this[d]["delete"]&&c["delete"])||(this[d].custom&&c.custom))){return this[d]}--d}return false};a.prototype.queue.back=function(c){c=parseInt(c)||1;while(c--){if(this[this.current]){this.cancel()}}uAdmin.eip.normalizeBoxes();this.step()};a.prototype.queue.forward=function(c){c=parseInt(c)||1;while(c--){if(this[this.current+1]){this.apply()}}uAdmin.eip.normalizeBoxes();this.step()};a.prototype.queue.apply=function(){uAdmin.eip.finishLast();++this.current;var c=this.get();if(!c.add&&!c.move&&!c["delete"]&&!c.custom&&!uAdmin.eip.editor.replace(c,c.new_value,c.old_value)){--this.current}else{switch(true){case c.add:uAdmin.eip.message(getLabel("js-panel-message-add-after-save"));jQuery(c.node).css("display","");break;case c["delete"]:uAdmin.eip.message(getLabel("js-panel-message-delete-after-save"));jQuery(c.node).addClass("u-eip-deleted");break;case c.move:if(c.next){jQuery(c.node).insertBefore(c.next)}else{jQuery(c.node).appendTo(c.parent)}jQuery(c.node).addClass("u-eip-modified");jQuery(c.parent).addClass("u-eip-modified");break;case c.custom:if(c.target&&c.target.forward){c.target.forward()}break;default:jQuery(c.node).addClass("u-eip-modified")}}if(this.current==0){this.setSaveStatus(true)}};a.prototype.queue.cancel=function(){uAdmin.eip.finishLast();var d=this.get(),c=false;switch(true){case d.add:--this.current;jQuery(d.node).css("display","none");break;case d["delete"]:--this.current;jQuery(d.node).removeClass("u-eip-deleted");break;case d.move:--this.current;if(d.old_next){jQuery(d.node).insertBefore(d.old_next)}else{jQuery(d.node).appendTo(d.old_parent)}jQuery(d.node).removeClass("u-eip-modified");if(!this.search(d)){jQuery(d.parent).removeClass("u-eip-modified")}break;case d.custom:--this.current;if(d.target&&d.target.back){d.target.back()}break;default:c=uAdmin.eip.editor.replace(d,d.old_value,d.new_value);if(c){--this.current;jQuery(d.node).addClass("u-eip-modified")}}if(d.add||d.move||d["delete"]||d.custom||c){if(!this.search(d)){jQuery(d.node).removeClass("u-eip-modified")}if(this.current==-1){this.setSaveStatus(false);uAdmin.eip.message(getLabel("js-panel-message-changes-revert"))}}};a.prototype.queue.step=function(){jQuery("#u-quickpanel #save_edit #edit_back").attr("class",(this.current==-1)?"":"ac");jQuery("#u-quickpanel #save_edit #edit_next").attr("class",((this.length-this.current)==1)?"":"ac")};a.prototype.queue.save=function(j){uAdmin.eip.finishLast();if(this.current==-1&&!j){return false}var c=this,g=false,k={},d=jQuery("div.popupText span",c.progress);switch(j){case"add":for(e in c.save.add){g=c.save.add[e];delete c.save.add[e];break}if(g){for(e in c.save.added){if(g.parent==e){g.parent=c.save.added[e]}}var f="/admin/content/eip_quick_add/"+g.parent+".json?type-id="+g.type_id;if(jQuery(g.node).parent().attr("umi:module")!="data"){f+="&force-hierarchy=1"}jQuery.get(f,function(n){if(n.error){uAdmin.eip.message(n.error);return}var o=parseInt(n.data["element-id"]);var s=parseInt(n.data["object-id"]);c.save.added[g.id]=o||s;jQuery(g.node).removeClass("u-eip-newitem u-eip-modified");jQuery(g.node).attr("umi:"+g.type+"-id",o||s);jQuery("*[umi\\:"+g.type+'-id="'+g.id+'"]',g.node).attr("umi:"+g.type+"-id",o||s);var m=jQuery(g.node);var l=o||s;var p=g.parent;var q=m.parents("[umi\\:region=list]").first();var u=q.attr("umi:add-prepend")=="prepend";var t=function(x,w,v){v=!!v;if(x.attr("umi:element-id")){x.attr("umi:element-id",w.attr("umi:element-id")||l)}if(x.attr("umi:object-id")){x.attr("umi:object-id",w.attr("umi:object-id")||l)}if(x.is("img")){x.attr("src",w.attr("src"))}else{if(v&&x.is("a")){x.attr("href",w.attr("href"))}if(x.is("[umi\\:field-name]")){if(w.attr("umi:empty")){x.attr("umi:empty",w.attr("umi:empty"))}if(x.attr("umi:empty")){x.addClass("u-eip-empty-field")}else{x.removeClass("u-eip-empty-field")}x.text(w.text()||w.attr("umi:empty")||"")}}};var r=q.attr("umi:type-id");jQuery("[umi\\:"+g.type+"-id="+p+"][umi\\:region=list]").filter(function(){return jQuery(this).find("[umi\\:"+g.type+"-id="+l+"]").length==0}).filter(function(){var v=false,w=jQuery(this).attr("umi:type-id");if((!w&&!r)||w==r){v=true}return v}).each(function(){var v=jQuery(this),x=v.children("[umi\\:region=row]:first").clone().removeClass("blank_item current"),w=m.find("*").addBack().filter("[umi\\:url-attribute]").first();if(w.length){var z=w.attr("umi:url-attribute"),y=x.find("*").addBack();if(y.filter("[umi\\:url-attribute]").attr(z,w.attr(z)).length==0){y.filter("a").attr("href",w.attr(z))}t(x,m)}else{t(x,m,true)}m.find("[umi\\:field-name]").each(function(){var A=jQuery(this);var B=A.attr("umi:field-name");x.find("[umi\\:field-name="+B+"]").each(function(){t(jQuery(this),A)})});if(u){x.prependTo(v)}else{x.appendTo(v)}v.find("[umi\\:field-name]").each(function(){uAdmin.eip.highlightNode(this)})});g=false;uAdmin.eip.normalizeBoxes();d.text(parseInt(d.text())+1);--c.save.count;c.save("add")},"json")}else{c.save("move")}break;case"move":for(e in c.save.move){g=c.save.move[e];delete c.save.move[e];break}if(g){g.next=(g.next==null?"":uAdmin.eip.searchRowId(g.next));for(e in c.save.added){if(g.parent_id==e){g.parent_id=c.save.added[e]}if(g.moved==e){g.moved=c.save.added[e]}if(g.next==e){g.next=c.save.added[e]}}jQuery.post("/admin/content/eip_move_page/"+g.moved+"/"+g.next+".json",{"parent-id":g.parent_id},function(l){if(l.error){uAdmin.eip.message(l.error);return}jQuery(g.node).removeClass("u-eip-modified");jQuery(g.node).parent().removeClass("u-eip-modified");jQuery("[umi\\:region=list]").filter("[umi\\:element-id="+g.parent_id+"], [umi\\:object-id="+g.parent_id+"]").filter(function(){return this!=g.parent}).each(function(){var n=jQuery(g.node).index(),o=jQuery(this).find("[umi\\:region=row][umi\\:"+g.type+"-id="+g.moved+"]"),m=jQuery(this).children().eq(n);if(o.index()>n){o.insertBefore(m)}else{if(o.index()<n){o.insertAfter(m)}}});uAdmin.eip.normalizeBoxes();if(uAdmin.eip.enabled){uAdmin.eip.highlight(g.moved)}uAdmin.eip.message(getLabel("js-panel-message-page-moved"));--c.save.count;d.text(parseInt(d.text())+1);c.save("move")},"json")}else{c.save("edit")}break;case"edit":for(e in c.save.edit){g=c.save.edit[e];delete c.save.edit[e];break}if(g){for(e in c.save.added){if(g.id==e){g.id=c.save.added[e]}}if(uAdmin.eip.editor.equals(g.new_value,g.old_value)){jQuery(g.node).removeClass("u-eip-modified");g=false;uAdmin.eip.normalizeBoxes();d.text(parseInt(d.text())+1);--c.save.count;c.save("edit")}else{k={};k[g.type+"-id"]=g.id;k.qt=new Date().getTime();k["field-name"]=g.field_name;var h,e;switch(typeof g.new_value){case"object":if(g.new_value.src){h=g.new_value.src}else{h=[];for(e in g.new_value){h.push(e)}}break;case"string":if(jQuery.browser.mozilla&&g.new_value.match(/="\.\.\//g)){g.new_value=g.new_value.replace(/="[\.\.\/]+/g,'="/')}h=g.new_value.replace(/\sumi:[-a-z]+="[^"]*"/g,"");break;default:h=g.new_value}k.value=h;jQuery.post("/admin/content/editValue/save.json",k,function(p){if(p.error){uAdmin.eip.message(p.error);return}var n=p.property["new-link"],q=p.property["old-link"];var m=jQuery(g.node).parents("[umi\\:element-id], [umi\\:object-id]").first(),s=m.is("[umi\\:object-id]")?"object":"element",r=m.attr("umi:"+s+"-id"),l=jQuery("[umi\\:"+s+"-id="+r+"]");if(!l.length){l=jQuery(g.node).parent()}if(q&&n){var o=0;l.each(function(){jQuery(this).find("[umi\\:url-attribute]").each(function(){jQuery(this).attr(jQuery(this).attr("umi:url-attribute"),n).bind("click mousedown mouseup",function(){return true});o++})});if(!o){l.find("a").each(function(t,u){jQuery(this).attr("href",n).bind("click mousedown mouseup",function(){return true})})}}jQuery("[umi\\:"+g.type+"-id='"+g.id+"']").find("[umi\\:field-name="+p.property.name+"]").add("[umi\\:"+g.type+"-id='"+g.id+"'][umi\\:field-name="+p.property.name+"]").not("[umi\\:"+g.type+"-id][umi\\:"+g.type+"-id!='"+g.id+"']").each(function(){var t=jQuery(this);if(t.is("img")){var u=(p.property.value===null)?"":p.property.value["src"];t.attr("src",u)}else{t.html(g.node.innerHTML)}t.parents(".not_hidden").removeClass("not_hidden")});jQuery(g.node).removeClass("u-eip-modified");g=false;uAdmin.eip.normalizeBoxes();d.text(parseInt(d.text())+1);--c.save.count;c.save("edit")},"json")}}else{c.save("custom")}break;case"custom":for(e in c.save.custom){g=c.save.custom[e];delete c.save.custom[e];break}if(g){if(g.target&&g.target.save&&typeof g.target.save=="function"){g.target.save()}d.text(parseInt(d.text())+1);--c.save.count;c.save("custom")}else{c.save("del")}break;case"del":for(e in c.save.del){g=c.save.del[e];delete c.save.del[e];break}if(g){for(e in c.save.added){if(g.id==e){g.id=c.save.added[e]}}k={};k[g.type+"-id"]=g.id;k.qt=new Date().getTime();jQuery.post("/admin/content/eip_del_page.json",k,function(m){if(m.error){uAdmin.eip.message(m.error)}else{var l=uAdmin.eip.searchRow(g.node,true);if(l&&jQuery(l).attr("umi:region")!="list"){jQuery(l).remove()}else{jQuery(g.node).remove()}jQuery("[umi\\:element-id="+g.id+"], [umi\\:object-id="+g.id+"]").remove();uAdmin.eip.normalizeBoxes();g=false;uAdmin.eip.normalizeBoxes();d.text(parseInt(d.text())+1);--c.save.count;c.save("del")}},"json")}else{c.save.add={};c.save.added={};c.save.move={};c.save.edit={};c.save.del={};c.save.custom={};c.setSaveStatus(false);this.step();uAdmin.eip.message(getLabel("js-panel-message-changes-saved"));jQuery("input:button",c.progress).removeClass("hidden");uAdmin.eip.onSave("after")}break;default:uAdmin.eip.onSave("before");while(0<=this.current){if(c[0].add){c.save.add[c[0].id]=c[0];++c.save.count}else{if(this[0].move){if(c.save.move[c[0].moved]){delete c.save.move[c[0].moved];--c.save.count}c.save.move[c[0].moved]=c[0];++c.save.count}else{if(this[0]["delete"]){c.save.del[c[0].id]=c[0];++c.save.count}else{if(this[0]["custom"]){c.save.custom[c[0].id]=c[0];++c.save.count}else{if(c.save.edit[c[0].id+"_"+c[0].field_name]){c.save.edit[c[0].id+"_"+c[0].field_name].new_value=c[0].new_value}else{c.save.edit[c[0].id+"_"+c[0].field_name]=c[0];++c.save.count}}}}}c.shift();--c.current}c.progress=jQuery.openPopupLayer({name:"SaveProgress",width:400,height:200,data:'\n						<div class="eip_win_head popupHeader">\n							<div class="eip_win_close popupClose hidden">&#160;</div>\n							<div class="eip_win_title">'+getLabel("js-cms-eip-edit_in_place-save_processing")+'</div>\n						</div>\n						<div class="eip_win_body popupBody">\n							<div class="popupText">'+getLabel("js-cms-eip-edit_in_place-saved_count_modify",c.save.count)+'</div>\n							<div class="eip_buttons">\n								<input type="button" class="primary ok hidden" value="OK" />\n								<div style="clear: both;" />\n							</div>\n						</div>\n					'}).find("#popupLayer_SaveProgress");jQuery("input:button",c.progress).click(function(){jQuery.closePopupLayer("SaveProgress")});c.save("add")}return false};a.prototype.queue.save.add={};a.prototype.queue.save.added={};a.prototype.queue.save.move={};a.prototype.queue.save.edit={};a.prototype.queue.save.del={};a.prototype.queue.save.custom={};a.prototype.queue.save.count=0;a.prototype.queue.current=-1;a.prototype.enabled=false;a.prototype.previousEditBox=null;a.prototype.editNodes=[];a.prototype.listNodes=[];a.prototype.meta={};return b(a,this)});uAdmin(".ieditor",function(s){var t={backend_request_url:"/udata://content/ieditor/",backend_request_method:"POST",image_data_url:"/admin/content/getImageData.json",image_data_request_method:"POST",coockie_name:"eip_ieditor_state",preloader_src:"/images/cms/eip/loader.gif",preloader_holder_css_class:"eip-ieditor-preloader",collection:{editor_id_attribute:"data-ieditor-id"},editor:{menu_wrapper_css_class:"eip-ieditor-menu-wrapper",img_wrapper_css_class:"eip-ieditor-img-wrapper",animation_speed:100},layout:{extended:{css_class:"eip-ieditor-layout-extended",right_margin:"5px",bottom_margin:"5px"},simple:{css_class:"eip-ieditor-layout-simple",right_margin:"5px",bottom_margin:"5px"},bubble:{css_class:"eip-ieditor-layout-bubble",arrow_css_class:"eip-ieditor-layout-bubble-arrow",bottom_margin:-50,bottom_margin_delta:0},big_img_min_width:300,big_img_min_height:350,small_img_max_width:150,small_img_max_height:150},module:{module_css_class:"eip-ieditor-module",icon_holder_css_class:"eip-ieditor-module-icon",title_holder_css_class:"eip-ieditor-module-title",upload_module:{url:"/udata/content/ieditor/upload.json",iframe_name:"eip-ieditor-upload-iframe",file_input_name:"eip-ieditor-upload-fileinput[]",css_class:"eip-ieditor-module-upload"},filemanager_module:{css_class:"eip-ieditor-module-filemanager"},edit_module:{css_class:"eip-ieditor-module-edit"},crop_module:{css_class:"eip-ieditor-module-crop"},resize_module:{css_class:"eip-ieditor-module-resize"},rotate_module:{css_class:"eip-ieditor-module-rotate"},popup_module:{css_class:"eip-ieditor-module-popup",fancybox_css_class:"fancybox-group",wrapper_css_class:"eip-ieditor-module-popup-wrapper",thumb_width:100},delete_module:{css_class:"eip-ieditor-module-delete"},apply_module:{css_class:"eip-ieditor-module-apply"},cancel_module:{css_class:"eip-ieditor-module-cancel"}},img_area_select:{css_class:"eip-ieditor-imgareaselect-wrapper",plugin_options:{parent:null,hide:true,handles:true,instance:true,keys:true,movable:true,persistent:true,resizeMargin:10,zIndex:100001}},filemanager:{url:"/styles/common/other/elfinder/umifilebrowser.html?lang=ru",window_width:660,window_height:530},browser_modules:{msie:[v,p,r,b,d,h,n,a],mozilla:[v,p,j,r,b,c,x,d,h,n,a],opera:[v,p,j,r,b,c,x,d,h,n,a],webkit:[v,p,j,r,b,c,x,d,h,n,a]}};uAdmin.inherit=function(A,z){var B=function(){};B.prototype=z.prototype;A.prototype=new B();A.prototype.constructor=A;A.superclass=z.prototype};var g=function(){if(!uAdmin||!uAdmin.eip){throw"Edit-in-place is not initialized"}this.COOKIE_NAME=t.coockie_name;this.COOKIE_ENABLED_VALUE="enabled";this.COOKIE_DISABLED_VALUE="disabled";this.jqToggleButton=null;this.bEnabled=true;this.skipDeactivateClick=false;var z=this;uAdmin.eip.bind("Enable",function(A){if(A=="after"){z.addPanelButton()}});uAdmin.eip.bind("Disable",function(A){if(A=="after"){z.removePanelButton();z.disable()}});uAdmin.eip.bind("ActiveEditorCommit",function(A){if(A=="before"&&uAdmin.eip.editor.info.field_type=="wysiwyg"&&uAdmin.eip.editor.info.old_value&&uAdmin.eip.editor.info.new_value){uAdmin.eip.editor.info.old_value=uAdmin.eip.editor.info.old_value.replace(/\sdata-ieditor-id=["']{1}[0-9\._]+["']{1}/gi,"");uAdmin.eip.editor.info.new_value=uAdmin.eip.editor.info.new_value.replace(/\sdata-ieditor-id=["']{1}[0-9\._]+["']{1}/gi,"");uAdmin.eip.editor.info.old_value=uAdmin.eip.editor.info.old_value.replace(/(src=".*)\?[0-9]+/gi,"$1");uAdmin.eip.editor.info.new_value=uAdmin.eip.editor.info.new_value.replace(/(src=".*)\?[0-9]+/gi,"$1")}else{uAdmin.eip.normalizeBoxes()}});uAdmin.eip.bind("AddPhotoToAlbum",function(D,B){if(D=="after"&&B&&B.newNode&&B.newNode.length){var C=y.getInstance().EDITOR_ID_ATTRIBUTE;B.newNode.find("img["+C+"]").addBack().removeAttr(C);if(!uAdmin.ieditor.isEnabled()){return}var E=B.newNode.find("img")[0],A=jQuery(E),F=y.getInstance().initEditor(E);if(F instanceof o){A.on("load",function(){F.init(A,A.attr(C));F.setEditMode()})}}});uAdmin.onLoad("wysiwyg",function(){tinymce.on("AddEditor",function(A){A.editor.on("SetAttrib",function(C){jQuery(C.attrElm).on("load",function(D){if(!uAdmin.ieditor.isEnabled()){return}var E=y.getInstance().initEditor(this);if(E.getEditState()){return}E.destroy(true);E.setEditState(true);E.init(jQuery(this),jQuery(this).attr(y.getInstance().EDITOR_ID_ATTRIBUTE));window.setTimeout(function(){tinymce.activeEditor.selection.collapse()},0)})});A.editor.on("init",function(C){var D=this.dom.select("img:not(.mce-object)");if(uAdmin.ieditor.isEnabled()&&D&&D.length){uAdmin.ieditor.enable(D)}});var B=A.editor.windowManager.open;A.editor.windowManager.open=function(){uAdmin.ieditor.disable();var D=B.apply(this,arguments);D.on("close",function C(){setTimeout(function(){uAdmin.ieditor.enable()},500)});return D}})});jQuery("body").on("click",function(B){if((jQuery(B.target).closest("."+t.collection.editor_id_attribute+", ."+t.img_area_select.css_class).length)||(jQuery(B.target).is(".mce-resizehandle, img"))){return}var C=y.getInstance().getActiveEditor();if((C instanceof o===false)||(uAdmin.ieditor.skipDeactivateClick)){return}var A=C.getEnabledModule();A.cancel();A.deactivate();C.setEditState(false);C.hide();C.switchOn();C.redrawMenu();C.drawDeleteButton()});if(uAdmin.eip.enabled){this.addPanelButton()}};g.prototype.isEnabled=function(){return this.bEnabled};g.prototype.getNodes=g.getNodes=function(z){jqNodes=jQuery("img[umi\\:field-name], .mceEditor img, [umi\\:field-type='wysiwyg'] img, img[umi\\:slider-id]");return z?jqNodes:jqNodes.toArray()};g.prototype.enable=function(C){if(!uAdmin.eip.enabled){return}if(!C){C=this.getNodes()}var z=y.getInstance(),B=z.getActiveEditor();for(var A=0;A<C.length;A++){if(z.getEditorByNode(C[A])){if(!B||B.jqImgNode[0]!==C[A]){z.getEditorByNode(C[A]).destroy();z.initEditor(C[A])}}else{z.initEditor(C[A])}}this.removeEipDeleteButtons();this.bEnabled=true;this.jqToggleButton.addClass("act")};g.prototype.disable=function(){if(!this.isEnabled()){return}var z=y.getInstance().getActiveEditor();if(z instanceof o){z.getEnabledModule()&&z.getEnabledModule().cancel()}y.getInstance().removeAllEditors();y.getInstance().turnOffEditMode();this.addEipDeleteButtons();this.bEnabled=false;this.jqToggleButton.removeClass("act")};g.prototype.reinit=function(){y.getInstance().reinitActiveEditors()};g.prototype.setSettings=function(A){var z=function(C,D){for(var B in C){if(!C.hasOwnProperty(B)||!D.hasOwnProperty(B)){continue}if(typeof C[B]==="object"&&C[B] instanceof Object){z(C[B],D[B])}else{D[B]=C[B]}}};z(A,t);y.getInstance().reinitActiveEditors()};g.prototype.getEditorsCollection=function(){return y.getInstance()};g.prototype.removeEipDeleteButtons=function(){this.jqEipDeleteButtonsNodes=this.getNodes(true);if(!this.jqEipDeleteButtonsNodes.length){return}var z=this.jqEipDeleteButtonsNodes.parents("[umi\\:delete]").filter(function(A,B){return !!jQuery(this).parents("[umi\\:module='photoalbum']").length});this.jqEipDeleteButtonsNodes=this.jqEipDeleteButtonsNodes.filter("[umi\\:delete]").add(z);this.jqEipDeleteButtonsNodes.removeAttr("umi:delete");uAdmin.eip.dropDeleteButtons()};g.prototype.addEipDeleteButtons=function(){if(!this.jqEipDeleteButtonsNodes||!this.jqEipDeleteButtonsNodes.length){return}this.jqEipDeleteButtonsNodes.attr("umi:delete","delete");uAdmin.eip.dropDeleteButtons()};g.prototype.addPanelButton=function(){var z=this;this.jqToggleButton=jQuery("<div/>");this.jqToggleButton.attr("id","ieditor-switcher").text(getLabel("js-ieditor-switcher")).appendTo(uAdmin.panel.quickpanel).on("click",function(){if(z.isEnabled()){z.disable()}else{z.enable()}z.saveStateToCockie()});jQuery('<span class="in_ico_bg">').prependTo(this.jqToggleButton);this.applyStateFromCookie()};g.prototype.removePanelButton=function(){this.jqToggleButton&&this.jqToggleButton.length&&this.jqToggleButton.remove()};g.prototype.applyStateFromCookie=function(){if(!jQuery.cookie){return}if(jQuery.cookie(this.COOKIE_NAME)==this.COOKIE_ENABLED_VALUE){this.enable()}else{if(jQuery.cookie(this.COOKIE_NAME)==this.COOKIE_DISABLED_VALUE){this.disable()}else{this.enable()}}};g.prototype.saveStateToCockie=function(){if(!jQuery.cookie){return}var A=this.isEnabled()?this.COOKIE_ENABLED_VALUE:this.COOKIE_DISABLED_VALUE,z=new Date();z.setTime(z.getTime()+(3*24*60*60*1000));jQuery.cookie(this.COOKIE_NAME,A,{path:"/",expires:z})};var e=function(){this.oEventHandlers={}};e.prototype.bindEvent=function(z,A){if(typeof A!="function"){return false}if(!this.oEventHandlers[z]){this.oEventHandlers[z]=[]}this.oEventHandlers[z].push({context:this,handler:A});return true};e.prototype.triggerEvent=function(C,z){var B=this._getHandlersForObjectEvent(C,this);if(!B||!B.length){return false}for(var A=0;A<B.length;A++){B[A].apply(this,z)}return true};e.prototype._getHandlersForObjectEvent=function(D,B){var z=this.oEventHandlers[D];if(!z){return[]}var C=[];for(var A in z){if(z.hasOwnProperty(A)&&z[A].context===B&&typeof z[A].handler=="function"){C.push(z[A].handler)}}return C};var y=function(){this.settings=t;this.EDITOR_ID_ATTRIBUTE=t.collection.editor_id_attribute;this.BIG_IMG_MIN_WIDTH=t.collection.big_img_min_width;this.BIG_IMG_MIN_HEIGHT=t.collection.big_img_min_height;this.SMALL_IMG_MAX_WIDTH=t.collection.small_img_max_width;this.SMALL_IMG_MAX_HEIGHT=t.collection.small_img_max_height;this._arEditors={};this.oActiveEditor=null;this.bEditMode=false;jQuery("body").on("mouseenter","img",function(B){if(!uAdmin.eip.enabled||!uAdmin.ieditor.isEnabled()){return false}if(y.getInstance().isInEditState()){return false}var z=jQuery(this),A=y.getInstance().EDITOR_ID_ATTRIBUTE;if(!z.attr(A)){return false}var C=y.getInstance().initEditor(this);C.init(z,z.attr(A));C.show();window.setTimeout(function(){if(!C.isImageInFocus()){C.hide(function(){C.destroy(true)})}},100);return true}).on("mousemove",function(z){window.mouseX=z.pageX||z.clientX+jQuery(document).scrollLeft();window.mouseY=z.pageY||z.clientY+jQuery(document).scrollTop()})};y._instance=null;y.getInstance=function(){if(!y._instance){y._instance=new y()}return y._instance};y.cleanupHtml=function(z){return new o.cleanupHtml(z)};y.prototype.initEditor=function(B){if(y.getInstance().isInEditState()){return new u()}if(this.getEditorByNode(B)){return this.getEditorByNode(B)}var z=jQuery(B),A=this.getUniqueId();z.attr(this.EDITOR_ID_ATTRIBUTE,A);var C=new f();this._arEditors[A]=C;return C};y.prototype.reinitActiveEditors=function(){var A=[];for(var z in this._arEditors){if(!this._arEditors.hasOwnProperty(z)||this._arEditors[z] instanceof o===false){continue}A.push(this._arEditors[z].jqImgNode[0])}this.removeAllEditors();for(z=0;z<A.length;z++){this.initEditor(A[z])}};y.prototype.updateEditorsByNodes=function(z){jQuery("img",z).filter(function(){return !!jQuery(this).attr(y.getInstance().EDITOR_ID_ATTRIBUTE)}).each(function(A,B){var C=y.getInstance().initEditor(B);C.reinit()})};y.prototype.repositionActiveEditors=function(){for(var z in this._arEditors){if(!this._arEditors.hasOwnProperty(z)||this._arEditors[z] instanceof o===false){continue}if(!this._arEditors[z].jqImgNode||!this._arEditors[z].jqImgNode.length||!this._arEditors[z].jqImgNode.is(":visible")){this._arEditors[z].destroy();continue}this._arEditors[z].reinit()}};y.prototype.getEditorByNode=function(z){return this._arEditors[jQuery(z).attr(this.EDITOR_ID_ATTRIBUTE)]};y.prototype.getEditorByEditorId=function(z){return this._arEditors[z]};y.prototype.getAllEditors=function(){return this._arEditors};y.prototype.findEditors=function(C){var z=jQuery("img["+this.EDITOR_ID_ATTRIBUTE+"]",C),B=[],A=this;z.each(function(D,E){B.push(A.getEditorByNode(E))});return B};y.prototype.removeAllEditors=function(){for(var z in this._arEditors){if(!this._arEditors.hasOwnProperty(z)){continue}this.removeEditor(z)}this.oActiveEditor=null;this._arEditors={}};y.prototype.removeEditor=function(z){this._arEditors[z].destroy();delete this._arEditors[z]};y.prototype.removeEmptyEditors=function(){var z=this.getAllEditors();for(var A in z){if(!z.hasOwnProperty(A)){continue}var B=z[A];if(B instanceof o===false){continue}if(!B.getEditorId()){continue}if(!B.jqImgNode||!B.jqImgNode.length||!B.jqImgNode.is(":visible")){this.removeEditor(B.getEditorId())}}};y.prototype.getUniqueId=function(){var z="";do{z=new Date().getTime()+"_"+Math.random()}while(z in this._arEditors);return z};y.prototype.setActiveEditor=function(z){if(this.oActiveEditor&&this.oActiveEditor.deactivateEnabledModule){if(this.oActiveEditor.deactivateEnabledModule(true)){this.oActiveEditor=z;return true}else{return false}}else{this.oActiveEditor=z;return true}};y.prototype.getActiveEditor=function(){return this.oActiveEditor};y.prototype.deactivateActiveEditor=function(){return this.setActiveEditor(null)};y.prototype.turnOnEditMode=function(){this.bEditMode=true};y.prototype.turnOffEditMode=function(){this.bEditMode=false};y.prototype.isInEditState=function(){return this.bEditMode};y.prototype.each=function(B){if(typeof B!="function"){return}for(var z=0;z<this._arEditors;z++){var A=this._arEditors[z];if(A instanceof o===false){continue}B.call(A,z,A)}};var m=function(z){m.superclass.constructor.call(this);this.CSS_CLASS_NAME="";this.ANIMATIONS_SPEED=t.editor.animation_speed;this.oEditor=z};uAdmin.inherit(m,e);m.prototype.init=function(){this.oEditor.jqMenuWrapper.addClass(this.CSS_CLASS_NAME);this.reposition()};m.prototype.remove=function(){this.oEditor.jqMenuWrapper.removeClass(this.CSS_CLASS_NAME);this.resetPosition();this.oEditor.layout=null};m.prototype.reposition=function(){};m.prototype.resetPosition=function(){var z=this.oEditor.jqMenuWrapper[0];z.style.top="";z.style.bottom="";z.style.left="";z.style.right=""};m.prototype.show=function(){var z=this;this.oEditor.jqMenuWrapper.stop(true,true).fadeIn(this.ANIMATIONS_SPEED,function(){z.oEditor.triggerEvent("onShow")})};m.prototype.hide=function(A){var z=this;this.oEditor.jqMenuWrapper.add().stop(true,true).fadeOut(this.ANIMATIONS_SPEED,function(){if(typeof A=="function"){A()}z.oEditor.triggerEvent("onHide")})};var k=function(z){k.superclass.constructor.call(this,z);this.CSS_CLASS_NAME=t.layout.extended.css_class;this.init()};uAdmin.inherit(k,m);k.prototype.reposition=function(){this.oEditor.jqMenuWrapper.css({right:t.layout.extended.right_margin,bottom:t.layout.extended.bottom_margin})};var w=function(z){w.superclass.constructor.call(this,z);this.CSS_CLASS_NAME=t.layout.simple.css_class;this.init()};uAdmin.inherit(w,m);w.prototype.reposition=function(){this.oEditor.jqMenuWrapper.css({right:t.layout.simple.right_margin,bottom:t.layout.simple.bottom_margin})};var q=function(z){q.superclass.constructor.call(this,z);this.CSS_CLASS_NAME=t.layout.bubble.css_class;this.BUBBLE_ARROW_CSS_CLASS=t.layout.bubble.arrow_css_class;this.init()};uAdmin.inherit(q,m);q.prototype.init=function(){q.superclass.init.call(this);this.oEditor.jqMenuWrapper.prepend("<div class='"+this.BUBBLE_ARROW_CSS_CLASS+"'/>")};q.prototype.remove=function(){this.oEditor.jqMenuWrapper.find("."+this.BUBBLE_ARROW_CSS_CLASS).remove();q.superclass.remove.call(this)};q.prototype.reposition=function(){var z=this.oEditor.jqMenuWrapper.clone().css("left",-10000).appendTo("body").show();var A=(this.oEditor.jqImgWrapper.outerWidth()-z.outerWidth())/2;z.remove();this.oEditor.jqMenuWrapper.css({left:A+"px",bottom:t.layout.bubble.bottom_margin-t.layout.bubble.bottom_margin_delta+"px"})};q.prototype.show=function(){var z=this;this.oEditor.jqMenuWrapper.stop(true,true).fadeIn(this.ANIMATIONS_SPEED).animate({bottom:t.layout.bubble.bottom_margin+"px"},this.ANIMATIONS_SPEED,function(){z.oEditor.triggerEvent("onShow")})};q.prototype.hide=function(A){var z=this;this.oEditor.jqMenuWrapper.stop(true,true).animate({bottom:t.layout.bubble.bottom_margin-t.layout.bubble.bottom_margin_delta+"px"},this.ANIMATIONS_SPEED).fadeOut(this.ANIMATIONS_SPEED,function(){if(typeof A=="function"){A()}z.oEditor.triggerEvent("onHide")})};var o=function(){o.superclass.constructor.call(this);this.MENU_WRAPPER_CLASS_NAME=t.editor.menu_wrapper_css_class;this.IMG_WRAPPER_CLASS_NAME=t.editor.img_wrapper_css_class;this.ANIMATIONS_SPEED=t.editor.animation_speed;this.IMAGE_TYPE_UNKNOWN=0;this.IMAGE_TYPE_EIP=1;this.IMAGE_TYPE_WYSIWYG=2;this.IMAGE_TYPE_PHOTOALBUM=3;this.IMAGE_TYPE_SLIDER=4;this._imageUrl="";this.sEditorId="";this.layout="";this.jqImgNode=null;this.jqMenuWrapper=null;this.jqDeleteButton=null;this.jqCloseButton=null;this.jqImgWrapper=null;this.jqPreloader=null;this.iImageType=this.IMAGE_TYPE_UNKNOWN;this.bEditStateEnabled=false;this.arModulesSet=[];this.arDefaultModules=[r,j,v,p];this.arActiveModules=[];this.oEnabledModule=null;this.oEventHandlers={}};uAdmin.inherit(o,e);o.prototype.init=function(z,B){var A=this;if(!z){if(this.jqImgNode&&this.jqImgNode.length){z=this.jqImgNode}else{return false}}if(!B&&z&&z.length){B=z.attr(y.getInstance().EDITOR_ID_ATTRIBUTE)}this.sEditorId=B||z.attr(y.getInstance().EDITOR_ID_ATTRIBUTE);if(z.parents(".mceEditor").length||z.parents("[umi\\:field-type='wysiwyg']").length||z.parents(".mce-content-body").length){this.iImageType=this.IMAGE_TYPE_WYSIWYG}else{if(z.parents("[umi\\:module='photoalbum']").length){this.iImageType=this.IMAGE_TYPE_PHOTOALBUM}else{if(z.is("[umi\\:field-name]")){this.iImageType=this.IMAGE_TYPE_EIP}else{if(z.is("[umi\\:slider-id]")){this.iImageType=this.IMAGE_TYPE_SLIDER}}}}this.jqImgNode=z;this.jqImgWrapper=jQuery("<div/>").addClass(this.IMG_WRAPPER_CLASS_NAME);this.hideTimer=null;this.jqImgWrapper.attr(y.getInstance().EDITOR_ID_ATTRIBUTE,this.sEditorId).on("click",function(C){if(jQuery(C.target).parents("."+A.MENU_WRAPPER_CLASS_NAME).length){return false}A.jqImgNode.trigger("click");return false}).on("contextmenu",function(C){if(!tinymce||!tinymce.activeEditor){return true}C.preventDefault();C.target=A.jqImgNode[0];C.originalEvent.target=A.jqImgNode[0];C.currentTarget=A.jqImgNode[0];C.delegateTarget=A.jqImgNode[0];tinymce.activeEditor.selection.select(A.jqImgNode[0]);tinymce.activeEditor.dom.fire(A.jqImgNode[0],"contextmenu",C);return false}).appendTo("body");this.applyImageSizes();this.drawMenu();this.switchOn();if(this.getEditState()===true){this.setEditMode()}this.jqImgNode.on("mousemove mouseover mouseout mouseenter mouseleave",function(C){C.stopPropagation();C.stopImmediatePropagation();C.preventDefault();return false});this.triggerEvent("onInit")};o.prototype.reinit=function(){var z=y.getInstance().EDITOR_ID_ATTRIBUTE;this.jqImgNode=jQuery("img["+z+"='"+this.sEditorId+"']");this.jqImgWrapper=jQuery("."+this.IMG_WRAPPER_CLASS_NAME).filter("["+z+"='"+this.sEditorId+"']").first();if(!this.jqImgWrapper.length){return}this.jqMenuWrapper=this.jqImgWrapper.find("."+this.MENU_WRAPPER_CLASS_NAME).first();if(!this.jqImgNode.length){return}this.applyImageSizes();this.layout.reposition();this.jqImgWrapper.offset(this.jqImgNode.offset())};o.prototype.initLayout=function(){if(this.layout instanceof m){this.layout.remove()}var A=this.jqImgNode.width(),z=this.jqImgNode.height();if(A>=t.layout.big_img_min_width&&z>=t.layout.big_img_min_height){this.layout=new k(this)}else{if(A<=t.layout.small_img_max_width||z<=t.layout.small_img_max_height){this.layout=new q(this)}else{this.layout=new w(this)}}};o.prototype.drawMenu=function(z){this.jqMenuWrapper=jQuery("<div/>").addClass(this.MENU_WRAPPER_CLASS_NAME);this.initLayout();this.drawModules(z);if(!this.isStub()||this.iImageType===this.IMAGE_TYPE_PHOTOALBUM){this.drawDeleteButton()}this.reposition();this.jqMenuWrapper.appendTo(this.jqImgWrapper)};o.prototype.applyImageBoxSizes=function(A){if(!A||!A.length){A=this.jqImgNode}var z=this,B=function(C){return A.css(C)};this.jqImgWrapper.css({width:B("width"),height:B("height"),paddingTop:B("paddingTop"),paddingRight:B("paddingRight"),paddingBottom:B("paddingBottom"),paddingLeft:B("paddingLeft"),borderTop:B("borderTop"),borderRight:B("borderRight"),borderBottom:B("borderBottom"),borderLeft:B("borderLeft"),marginTop:B("marginTop"),marginRight:B("marginRight"),marginBottom:B("marginBottom"),marginLeft:B("marginLeft")})};o.prototype.applyImageSizes=function(z){if(!z||!z.length){z=this.jqImgNode}this.applyImageBoxSizes(z);this.jqImgWrapper.offset(z.offset())};o.prototype.lockImageSize=function(){this.jqImgNode.css({maxWidth:this.jqImgNode.parent().width(),maxHeight:this.jqImgNode.parent().height()})};o.prototype.redrawMenu=function(z){for(var A in this.arActiveModules){var B=this.arActiveModules[A];if(B instanceof l){B.remove()}}this.jqMenuWrapper.children().remove();this.removeCloseButton();this.drawModules(z);this.initLayout()};o.prototype.drawModules=function(z){if(this.isPopupThumb()){z=[d]}this.resetModules();if(!z){this.setDefaultModules()}else{for(var B in z){this.addModule(z[B])}}var C=this.isStub();this.arActiveModules=[];for(var B in this.arModulesSet){if(!this.arModulesSet.hasOwnProperty(B)){continue}if(C&&this.arModulesSet[B]==r){continue}if(jQuery.browser.msie&&(this.arModulesSet[B]==c||this.arModulesSet[B]==x||this.arModulesSet[B]==j)){continue}var A=new this.arModulesSet[B](this);this.arActiveModules.push(A);this.jqMenuWrapper.append(A.getView(true))}};o.prototype.drawDeleteButton=function(A){if(this.iImageType==this.IMAGE_TYPE_SLIDER){return false}if(this.jqDeleteButton&&this.jqDeleteButton.length){this.jqDeleteButton.remove()}var B=a,z=this;if(!this.checkModule(B)){return false}B=new B(this);this.jqDeleteButton=B.getView(true);this.jqDeleteButton.addClass(this.layout.CSS_CLASS_NAME);this.jqImgWrapper.append(this.jqDeleteButton);if(A){this.jqDeleteButton.show()}return true};o.prototype.removeDeleteButton=function(){if(this.iImageType==this.IMAGE_TYPE_SLIDER){return false}this.jqDeleteButton&&this.jqDeleteButton.length&&this.jqDeleteButton.remove()&&(this.jqDeleteButton=null)};o.prototype.addCloseButton=function(z){if(this.jqCloseButton&&this.jqCloseButton.length){return}this.jqCloseButton=jQuery("<span/>").html("&times;");this.jqCloseButton.css({position:"absolute",top:0,right:0,cursor:"pointer",color:"white",fontSize:"15px",lineHeight:"10px",fontWeight:"bold",padding:"3px"}).on("click",function(A){if(typeof z=="function"){z(A)}}).appendTo(this.jqMenuWrapper)};o.prototype.removeCloseButton=function(){this.jqCloseButton&&this.jqCloseButton.length&&this.jqCloseButton.remove()&&(this.jqCloseButton=null)};o.prototype.showPreloader=function(){this.jqPreloader&&this.jqPreloader.length&&this.hidePreloader();this.jqPreloader=jQuery("<div/>").addClass(t.preloader_holder_css_class).append("<img src='"+t.preloader_src+"'>").appendTo(this.jqImgWrapper);if(!this.jqImgWrapper.data("incrementedZIndex")){this.jqImgWrapper.data("incrementedZIndex",true);this.jqImgWrapper.css("zIndex",parseInt(this.jqImgWrapper.css("zIndex"))*10||999999)}this.setEditState(true);this.switchOff()};o.prototype.hidePreloader=function(){this.jqPreloader&&this.jqPreloader.length&&this.jqPreloader.remove()&&(this.jqPreloader=null);if(this.jqImgWrapper.data("incrementedZIndex")){this.jqImgWrapper.removeData();this.jqImgWrapper.css("zIndex",Math.floor(parseInt(this.jqImgWrapper.css("zIndex"))/10)||99999)}};o.prototype.reposition=function(){this.layout.reposition()};o.prototype.destroy=function(z){this.reinit();this.jqImgWrapper.remove();this.jqImgNode.off("mousemove mouseover mouseout mouseenter mouseleave");if(!z){this.jqImgNode.removeAttr(y.getInstance().EDITOR_ID_ATTRIBUTE)}this.triggerEvent("onDestroy")};o.prototype.show=function(){this.jqDeleteButton&&this.jqDeleteButton.length&&this.jqDeleteButton.show();this.layout.show()};o.prototype.hide=function(z){this.jqDeleteButton&&this.jqDeleteButton.length&&this.jqDeleteButton.hide();this.layout.hide(z)};o.prototype.switchOn=function(){var z=this;this.jqImgWrapper.css("zIndex",parseInt(this.jqImgWrapper.css("zIndex"))||99999).on("mouseenter",function(){if(z.hideTimer){clearTimeout(z.hideTimer);z.hideTimer=null}z.show();if(z.jqDeleteButton&&z.jqDeleteButton.length){z.jqDeleteButton.stop(true,true).show(z.ANIMATIONS_SPEED)}}).on("mouseleave",function(){z.hideTimer=window.setTimeout(function(){z.hideTimer=null;if(z.jqDeleteButton&&z.jqDeleteButton.length){z.jqDeleteButton.stop(true,true).hide(z.ANIMATIONS_SPEED)}z.hide(function(){z.destroy(true)})},200)})};o.prototype.switchOff=function(z){this.jqImgWrapper.off("mouseenter mouseleave");if(z){this.hide();this.jqDeleteButton.hide()}};o.prototype.checkModule=function(B){var A=B==r&&this.checkImageIsEmpty(),D=false;for(var C in t.browser_modules){if(!t.browser_modules.hasOwnProperty(C)||!jQuery.browser[C]){continue}for(var z=0;z<t.browser_modules[C].length;z++){if(t.browser_modules[C][z]===B){D=true;break}}}return typeof B==="function"&&!!B.isImageEditorModule&&!A&&D};o.prototype.addModule=function(z){if(this.checkModule(z)){this.arModulesSet.push(z);this.triggerEvent("onAddModule",[z])}};o.prototype.resetModules=function(){this.arModulesSet=[]};o.prototype.setDefaultModules=function(){this.resetModules();for(var z in this.arDefaultModules){this.addModule(this.arDefaultModules[z])}};o.prototype.isThumb=function(){return(!!this.jqImgNode.attr("src").match(/\/thumbs\//gi)||!!this.jqImgNode.attr("src").match(/\/autothumbs\//gi))};o.prototype.isPopupThumb=function(){if(typeof d=="undefined"){return false}return !!this.jqImgNode.parents("."+d.WRAPPER_CSS_CLASS).length};o.prototype.isStub=function(){var z=this.jqImgNode.attr("umi:is-stub")=="true",A=this.jqImgNode[0]&&this.jqImgNode[0].complete&&!this.jqImgNode[0].naturalWidth&&!this.jqImgNode[0].naturalHeight;return z||A};o.prototype.getImageUrl=function(){if(!this._imageUrl){if(this.iImageType===this.IMAGE_TYPE_WYSIWYG){this._imageUrl=this.jqImgNode.attr("src")}else{var B=uAdmin.eip.searchAttr(this.jqImgNode);var z=jQuery.ajax({async:false,url:"/udata/content/getImageUrl/"+B.id+"/"+B.field_name+"/.json",type:"GET"});var A=jQuery.parseJSON(z.responseText);this._imageUrl=A.result}}return this._imageUrl};o.prototype.getCurrentImageUrl=function(){return this.isThumb()?this.getImageUrl():this.jqImgNode.attr("src")};o.prototype.getEipInfo=function(z){z=z||this.jqImgNode[0];return uAdmin.eip.searchAttr(z)};o.prototype.getEipNode=function(){var z=this.getEipInfo();if(!z||!z.node){return null}return z.node};o.prototype.getEditorId=function(){return this.sEditorId};o.prototype.checkImageIsEmpty=function(){return this.jqImgNode.attr("src")==this.jqImgNode.attr("umi:empty")};o.prototype.setEnabledModule=function(z){if(!z||!z.deactivate){return false}if(!this.deactivateEnabledModule(z!=r)){return false}this.oEnabledModule=z;y.getInstance().setActiveEditor(this);return true};o.prototype.getEnabledModule=function(){return this.oEnabledModule};o.prototype.deactivateEnabledModule=function(z){if(!this.oEnabledModule||!this.oEnabledModule.deactivate){this.oEnabledModule=null;return true}if(!z){this.oEnabledModule=null;return true}this.oEnabledModule.cancel();if(this.oEnabledModule.deactivate()){this.oEnabledModule=null;return true}return false};o.prototype.cleanupHtml=function(z){return z.replace(/\sdata-ieditor-id=["']{1}[0-9\._]+["']{1}/gi,"")};o.prototype.setEditMode=function(z){if(r){var A=new r(this);A.activate(z)}};o.prototype.setEditState=function(z){z?y.getInstance().turnOnEditMode():y.getInstance().turnOffEditMode();this.bEditStateEnabled=!!z};o.prototype.getEditState=function(){return this.bEditStateEnabled};o.prototype.isImageInFocus=function(){var C=this.jqImgNode.offset().top,z=this.jqImgNode.offset().top+this.jqImgNode.height(),B=this.jqImgNode.offset().left,A=this.jqImgNode.offset().left+this.jqImgNode.width();return window.mouseX>B&&window.mouseX<A&&window.mouseY>C&&window.mouseY<z};var f=function(){f.superclass.constructor.call(this)};uAdmin.inherit(f,o);var u=function(){};u.prototype.show=function(){};u.prototype.hide=function(){};u.prototype.reposition=function(){};u.prototype.initLayout=function(){};u.prototype.init=function(){};u.prototype.reinit=function(){};u.prototype.destroy=function(){};u.prototype.switchOn=function(){};u.prototype.switchOff=function(){};u.prototype.setEditMode=function(){};u.prototype.setEditState=function(){};u.prototype.getEditState=function(){};var l=function(){l.superclass.constructor.call(this);this.MODULE_CSS_CLASS=t.module.module_css_class;this.MODULE_ICON_HOLDER_CSS_CLASS=t.module.icon_holder_css_class;this.MODULE_TITLE_HOLDER_CSS_CLASS=t.module.title_holder_css_class;this.BACKEND_REQUEST_URL=t.backend_request_url;this.BACKEND_REQUEST_METHOD=t.backend_request_method;this.title="";this.cssClass="";this.jqElement=null;this.oEditor=null};uAdmin.inherit(l,e);l.prototype.init=function(z){this.oEditor=z;this.jqElement=jQuery("<div/>");this.jqElement.addClass(this.cssClass);this.jqElement.addClass(this.MODULE_CSS_CLASS);this.jqElement.append(jQuery("<span/>"));jQuery("<span/>").addClass(this.MODULE_TITLE_HOLDER_CSS_CLASS).appendTo(this.jqElement);this.setIcon(this.MODULE_ICON_HOLDER_CSS_CLASS);this.setTitle(this.title);this.bindEvents();this.triggerEvent("onInit")};l.prototype.setIcon=function(A){var z=this.jqElement.find("span").first();z.get(0).className="";z.addClass(A)};l.prototype.setTitle=function(z){if(!z){z=this.title}this.title=z;this.jqElement.find("span").first().attr("title",z);this.jqElement.find("span").last().text(z)};l.prototype.bindEvents=function(){var z=this;this.jqElement.on("click",function(A){A.stopPropagation();A.stopImmediatePropagation();A.preventDefault();z.activate();return false})};l.prototype.getView=function(z){if(z===true){return this.jqElement}return this.jqElement[0].outerHTML};l.prototype.activate=function(){var z=this;y.getInstance().deactivateActiveEditor();this.oEditor.setEnabledModule(this);this.triggerEvent("onActivate")};l.prototype.deactivate=function(){this.triggerEvent("onDeactivate");return true};l.prototype.save=function(){this.triggerEvent("onSave")};l.prototype.cancel=function(){this.triggerEvent("onCancel")};l.prototype.remove=function(){this.jqElement.remove();this.triggerEvent("onRemove")};l.prototype.process=function(z,A){if(!z){return{result:false,error:getLabel("js-ieditor-invalid-action")}}this.oEditor.showPreloader();if(!A){A={}}A.image_url=this.oEditor.jqImgNode.attr("src");A.empty_url=this.oEditor.jqImgNode.attr("umi:empty");A.action=z;var D=uAdmin.eip.searchAttr(this.oEditor.jqImgNode[0]);if(D){A.element_id=D.id;A.field_name=D.field_name}var B=jQuery.ajax({async:false,url:this.BACKEND_REQUEST_URL+z+"/.json",type:this.BACKEND_REQUEST_METHOD,data:A});var C=jQuery.parseJSON(B.responseText);this.processResult(C);return C};l.prototype.processResult=function(z){if(!z){uAdmin.eip.message(getLabel("js-ieditor-request-failed"));this.oEditor.hidePreloader()}else{if(z.error&&typeof z.error=="string"){uAdmin.eip.message(z.error);this.oEditor.hidePreloader()}else{if(z.error&&z.error.message){uAdmin.eip.message(z.error.message);this.oEditor.hidePreloader()}else{if(z.result&&z.result.length){this.setNewImage(z.result)}else{uAdmin.eip.message(getLabel("js-ieditor-request-failed"));this.oEditor.hidePreloader()}}}}};l.prototype.addToEipQueue=function(C,B,z){var A=this.oEditor.getEipInfo(z);if(!A||!A.node){return false}if(this.oEditor.iImageType==this.oEditor.IMAGE_TYPE_WYSIWYG){A.old_value=B||A.node.innerHTML;A.new_value=C||A.node.innerHTML.replace(this.oEditor.jqImgNode.attr("src"),C);A.field_type="wysiwyg"}else{A.old_value={src:B||this.oEditor.getCurrentImageUrl()};A.new_value={src:C};A.field_type="img_file"}uAdmin.eip.queue.add(A);return true};l.prototype.getWysiwygContent=function(z){z=z||this.oEditor.getEipNode();if(!z||!z){return null}if(tinymce&&tinymce.activeEditor){return tinymce.activeEditor.getContent()}else{return z.innerHTML}};l.prototype.setNewImage=function(C,B){var z=this,A=(C||"");if(B!==false){this.oEditor.showPreloader();A+="?"+new Date().getTime()}if(this.oEditor.iImageType==this.oEditor.IMAGE_TYPE_WYSIWYG){if(d&&d.changeImage){d.changeImage(this.oEditor,!C)}if(!C){this.oEditor.jqImgNode.remove();this.oEditor.jqImgWrapper.remove()}else{this.oEditor.jqImgNode.attr("src",A);if(this.oEditor.jqImgNode.attr("data-mce-src")){this.oEditor.jqImgNode.attr("data-mce-src",A)}}}else{this.oEditor.jqImgNode.attr({src:A,"umi:is-stub":false})}this.oEditor.jqImgNode.on("load",function(){z.oEditor.hidePreloader();if(z.oEditor.jqImgNode){z.oEditor.jqImgNode.removeAttr("width").removeAttr("height").css({width:"",height:""})}z.oEditor.reinit();window.setTimeout(function(){uAdmin.eip.normalizeBoxes()},0)});this.oEditor.triggerEvent("onImageChange",{target:this,sNewSrc:C,sNewSrcNoCache:A})};l.prototype.getImageFromFilemanager=function(z){if(typeof z!="function"){return false}jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:t.filemanager.window_width,height:t.filemanager.window_height,url:t.filemanager.url,afterClose:function(A){if(A){z(A)}},success:function(){var A='<div id="watermark_wrapper"><label for="add_watermark">';A+=window.parent.getLabel("js-water-mark");A+='</label><input type="checkbox" name="add_watermark" id="add_watermark"/>';A+='<label for="remember_last_folder">';A+=window.parent.getLabel("js-remember-last-dir");A+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"';if(jQuery.cookie("remember_last_folder")!=="null"){A+='checked="checked"'}A+="/></div>";window.parent.jQuery("#popupLayer_Filemanager .popupBody").append(A)}});return true};function j(z){j.superclass.constructor.call(this);this.UPLOAD_URL=t.module.upload_module.url;this.IFRAME_NAME=t.module.upload_module.iframe_name;this.FILE_INPUT_NAME=t.module.upload_module.file_input_name;this.title=getLabel("js-ieditor-module-upload-title");if(z.iImageType==z.IMAGE_TYPE_SLIDER){this.cssClass="eip-ieditor-empty"}else{this.cssClass=t.module.upload_module.css_class}this.jqFileInput=null;this.jqForm=null;this.jqIframe=null;this.init(z)}uAdmin.inherit(j,l);j.isImageEditorModule=true;j.prototype.init=function(A){var z=this;j.superclass.init.call(this,A);this.jqElement.css({overflow:"hidden",position:"relative"});this.jqFileInput=jQuery("<input/>").attr({type:"file",name:this.FILE_INPUT_NAME,title:this.title}).css({opacity:0,cursor:"pointer"}).on("click",function(B){B.stopPropagation();B.stopImmediatePropagation();z.activate()});this.jqForm=jQuery("<form/>").attr({method:"post",action:this.UPLOAD_URL,target:this.IFRAME_NAME,enctype:"multipart/form-data"}).css({padding:0,margin:0,border:"none",position:"absolute",top:0,right:0}).appendTo(this.jqElement).append(this.jqFileInput);this.jqForm.append('<input type="hidden" name="action" value="upload">')};j.prototype.activate=function(){j.superclass.activate.call(this);this.oEditor.switchOff();var z=this;this.jqIframe=jQuery("<iframe/>").attr({name:this.IFRAME_NAME}).css({display:"none"}).appendTo("body").on("load",function(){if(!z.bImageChanged){return}z.oEditor.hidePreloader();z.oEditor.switchOn();var B=jQuery(this).contents().find("body").text();if(!B){uAdmin.eip.message(getLabel("js-ieditor-request-failed"))}else{var A=z.oEditor.jqImgNode.attr("src");z.setNewImage(B);z.oEditor.setEditMode();z.addToEipQueue(B,A)}z.cleanup()});this.jqFileInput.on("change",function(){z.oEditor.showPreloader();z.bImageChanged=true;z.jqForm.submit()});window.setTimeout(function(){z.oEditor.switchOn();if(jQuery.browser.webkit){z.oEditor.hide()}},1000)};j.prototype.cleanup=function(){this.oEditor.switchOn();this.jqIframe.remove()};function p(z){p.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-slider-title");if(z.iImageType==z.IMAGE_TYPE_SLIDER){this.cssClass="eip-ieditor-module-slider"}else{this.cssClass="eip-ieditor-empty"}this.init(z)}uAdmin.inherit(p,l);p.isImageEditorModule=true;p.prototype.activate=function(){p.superclass.activate.call(this);var z=$(this.oEditor.jqImgNode[0]);var A={slider_id:z.attr("umi:slider-id"),token:uAdmin.csrf,prefix:uAdmin.lang_prefix};$.openPopupLayer({name:"SliderEditor",title:getLabel("js-ieditor-module-slider-popup-title"),url:"/styles/common/other/slidereditor/slideEditor.html?"+$.param(A),width:710,height:700,success:function(){$("#popupLayer_SliderEditor .popupBody").css({padding:"0"});$("#popupLayer_SliderEditor iframe.umiPopupFrame").css({width:"100%"})}})};function v(z){v.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-filemanager-title");if(z.iImageType==z.IMAGE_TYPE_SLIDER){this.cssClass="eip-ieditor-empty"}else{this.cssClass=t.module.filemanager_module.css_class}this.init(z)}uAdmin.inherit(v,l);v.isImageEditorModule=true;v.prototype.activate=function(){v.superclass.activate.call(this);this.oEditor.switchOff();var z=this;this.getImageFromFilemanager(function(B){var A=z.oEditor.jqImgNode.attr("src");z.setNewImage(B[0]);z.oEditor.setEditMode();z.addToEipQueue(B[0],A)});window.setTimeout(function(){z.oEditor.switchOn();if(jQuery.browser.webkit){z.oEditor.hide()}},500)};function r(z){r.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-edit-title");if(z.iImageType==z.IMAGE_TYPE_SLIDER){this.cssClass="eip-ieditor-empty"}else{this.cssClass=t.module.edit_module.css_class}this.arEditorModules=[x,b];this.init(z)}uAdmin.inherit(r,l);r.isImageEditorModule=true;r.prototype.activate=function(A){r.superclass.activate.call(this);var z=this;if(this.oEditor.iImageType===this.oEditor.IMAGE_TYPE_WYSIWYG){if(!tinymce.activeEditor){var C=document.body.scrollTop;this.oEditor.reinit();var B=this.oEditor.jqImgNode.attr(y.getInstance().EDITOR_ID_ATTRIBUTE),D=this.oEditor.jqImgNode.attr("src"),E=window.setInterval(function(){if(!tinymce.activeEditor||!tinymce.activeEditor.initialized){return}var G=tinymce.activeEditor.dom.select('img[src="'+D+'"]')[0],F=jQuery(G),H=y.getInstance().initEditor(G);if(H instanceof o==false){return}H.destroy(true);H.setEditState(true);H.init(F,F.attr(y.getInstance().EDITOR_ID_ATTRIBUTE));window.clearInterval(E)},500);this.oEditor.jqImgNode.click();document.body.scrollTop=C;return}this.arEditorModules.push(c);this.arEditorModules.push(d)}this.oEditor.reinit();this.oEditor.hide();this.oEditor.redrawMenu(A||this.arEditorModules);this.oEditor.removeDeleteButton();this.oEditor.addCloseButton(function(F){z.oEditor.switchOn();z.oEditor.setEditState(false);z.oEditor.removeCloseButton();z.oEditor.reinit();z.oEditor.redrawMenu();z.oEditor.drawDeleteButton(true);F.preventDefault();F.stopPropagation();F.stopImmediatePropagation();return false});window.setTimeout(function(){z.oEditor.switchOff();z.oEditor.setEditState(true);z.oEditor.show()},100)};function x(z){x.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-crop-title");this.cssClass=t.module.crop_module.css_class;this.oOriginalImageData={path:"",scale:1,top:0,left:0,width:0,height:0};this.sImgAreaSelectWrapperCssClass=t.img_area_select.css_class;this.jqImgAreaSelectWrapper=null;this.imgAreaSelect=null;this.imgAreaSelectOptions=jQuery.extend({},t.img_area_select.plugin_options,{onSelectEnd:function(){var A=uAdmin.ieditor;A.skipDeactivateClick=true;window.setTimeout(function(){A.skipDeactivateClick=false},0)}});this.imgAreaSelectOptions.parent=this.jqImgAreaSelectWrapper;this.jqOriginalImage=null;this.originalRepositionHandler=null;this.init(z)}uAdmin.inherit(x,l);x.isImageEditorModule=true;x.prototype.init=function(z){x.superclass.init.call(this);this.oEditor=z};x.prototype.activate=function(){x.superclass.activate.call(this);var z=this;if(!jQuery.imgAreaSelect){return}this.originalRepositionHandler=this.oEditor.reposition;this.oEditor.reposition=function(){z.originalRepositionHandler.call(this);this.jqMenuWrapper.css({bottom:-10-this.jqMenuWrapper.height()+"px"})};this.oEditor.hide();this.oEditor.redrawMenu([h,n]);this.oEditor.removeCloseButton();this.oEditor.switchOff();this.oEditor.reposition();this.oEditor.show();this.oEditor.showPreloader();this.initOriginalImageData();this.drawOriginalImage()};x.prototype.save=function(){if(!this.imgAreaSelect){return}x.superclass.deactivate.call(this);var z=this.imgAreaSelect.getSelection();z.scale=this.oOriginalImageData.scale;z.displayWidth=this.oOriginalImageData.displayWidth;z.displayHeight=this.oOriginalImageData.displayHeight;this.oEditor.jqImgNode[0].style.width="";this.oEditor.jqImgNode[0].style.height="";this.oEditor.jqImgNode.removeAttr("data-mce-style width height");this.process("crop",z);this.cleanup()};x.prototype.cancel=function(){x.superclass.deactivate.call(this);this.cleanup()};x.prototype.cleanup=function(){this.oEditor.reposition=this.originalRepositionHandler;this.removeSelection();this.jqImgAreaSelectWrapper.remove();this.oEditor.initLayout();this.oEditor.reinit();this.oEditor.switchOn();this.oEditor.switchOff();var z=this;window.setTimeout(function(){if(z.oEditor.getEnabledModule() instanceof r===false){var A=new r(z.oEditor);A.activate()}},0)};x.prototype.initOriginalImageData=function(){if(this.oOriginalImageData&&this.oOriginalImageData.path&&this.oOriginalImageData.path!=""){return this.oOriginalImageData}var B=this.oEditor.getEipInfo();B.image_url=this.oEditor.jqImgNode.attr("src");delete B.node;var z=jQuery.ajax({async:false,url:t.image_data_url,type:t.image_data_request_method,data:B});var A=jQuery.parseJSON(z.responseText);if(A.path&&A.path!=""){delete A.method;delete A.module;this.oOriginalImageData=A;return this.oOriginalImageData}return false};x.prototype.drawOriginalImage=function(){var z=this;this.jqImgAreaSelectWrapper=jQuery("<div/>").addClass(this.sImgAreaSelectWrapperCssClass).css({display:"none",position:"absolute",top:this.oEditor.jqImgNode.css("paddingTop")||0,left:this.oEditor.jqImgNode.css("paddingLeft")||0,zIndex:100000}).offset(this.oEditor.jqImgNode.offset()).appendTo("body");this.jqOriginalImage=jQuery("<img/>").attr({src:this.oOriginalImageData.path+"?"+new Date().getMilliseconds()}).css({width:this.oOriginalImageData.naturalWidth||"",height:this.oOriginalImageData.naturalHeight||""}).appendTo(this.jqImgAreaSelectWrapper).one("load",function(){z.jqImgAreaSelectWrapper.show();z.repositionOriginalImage();z.setSelection();z.imgAreaSelect.show();z.repositionMenu();z.oEditor.hidePreloader()});this.imgAreaSelectOptions.parent=this.jqImgAreaSelectWrapper};x.prototype.repositionOriginalImage=function(){var D=0,A=0,C=0,B=0,z=1;D=this.oOriginalImageData.naturalWidth;C=this.oOriginalImageData.naturalHeight;if(this.oOriginalImageData.width){z=this.oEditor.jqImgNode.width()/this.oOriginalImageData.width}else{z=this.oEditor.jqImgNode.width()/D}this.oOriginalImageData.scale=z;A=D*z;B=C*z;this.jqOriginalImage.css({width:A,maxWidth:A,height:B,maxHeight:B});this.jqImgAreaSelectWrapper.width(A).height(B).offset({left:parseInt(this.oEditor.jqImgNode.css("paddingLeft"))+this.oEditor.jqImgNode.offset().left-(this.oOriginalImageData.left*z||0),top:parseInt(this.oEditor.jqImgNode.css("paddingTop"))+this.oEditor.jqImgNode.offset().top-(this.oOriginalImageData.top*z||0)});this.oOriginalImageData.displayWidth=this.jqOriginalImage.width();this.oOriginalImageData.displayHeight=this.jqOriginalImage.height()};x.prototype.repositionMenu=function(){if(this.jqOriginalImage.outerHeight(true)<=this.oEditor.jqImgNode.outerHeight(true)){return}this.oEditor.applyImageSizes(this.jqOriginalImage);this.oEditor.reposition()};x.prototype.setSelection=function(){this.imgAreaSelect=jQuery(this.jqOriginalImage).imgAreaSelect(this.imgAreaSelectOptions);var A=this.oOriginalImageData.left*this.oOriginalImageData.scale||0,C=this.oOriginalImageData.top*this.oOriginalImageData.scale||0,z=A+(this.oOriginalImageData.width*this.oOriginalImageData.scale||this.oEditor.jqImgNode.width()||0),B=C+(this.oOriginalImageData.height*this.oOriginalImageData.scale||this.oEditor.jqImgNode.height()||0);this.imgAreaSelect.setSelection(A,C,z,B);this.imgAreaSelect.setMode("crop")};x.prototype.removeSelection=function(){this.jqOriginalImage.imgAreaSelect({remove:true});this.imgAreaSelect=null};function c(z){c.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-resize-title");this.cssClass=t.module.resize_module.css_class;this.imgAreaSelect=null;this.imgAreaSelectOptions=jQuery.extend({},t.img_area_select.plugin_options);this.imgAreaSelectOptions.movable=false;this.imgAreaSelectOptions.parent="body";this.oInitialSize={width:0,height:0};this.init(z)}uAdmin.inherit(c,l);c.isImageEditorModule=true;c.prototype.init=function(z){c.superclass.init.call(this);this.oEditor=z;this.imgAreaSelectOptions.aspectRatio=this.oEditor.jqImgNode.width()+":"+this.oEditor.jqImgNode.height()};c.prototype.activate=function(){c.superclass.activate.call(this);var z=this;this.oInitialSize.width=this.oEditor.jqImgNode.width();this.oInitialSize.height=this.oEditor.jqImgNode.height();this.oEditor.hide();this.oEditor.redrawMenu([h,n]);this.oEditor.jqMenuWrapper.css({bottom:-15-this.oEditor.jqMenuWrapper.height()+"px"});this.oEditor.removeCloseButton();this.oEditor.switchOff();this.oEditor.show();this.setSelection();tinymce.activeEditor.on("ObjectResized",function(A){z.oEditor.applyImageSizes();z.oEditor.reposition();z.setSelection()})};c.prototype.save=function(){c.superclass.deactivate.call(this);var A={width:this.oEditor.jqImgNode.width(),height:this.oEditor.jqImgNode.height()};this.process("resize",A);this.removeSelection();var z=this;window.setTimeout(function(){z.oEditor.setEditMode()},0)};c.prototype.cancel=function(){this.cleanup();this.oEditor.jqImgNode.width("").height("").removeAttr("width height")};c.prototype.cleanup=function(){this.removeSelection();var z=this;window.setTimeout(function(){if(z.oEditor.getEditState()&&(z.oEditor.getEnabledModule() instanceof r===false)){var A=new r(z.oEditor);A.activate()}},0)};c.prototype.setSelection=function(){var z=this;this.oEditor.applyImageSizes();tinymce.activeEditor.settings.object_resizing=true;tinymce.activeEditor.selection.controlSelection.showResizeRect(this.oEditor.jqImgNode[0])};c.prototype.removeSelection=function(){if(tinymce&&tinymce.activeEditor){tinymce.activeEditor.selection.controlSelection.hideResizeRect();tinymce.activeEditor.settings.object_resizing=false}this.oEditor.applyImageSizes()};function b(z){b.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-rotate-title");this.cssClass=t.module.rotate_module.css_class;this.init(z)}uAdmin.inherit(b,l);b.isImageEditorModule=true;b.prototype.activate=function(){this.oEditor.showPreloader();b.superclass.activate.call(this);this.process("rotate");this.oEditor.jqImgNode.removeAttr("data-mce-style")};function d(z){d.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-popup-title");this.cssClass=t.module.popup_module.css_class;this.jqWrapper=null;this.bEnabled=false;this.init(z)}uAdmin.inherit(d,l);d.isImageEditorModule=true;d.FANCYBOX_CSS_CLASS=t.module.popup_module.fancybox_css_class;d.WRAPPER_CSS_CLASS=t.module.popup_module.wrapper_css_class;d.THUMB_WIDTH=t.module.popup_module.thumb_width;d.prototype.init=function(z){d.superclass.init.call(this,z);this.jqWrapper=this.oEditor.jqImgNode.parents("."+d.WRAPPER_CSS_CLASS);if(!this.jqWrapper.length){this.bEnabled=false;this.setTitle(getLabel("js-ieditor-module-popup-title"));this.jqWrapper=jQuery("<a/>").addClass(d.FANCYBOX_CSS_CLASS).addClass(d.WRAPPER_CSS_CLASS).attr("href",this.oEditor.jqImgNode.attr("src"))}else{this.bEnabled=true;this.setTitle(getLabel("js-ieditor-module-popup-title-active"))}};d.prototype.activate=function(){d.superclass.activate.call(this);if(this.bEnabled){this.turnOff()}else{this.turnOn()}this.oEditor.reinit();this.oEditor.initLayout();this.oEditor.setEditState(false);uAdmin.ieditor.disable();uAdmin.ieditor.enable()};d.prototype.turnOn=function(){var C=this.oEditor.getEipNode(),z="",B="";if(C){z=this.oEditor.cleanupHtml(C.innerHTML)}var A=this.oEditor.jqImgNode.width()/this.oEditor.jqImgNode.height();this.oEditor.jqImgNode.width(d.THUMB_WIDTH).height(Math.round(d.THUMB_WIDTH/A)).attr({width:d.THUMB_WIDTH,height:Math.round(d.THUMB_WIDTH/A)}).wrap(this.jqWrapper).removeAttr("data-mce-style");if(C){B=this.oEditor.cleanupHtml(C.innerHTML)}if(tinymce&&tinymce.activeEditor){tinymce.activeEditor.on("remove",function(){window.setTimeout(fancybox_init,100)})}uAdmin.eip.bind("Disable",function(D){if(D=="after"){window.setTimeout(fancybox_init,500)}});this.addToEipQueue(B,z);uAdmin.eip.message(getLabel("js-ieditor-module-popup-title-msg"));uAdmin.eip.normalizeBoxes();this.bEnabled=true};d.prototype.turnOff=function(){var B=this.oEditor.getEipNode(),z="",A="";if(B){z=this.oEditor.cleanupHtml(B.innerHTML)}this.jqWrapper=this.oEditor.jqImgNode.parents("."+d.WRAPPER_CSS_CLASS);this.oEditor.jqImgNode.insertAfter(this.jqWrapper);this.jqWrapper.remove();this.oEditor.jqImgNode[0].style.width="";this.oEditor.jqImgNode[0].style.height="";this.oEditor.jqImgNode.removeAttr("data-mce-style width height");if(B){A=this.oEditor.cleanupHtml(B.innerHTML)}this.addToEipQueue(A,z);uAdmin.eip.message(getLabel("js-ieditor-module-popup-title-active-msg"));uAdmin.eip.normalizeBoxes();this.bEnabled=false};d.changeImage=function(B,A){if(B instanceof o===false){return}var z=new d(B);z.init(B);if(z.bEnabled){if(A){z.jqWrapper.remove()}else{z.turnOff();z.turnOn()}}z=null};function a(z){a.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-delete-title");this.cssClass=t.module.delete_module.css_class;this.init(z)}uAdmin.inherit(a,l);a.isImageEditorModule=true;a.prototype.init=function(z){a.superclass.init.call(this,z);this.jqElement.find("."+this.MODULE_ICON_HOLDER_CSS_CLASS).html("&times;")};a.prototype.activate=function(){a.superclass.activate.call(this);var E={};switch(this.oEditor.iImageType){case this.oEditor.IMAGE_TYPE_EIP:case this.oEditor.IMAGE_TYPE_PHOTOALBUM:var D=this.oEditor.jqImgNode.attr("umi:empty"),B=this.oEditor.jqImgNode.attr("src");this.setNewImage(D,false);this.oEditor.jqImgNode.attr("umi:is-stub",true);this.oEditor.redrawMenu();this.addToEipQueue(D,B);break;case this.oEditor.IMAGE_TYPE_WYSIWYG:var z=this.oEditor.getEipNode(),A=this.getWysiwygContent(z),C="";this.setNewImage("");C=this.getWysiwygContent(z);this.addToEipQueue(C,A,z);break}y.getInstance().removeEmptyEditors();uAdmin.eip.normalizeBoxes();this.triggerEvent("onActivate")};function h(z){n.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-apply-title");this.cssClass=t.module.apply_module.css_class;this.oActiveModule=z.getEnabledModule();this.init(z)}uAdmin.inherit(h,l);h.isImageEditorModule=true;h.prototype.activate=function(){if(this.oActiveModule instanceof l){this.oActiveModule.save();this.oEditor.reinit()}};function n(z){n.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-cancel-title");this.cssClass=t.module.cancel_module.css_class;this.oActiveModule=z.getEnabledModule();this.init(z)}uAdmin.inherit(n,l);n.isImageEditorModule=true;n.prototype.activate=function(){if(this.oActiveModule instanceof l){this.oActiveModule.cancel()}};return s(g,this)});uAdmin(".editor",function(b){function a(){}a.prototype.get=function(d,c){var e=uAdmin.eip.searchAttr(d);if(e){this.info=e;this.files=c;return this.load()}return false};a.prototype.load=function(){var o=this,h,e,j,n,m,l=uAdmin.eip.queue.search(o.info);if(l){if(l.add){if(o.info.field_name=="name"){o.info.field_type="string"}else{if(jQuery(o.info.node).attr("umi:field-type")){o.info.field_type=jQuery(o.info.node).attr("umi:field-type")}else{h=jQuery.ajax({url:"/utype/"+l.type_id+".json",async:false,dataType:"json"});h=JSON.parse(h.responseText);for(n in h.type.fieldgroups.group){n=h.type.fieldgroups.group[n];for(m in n.field){m=n.field[m];if(m.name==o.info.field_name){o.info.field_type=m.type["data-type"];break}}if(o.info.field_type){break}}}}o.info.old_value=jQuery(o.info.node).attr("umi:empty");return o.draw(o.info.field_type)}o.info.old_value=l.new_value;o.info.field_type=l.field_type;o.info.params=l.params;o.info.node=l.node;if(o.info.field_type=="relation"){o.info.guide_id=l.guide_id;o.info.multiple=l.multiple;o.info["public"]=l["public"]}return o.draw(l.field_type)}var d=jQuery(o.info.node),k=d.attr("umi:field-type");if(k&&k!="relation"&&k!="symlink"){o.info.field_type=k;if(o.info.node.tagName=="IMG"){o.info.old_value={src:d.attr("src")}}else{o.info.old_value=(d.attr("umi:empty")&&d.attr("umi:empty")==d.html())?"":d.html()}return o.draw(o.info.field_type)}e={};var g=jQuery(o.info.node).attr("umi:"+o.info.type+"-id");if(!g||g.match(/^new/)){g=jQuery(o.info.node).attr("umi:clone-source-id")||jQuery(o.info.node).parents("[umi\\:"+o.info.type+"-id]").first().attr("umi:clone-source-id")||o.info.id}e[o.info.type+"-id"]=g;e["field-name"]=o.info.field_name;e.qt=new Date().getTime();jQuery.ajax({async:false,type:"POST",url:"/admin/content/editValue/load.json",dataType:"json",data:e}).done(function(p){h=p});if(h.error){uAdmin.eip.message(h.error);return false}if(h.user&&h.user.type=="guest"){uAdmin.eip.message(getLabel("error-auth-required"));uAdmin.eip.closeMessages();uAdmin.session.sessionCloseMessage(true);return false}o.info.old_value={};if(h.property.type){d.attr("umi:field-type",h.property.type)}switch(h.property.type){case"relation":for(j in h.property.item){o.info.old_value[h.property.item[j].id]=h.property.item[j].name}o.info.guide_id=h.property["guide-id"];o.info.multiple=(h.property.multiple=="multiple");o.info["public"]=(h.property["public"]=="public");break;case"symlink":for(j in h.property.page){o.info.old_value[h.property.page[j].id]={name:h.property.page[j].name,type:{module:h.property.page[j].basetype.module,method:h.property.page[j].basetype.method}}}break;default:o.info.old_value=h.property.value}if(jQuery(o.info.node).attr("umi:clone-source-id")||jQuery(o.info.node).parents("[umi\\:clone-source-id]").length){var f=["img_file","swf_file","file","video_file"],c=["string","text","wysiwyg","int","date","boolean","password","float","formula","price","counter"];if(f.indexOf(h.property.type)!==-1){o.info.old_value={src:""}}else{if(c.indexOf(h.property.type)!==-1){o.info.old_value=""}else{o.info.old_value=[]}}}o.info.field_type=h.property.type;return o.draw(h.property.type)};a.prototype.bindFinishEvent=function(){var c=this;jQuery(document).on("click",function(h){if(!uAdmin.eip.enabled){return}if(jQuery(h.target).attr("contentEditable")=="true"){return}if(jQuery(h.target).attr("class")=="eip-ui-element"){return}if(jQuery(h.target).attr("class")=="ui-datepicker"){return}if(jQuery(h.target).attr("class")=="symlink-item-delete"){return}if(jQuery(h.target).parents().addBack().hasClass("eip_win")){return true}if(jQuery(h.target).parents().addBack().hasClass("eip-ieditor-img-wrapper")){return true}if(jQuery(h.target).parents().addBack().hasClass("eip-ieditor-imgareaselect-wrapper")){return true}if(jQuery(h.target).parents().addBack().filter("#mce-modal-block").length){return true}if(jQuery(h.target).parents().addBack().filter("#popupLayerScreenLocker").length){return true}if(jQuery(h.target).parents().addBack().filter("#jGrowl").length){return true}if(jQuery(h.target).parents(".eip-ui-element, .ui-datepicker, .ui-datepicker-title, .ui-datepicker-header, .ui-datepicker-calendar").length){return}var d=jQuery(h.target).parents();for(var g=0;g<d.length;g++){var f=d[g];if(f.tagName=="TABLE"){continue}if(f.tagName=="BODY"){break}if(jQuery(f).attr("class")=="symlink-item-delete"){return}if(jQuery(f).attr("contentEditable")=="true"){return}if(jQuery(f).hasClass("mceMenu")){return true}if(jQuery(f).hasClass("mceEditor")){return true}if(jQuery(f).parents().addBack().hasClass("mceColorSplitMenu")){return true}if(jQuery(f).parents().addBack().hasClass("mceMenuItem")){return true}if(jQuery(f).parents().addBack().hasClass("mce-panel")){return true}if(jQuery(f).parents().addBack().hasClass("eip-ieditor-imgareaselect-wrapper")){return true}}c.finish(true)})};a.prototype.draw=function(d){var c=this;if(typeof c.draw[d]=="function"){return c.draw[d](c)}uAdmin.eip.message('Unknown field type "'+d+'"');return false};a.prototype.draw["boolean"]=function(d){a.prototype.YES_TEXT=getLabel("js-cms-eip-editor-yes");a.prototype.NO_TEXT=getLabel("js-cms-eip-editor-no");var c=uAdmin.eip.nodePositionInfo(d.info.node);if(typeof d.info.old_value!="boolean"){switch(d.info.old_value){case a.prototype.NO_TEXT:case"0":d.info.old_value=false;break;case a.prototype.YES_TEXT:case"1":d.info.old_value=true;break;default:d.info.old_value=!!d.info.old_value;break}}if(d.info.node.tagName=="INPUT"&&d.info.node.type=="checkbox"){setTimeout(function(){d.info.new_value=!d.info.old_value;d.info.node.checked=d.info.new_value;d.commit();d.cleanup()},300);return d}var e=document.createElement("input");e.type="checkbox";document.body.appendChild(e);jQuery(window).bind("resize.ns"+d.info.guide_id,function(){var f=uAdmin.eip.nodePositionInfo(d.info.node);jQuery(e).css({left:f.x,top:f.y})});d.finish=function(f){if(f){d.info.new_value=e.checked;jQuery(d.info.node).text(d.info.new_value?a.prototype.YES_TEXT:a.prototype.NO_TEXT);d.commit()}jQuery(e).remove();jQuery(window).unbind("resize.ns"+d.info.guide_id);d.info.node.style.visibility="visible";d.cleanup()};e.checked=!!d.info.old_value;jQuery(e).attr("class","eip-ui-element eip-ui-boolean");jQuery(e).css({position:"absolute",left:c.x,top:c.y,"z-index":1100});uAdmin.eip.applyStyles(d.info.node,e);d.info.node.style.visibility="hidden";jQuery(e).click(function(){d.finish(true)});return d};a.prototype.draw["int"]=function(c){return c.draw.text(c)};a.prototype.draw["float"]=function(c){return c.draw.text(c)};a.prototype.draw.counter=function(c){return c.draw.text(c)};a.prototype.draw.price=function(c){return c.draw.text(c)};a.prototype.draw.string=function(c){return c.draw.text(c)};a.prototype.draw.tags=function(c){return c.draw.text(c)};a.prototype.draw.color=function(d){var h=jQuery(d.info.node);h.html("");h.addClass("u-eip-editing");var g=jQuery('<input type="text" class="color_value">').appendTo(h);var e=d.info.old_value;g.val(e);if(typeof colorControl=="undefined"){jQuery('<script src="/styles/common/js/color.control.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")}var c=new colorControl(h);jQuery(document).bind("mousedown.color",function(){jQuery(document).unbind("mousedown.color");var k=h.find(event.target).length>0;var l=event.target==h.get(0);var m=jQuery("color-picker");var n=m.find(event.target).length>0;var j=event.target==m.get(0);if(!k&&!l&&!n&&!j){f()}});h.bind("hidePicker",function(){f()});function f(){var j=g.val();d.info.new_value=j;h.html(j);d.commit();h.addClass("u-eip-edit-box");h.removeClass("u-eip-editing");h.data("colorpicker",null);jQuery(".u-eip-add-button").css("display","block");uAdmin.eip.normalizeBoxes()}return d};a.prototype.draw.text=function(c,k){var f=jQuery(c.info.node),g=f.html();if(!c.info.old_value){c.info.old_value=""}if(k){c.info.old_value=c.info.old_value.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')}if(!(c.info.field_type=="wysiwyg"&&uAdmin.wysiwyg.settings.inline)){f[0].innerHTML=c.info.old_value||"&nbsp;";f.attr("contentEditable",true)}f.blur().focus();c.finish=function(l){c.finish=function(){};jQuery(document).unbind("keyup");jQuery(document).unbind("click");f.attr("contentEditable",false);jQuery(".u-eip-sortable").sortable("enable");if(l){if(!k&&c.info.field_type!="wysiwyg"){var n=f.html();if(n.match(/\s<br>$/g)){n=n.replace(/<br>$/g,"")}var m=n;n=n.replace(/<!--[\w\W\n]*?-->/mig,"");n=n.replace(/<style[^>]*>[\w\W\n]*?<\/style>/mig,"");n=n.replace(/<([^>]+)>/mg,"");n=n.replace(/(\t|\n)/gi," ");n=n.replace(/[\s]{2,}/gi," ");if(jQuery.browser.safari){n=n.replace(/\bVersion:\d+\.\d+\s+StartHTML:\d+\s+EndHTML:\d+\s+StartFragment:\d+\s+EndFragment:\d+\s*\b/gi,"")}if(n!=m){f.html(n)}}c.info.new_value=f.html();if(c.info.new_value==" "||c.info.new_value=="&nbsp;"||c.info.new_value=="<p>&nbsp;</p>"){c.info.new_value="";f.html(c.info.new_value)}if(c.info.field_type!="wysiwyg"&&c.info.field_type!="text"){c.info.new_value=jQuery.trim(c.info.new_value);if(c.info.new_value.substr(-4,4)=="<br>"){c.info.new_value=c.info.new_value.substr(0,c.info.new_value.length-4)}}else{c.info.new_value=c.info.new_value.replace(/%[A-z0-9_]+(?:%20)+[A-z0-9_]+%28[A-z0-9%]*%29%/gi,unescape)}switch(c.info.field_type){case"int":case"float":case"price":case"counter":c.info.new_value=parseFloat(c.info.new_value);break}c.commit()}else{f.html(g)}c.cleanup()};c.bindFinishEvent();var e=f.width(),j=f.height(),h=null;jQuery(".u-eip-sortable").sortable("disable");f.focus();var d=null;jQuery(document).bind("keyup",function(l){if(e!=f.width()||j!=f.height()){e=f.width();j=f.height();if(h){clearTimeout(h)}h=setTimeout(function(){uAdmin.eip.normalizeBoxes();h=null},1000)}if(l.keyCode==46){if(d==f.html().length){if(d==1){f.html("")}}}}).bind("keydown",function(l){if(l.keyCode==46){d=f.html().length}if(l.keyCode==13&&c.info.field_type!="wysiwyg"&&c.info.field_type!="text"){c.finish(true);return false}if(l.keyCode==27){c.finish(false);return false}return true});return c};a.prototype.draw.wysiwyg=function(l){var g=jQuery(l.info.node),c=false,f=false,d=false,j=false,e=function(m){m=m.replace(/<![\s\S]*?--[ \t\n\r]*>/ig," ");m=m.replace(/<!--.*?-->/ig," ");if(jQuery.browser.mozilla){m=m.replace(/<\/?(style|font|title).*[^>]*>/ig,"")}m=m.replace(/<\/?(title|style|font|meta)\s*[^>]*>/ig,"");m=m.replace(/\s*mso-[^:]+:[^;""]+;?/ig,"");m=m.replace(/<\/?o:[^>]*\/?>/ig,"");m=m.replace(/ style=['"]?[^'"]*['"]?/ig,"");m=m.replace(/ class=['"]?[^'">]*['"]?/ig,"");m=m.replace(/<span\s*[^>]*>\s*&nbsp;\s*<\/span>/ig," ");m=m.replace(/<span\s*[^>]*>/ig,"");m=m.replace(/<\/span\s*[^>]*>/ig,"");m=m.replace(/<\/(b|i|s|u|strong|center)>[\t\n]*<\1[^>]*>/gi,"");m=m.replace(/<\/(b|i|s|u|strong|center)>\s*<\1[^>]*>/gi," ");m=m.replace(/<(b|i|s|u|strong|center)[^>]*>[\s\t\n\xC2\xA0]*<\/\1>/gi,"");m=m.replace(/(\t|\n)/gi," ");m=m.replace(/[\s]{2,}/gi," ");if(jQuery.browser.safari){m=m.replace(/\bVersion:\d+\.\d+\s+StartHTML:\d+\s+EndHTML:\d+\s+StartFragment:\d+\s+EndFragment:\d+\s*\b/gi,"")}return m};l.draw.text(l,true);jQuery(document).bind("keyup",function(n){if((n.keyCode==86||c)||(n.keyCode==45&&f)){if(!(tinymce&&tinymce.settings&&tinymce.settings.inline)){var m=e(g.html());if(m!=g.html()){g.html(m)}}if(c&&!n.ctrlKey){c=false}if(f&&!n.shiftKey){f=false}}switch(n.keyCode){case 16:if(!j){f=false}break;case 17:if(!d){c=false}break;case 45:j=false;break;case 86:d=false;break}}).bind("keydown",function(m){switch(m.keyCode){case 16:f=true;break;case 17:c=true;break;case 45:j=true;break;case 86:d=true;break}});var h=uAdmin.wysiwyg.init(l.info.node);var k=l.finish;l.finish=function(m){h.destroy();k(m);uAdmin.eip.bindEvents()};return l};a.prototype.draw.file=function(m,e){var c="./images/cms/data/",g="",d,h,f;m.finish=function(n){if(n){if(m.info.node.tagName=="IMG"){m.info.node.src=m.info.new_value.src}else{if(e){m.info.node.style.backgroundImage="url("+m.info.new_value.src+")"}else{m.info.node.innerText=m.info.new_value.src.substr(m.info.new_value.src.lastIndexOf("/")+1)}}m.commit();if(uAdmin&&uAdmin.eip&&uAdmin.eip.reinitEmptyLists){uAdmin.eip.reinitEmptyLists()}}m.cleanup()};if(m.info.old_value){if(m.info.old_value.src==undefined){m.info.old_value={src:m.info.old_value}}g=m.info.old_value.src.split(/\//g).pop();c="."+m.info.old_value.src.substr(0,m.info.old_value.src.length-g.length-1)}if(m.files&&m.files.length){d=m.files[0];d.folder=c;if(m.info.old_value){d.file=m.info.old_value.src}if(e){d.image=1}h=jQuery.ajax({url:"/admin/data/uploadfile/",async:false,data:d,type:"POST",dataType:"json"});h=JSON.parse(h.responseText);if(h.file.path){m.new_value=h.file.path;m.finish(true)}else{m.finish()}}else{f={folder:c,file:m.info.old_value?m.info.old_value.src:""};h=jQuery.ajax({url:"/admin/data/get_filemanager_info/",async:false,data:f,type:"POST",dataType:"json"});h=JSON.parse(h.responseText);var j="folder="+c;if(m.info.old_value){j+="&file="+m.info.old_value.src}if(e){j+="&image=1"}var k={flash:{height:460,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+j},elfinder:{height:530,url:"/styles/common/other/elfinder/umifilebrowser.html?"+j+"&lang="+h.lang+"&file_hash="+h.file_hash+"&folder_hash="+h.folder_hash}};jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:660,height:k[h.filemanager].height,url:k[h.filemanager].url,afterClose:function(n){if(n){if(typeof n=="object"){n=n[0]}m.info.new_value=n?{src:n.toString()}:"";m.finish(true)}else{m.finish()}}});if(h.filemanager=="elfinder"){var l='<div id="watermark_wrapper"><label for="add_watermark">';l+=getLabel("js-water-mark");l+='</label><input type="checkbox" name="add_watermark" id="add_watermark"/>';l+='<label for="remember_last_folder">';l+=getLabel("js-remember-last-dir");l+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"';if(jQuery.cookie("remember_last_folder")!=="null"){l+='checked="checked"'}l+="/></div>";jQuery("#popupLayer_Filemanager .popupBody").append(l)}}return m};a.prototype.draw.img_file=function(c){return c.draw.file(c,true)};a.prototype.draw.video_file=function(c){return c.draw.file(c)};a.prototype.draw.date=function(d){var e;if(d.info.old_value!=jQuery(d.info.node).attr("umi:empty")){e=d.info.old_value}e=moment(e,["DD-MM-YYYY hh:mm","DD-MM-YYYY","YYYY-MM-DD hh:mm","YYYY-MM-DD"]);if(!e.isValid()){e=moment()}d.info.old_value=e.format("DD-MM-YYYY");d.draw.text(d);var c=uAdmin.eip.nodePositionInfo(d.info.node);var f=jQuery("#u-datepicker-input");if(!f.length){f=document.createElement("input");f.id="u-datepicker-input";document.body.appendChild(f)}jQuery(window).bind("resize.ns"+d.info.guide_id,function(){var g=uAdmin.eip.nodePositionInfo(d.info.node);jQuery(".ui-datepicker-trigger").css({left:g.x+g.width+5,top:g.y});jQuery(f).css({left:(g.x+g.width+5),top:g.y})});d.finish=function(g){jQuery(window).unbind("resize.ns"+d.info.guide_id);jQuery(f).datepicker("destroy");jQuery(".ui-datepicker-trigger").remove();if(!d.info.new_value){d.info.new_value=jQuery(d.info.node).html()}d.cleanup();d.commit()};jQuery(f).css({position:"absolute",left:(c.x+c.width+5),top:(c.y),width:"1",height:"1",visibility:"hidden","font-size":"62.5%","z-index":560});jQuery(f).datepicker(jQuery.extend({},jQuery.datepicker.regional[uAdmin.data.lang],{showOn:"button",buttonImage:"/styles/common/other/calendar/icons_calendar_buttrefly_eip.png",buttonImageOnly:true,dateFormat:"dd-mm-yy",defaultDate:e.toDate(),onSelect:function(g){d.info.new_value=g;jQuery(d.info.node).html(g);jQuery(d.info.node).focus()}}));jQuery(d.info.node).html(d.info.old_value);uAdmin.eip.placeWith(d.info.node,jQuery(".ui-datepicker-trigger"),"right","middle");if(!d.info.id){d.info.old_value=""}jQuery(".ui-datepicker-trigger").css({left:(c.x+c.width+5),top:(c.y)});return d};a.prototype.draw.relation=function(m){jQuery(document).one("mouseup",function(){setTimeout(function(){m.bindFinishEvent()},100)});setTimeout(function(){jQuery(document).off("mouseup");m.bindFinishEvent()},1000);var f=uAdmin.eip.nodePositionInfo(m.info.node);var l=document.createElement("select");var k=document.createElement("input");document.body.appendChild(l);if(m.info.guide_id&&m.info["public"]){var g=document.createElement("input");g.type="button";g.value=" ";g.id="relationButton"+m.info.guide_id;g.className="relationAddButton";document.body.appendChild(g)}jQuery(l).attr("class","eip-ui-element");jQuery(l).css({position:"absolute",left:f.x,top:f.y,"z-index":1100});uAdmin.eip.applyStyles(m.info.node,l);jQuery(m.info.node).css("visibility","hidden");if(m.info.multiple){jQuery(l).attr("multiple","multiple");jQuery(l).attr("size",3)}for(var d in m.info.old_value){var e=document.createElement("option");jQuery(e).attr("value",d);jQuery(e).attr("selected","selected");jQuery(e).html(m.info.old_value[d]);l.appendChild(e)}jQuery(l).focus();jQuery(l).attr("name","rel_input");jQuery(l).attr("id","relationSelect"+m.info.guide_id);document.body.appendChild(k);uAdmin.eip.applyStyles(m.info.node,k);jQuery(k).attr({id:"relationInput"+m.info.guide_id,"class":"eip-ui-element",name:"rel_input_new"});if(typeof relationControl=="undefined"){jQuery('<script src="/styles/common/js/relation.control.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")}var c=new relationControl(m.info.guide_id,null,true,"/admin/data/guide_items_all/");jQuery(window).bind("resize.ns"+m.info.guide_id,function(){var n=uAdmin.eip.nodePositionInfo(m.info.node);jQuery(l).css({left:n.x,top:n.y});jQuery(k).css({left:n.x,top:(n.y+jQuery(l).height()+5)});jQuery(g).css({left:(n.x+jQuery(k).width()+5),top:(n.y+jQuery(l).height()+Math.round((jQuery(k).height()-jQuery(g).height())/2))})});m.finish=function(){var o=[];m.info.new_value=c.getValue();m.commit();for(var n in m.info.new_value){o.push(m.info.new_value[n])}m.info.node.innerHTML=o.join(", ");m.info.node.style.visibility="visible";jQuery(l).resizable();jQuery(l).resizable("destroy");jQuery(l).remove();jQuery(k).remove();jQuery(g).remove();jQuery("#u-ep-search-trigger").remove();jQuery(window).unbind("resize.ns"+m.info.guide_id);m.cleanup()};c.loadItemsAll();if(m.info.multiple){var j=jQuery(l).height(),h=350;if(j<150){j=75;jQuery(l).css("height",j)}jQuery(l).resizable({minWidth:jQuery(l).width(),maxWidth:jQuery(l).width(),minHeight:j,maxHeight:h});jQuery(".ui-wrapper").css("z-index","1100")}jQuery(k).css({position:"absolute",width:jQuery(l).width(),left:f.x,top:(f.y+jQuery(l).height()+5),"z-index":1111});jQuery(g).css({position:"absolute",left:(f.x+jQuery(k).width()+5),top:(f.y+jQuery(l).height()+Math.round((jQuery(k).height()-jQuery(g).height())/2)),"z-index":1112});return m};a.prototype.draw.symlink=function(k){jQuery(document).one("mouseup",function(){setTimeout(function(){k.bindFinishEvent()},100)});setTimeout(function(){jQuery(document).off("mouseup");k.bindFinishEvent()},1000);var d=jQuery(k.info.node).attr("umi:type")?jQuery(k.info.node).attr("umi:type").split("::"):[];var g=uAdmin.eip.nodePositionInfo(k.info.node);var j=jQuery('<div><div id="symlinkInput'+k.info.id+'" /></div>').attr({"class":"eip-ui-element"}).css({position:"absolute",left:g.x,top:g.y,"z-index":1100}).appendTo("body");var l=150,h=jQuery(k.info.node).outerWidth(),c=(h>l?h:l);jQuery("#symlinkInput"+k.info.id).width(c);if(typeof symlinkControl=="undefined"){jQuery('<script src="/styles/common/js/symlink.control.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")}var f=new symlinkControl(k.info.id,(d[0]||null),d,{inputName:k.info.field_name+"[]",fadeColorStart:[255,255,225],fadeColorEnd:[255,255,255]});if(jQuery.isEmptyObject(k.info.old_value)){f.addPlaceHolder()}for(var e in k.info.old_value){if(d.length===0){d=[k.info.old_value[e].type.module,k.info.old_value[e].type.method]}f.addItem(e,k.info.old_value[e].name,d,"")}jQuery(k.info.node).css("visibility","hidden");jQuery(window).bind("resize.ns"+k.info.guide_id,function(){var m=uAdmin.eip.nodePositionInfo(k.info.node);jQuery(j).css({left:m.x,top:m.y})});k.finish=function(){var m=jQuery('input[name="'+k.info.field_name+'[]"]'),p=[];jQuery(k.info.node).css("visibility","visible");k.info.new_value={};for(e=0;e<m.length;e++){if(m[e].value){var n=jQuery("ul li span",j)[e-1],o=jQuery(n).data("basetype").split(" ");k.info.new_value[m[e].value]={name:jQuery("ul li span",j)[e-1].innerHTML,type:{module:o[0],method:o[1]}};p.push(k.info.new_value[m[e].value].name)}}k.info.node.innerHTML=p.join(", ");k.commit();j.resizable();j.resizable("destroy");j.remove();jQuery("div.symlinkAutosuggest").remove();jQuery("#u-ep-search-trigger").remove();jQuery(window).unbind("resize.ns"+k.info.guide_id);k.cleanup()};f.loadItems();return k};a.prototype.replace=function(e,d,c){return e?this.replace[e.field_type](e,d,c):false};a.prototype.replace.img_file=function(f,q,o){var l=false,g=jQuery(f.node),m,k,j;var e=function(u,t){return u==t};var d=function(t){if(t.indexOf("/images/cms/thumbs/")>=0){return true}if(t.indexOf("/images/autothumbs/")>=0){return true}return false};var s=function(z,x,t){z=z.toString();var v=z.split(/\./g);if(v.length<2){return false}var w=v[v.length-1].toString();v=v[v.length-2].toString().split(/\//g);var u=v[v.length-1].toString();var y=z.substr(0,z.length-u.length-w.length-1);return"/images/autothumbs"+y+u+"_"+x+"_"+t+"."+w};if(f.node.tagName=="IMG"){if(e(g.attr("src"),o.src||"")){f.node.src=q.src||"";l=true}else{if(d(f.node.src)){var c=g.width();var r=g.height();var p=f.node.src;if(p.indexOf(c)!=-1&&p.indexOf(r)==-1){r="auto"}if(p.indexOf(c)==-1&&p.indexOf(r)!=-1){c="auto"}f.node.src=s(q.src,c,r);l=true}}g.one("load",function(){uAdmin.eip.normalizeBoxes()})}var n=f.node.style.backgroundImage.replace(/"/g,"");if(n.substr(0,4)!="url("){if(!l&&g.attr("childNodes")){m=g.attr("childNodes");for(j=0;j<m.length;j++){k=m.item(j);if(k&&jQuery(k).attr("tagName")){replaceImage(jQuery(k),q.src,o.src)}}}return l}n=n.substring(4,n.length-1);var h=window.location.protocol+"//"+window.location.host;if(n.substr(0,h.length)==h){n=n.substr(h.length)}if(!n){return l}if(e(n,o.src)){f.node.style.backgroundImage="url("+q.src+")";l=true}if(!l&&g.attr("childNodes")){m=g.attr("childNodes");for(j=0;j<m.length;j++){k=m.item(j);if(k&&jQuery(k).attr("tagName")){replaceImage(jQuery(k),q.src,o.src)}}}return l};a.prototype.replace.video_file=function(f,d,c){var e=function(g){return(navigator.appName.indexOf("Microsoft")!=-1)?window[g]:document[g]};e("UmiVideoPlayer").setVideoFile(d);return true};a.prototype.replace["boolean"]=function(e,d,c){if(e.node.tagName=="INPUT"&&e.node.type=="checkbox"){e.node.checked=d?true:false}else{jQuery(e.node).html(d?getLabel("js-cms-eip-editor-yes"):getLabel("js-cms-eip-editor-no"))}return true};a.prototype.replace.relation=function(g,f,c){var e=[],d;for(d in f){e.push(f[d])}jQuery(g.node).html(e.join(", "));return true};a.prototype.replace.symlink=function(g,f,c){var e="",d;for(d in f){e+="<span>"+f[d]+"</span><br />"}jQuery(g.node).html(e);return true};a.prototype.replace["int"]=function(e,d,c){return this.text(e,d,c)};a.prototype.replace["float"]=function(e,d,c){return this.text(e,d,c)};a.prototype.replace.counter=function(e,d,c){return this.text(e,d,c)};a.prototype.replace.price=function(e,d,c){return this.text(e,d,c)};a.prototype.replace.string=function(e,d,c){return jQuery(e.node).html(d)};a.prototype.replace.tags=function(e,d,c){return this.text(e,d,c)};a.prototype.replace.text=function(e,d,c){return jQuery(e.node).html(d)};a.prototype.replace.wysiwyg=function(e,d,c){return jQuery(e.node).html(d||"&nbsp;")};a.prototype.replace.file=function(e,d,c){return this.text(e,d,c)};a.prototype.replace.date=function(e,d,c){return this.text(e,d,c)};a.prototype.commit=function(){uAdmin.eip.trigger("ActiveEditorCommit","before");var d=this.info.new_value,c=this.info.old_value;if(this.info.field_type.match(/file/)){d=this.info.new_value.src;c=this.info.old_value?this.info.old_value.src:""}if(!this.equals(d,c)){jQuery(this.info.node).addClass("u-eip-modified");uAdmin.eip.queue.add(this.info)}else{if(uAdmin.eip.queue.search(this.info)){jQuery(this.info.node).addClass("u-eip-modified")}}uAdmin.eip.trigger("ActiveEditorCommit","after")};a.prototype.cleanup=function(){uAdmin.eip.bindEvents();this.finish=function(){this.cleanup()};uAdmin.eip.highlightNode(this.info.node);jQuery(".u-eip-add-button").css("display","block");uAdmin.eip.normalizeBoxes();this.info.node.blur();jQuery(this.info.node).removeClass("u-eip-editing")};a.prototype.finish=function(){this.cleanup()};a.prototype.equals=function(){var d=false,c=arguments,g=Object.prototype.toString,f,e={length:0};switch(true){case (c.length!==2):break;case (typeof c[0]!==typeof c[1]):break;case (g.call(c[0])!==g.call(c[1])):break;default:switch(typeof c[0]){case"undefined":break;case"object":if(g.call(c[0])=="[object Array]"){d=(c[0].length===c[1].length);if(d){for(f=0;f<c[0].length;f++){e[c[0][f]]=f;++e.length}for(f=0;f<c[1].length;f++){if(delete e[c[0][f]]){--e.length}}if(e.length===0){d=true}}}else{for(f in c[0]){e[f]=f;++e.length}for(f in c[1]){if(delete e[f]){--e.length}}if(e.length===0){d=true}if(d){for(f in c[0]){d=this.equals(c[0][f],c[1][f]);if(!d){break}}}}break;default:d=(c[0]===c[1])}}return d};return b(a,this)},"eip");uAdmin(".wysiwyg",function(extend){function WYSIWYG(){this.settings=jQuery.extend(this[this.type].settings,this.settings);this[this.type]();this.init=this[this.type].init}WYSIWYG.prototype.init=function(){return false};WYSIWYG.prototype.settings=function(){return false};WYSIWYG.prototype.tinymce47=function(){window.tinyMCEPreInit={suffix:".min",base:"/js/cms/wysiwyg/tinymce47"};if(!window.tinymce){$('<script src="/js/cms/wysiwyg/tinymce47/tinymce.min.js" charset="utf-8"><\/script>').appendTo("head")}if(!window.mceCustomSettings){$('<script src="/js/cms/wysiwyg/tinymce47/tinymce_custom.js" charset="utf-8"><\/script>').appendTo("head")}};WYSIWYG.prototype.tinymce47.init=function(options){if(!tinyMCE){throw"tinyMCE is not defined"}options=options||{};var editor={};var selector="textarea.wysiwyg";if(uAdmin.eip&&uAdmin.eip.editor){editor={id:"mceEditor-"+new Date().getTime(),destroy:function(){tinymce&&tinymce.activeEditor&&tinymce.activeEditor.destroy()}};selector="#"+editor.id;options.id=editor.id;options.inline=true;tinymce.on("AddEditor",function(event){event.editor.on("init",function(){this.fire("focus")})})}var settings={language:uAdmin.data["interface-lang"]||uAdmin.data.lang};$.extend(settings,this.settings,window.mceCustomSettings,options.settings||{});tinyMCE.init(settings);if(typeof options.selector==="string"){selector=options.selector}jQuery(selector).each(function(i,n){tinyMCE.execCommand("mceToggleEditor",false,n.id)});return editor};WYSIWYG.prototype.tinymce47.settings={branding:false,theme:"modern",skin:"lightgray",paste_as_text:true,extended_valid_elements:"script[src|*],style[*],map[*],area[*],umi:*[*],input[*],noindex[*],nofollow[*],iframe[frameborder|src|width|height|name|align],div[*],span[*],a[*],-p",plugins:["anchor","advlist","charmap","codemirror","contextmenu","fullscreen","image","link","lists","media","paste","searchreplace","table","textcolor","visualchars"],image_advtab:true,image_caption:true,toolbar:"paste pastetext removeformat link unlink anchor image media table charmap code blockquote formatselect fontselect fontsizeselect bold italic strikethrough alignleft aligncenter alignright alignjustify bullist numlist outdent indent forecolor backcolor subscript superscript",menubar:false,resize:true,min_height:300,codemirror:{indentOnInit:true,path:"codemirror",width:1000,height:500,config:{lineNumbers:true,lineWrapping:true,autofocus:true}},convert_urls:false,relative_urls:false,file_browser_callback:function(){uAdmin.wysiwyg.umiFileBrowserCallback.apply(uAdmin.wysiwyg,arguments)},urlconverter_callback:function(url){var umiPageLink=url.match(/^%content%20get_page_url\((\d+)\)%$/);return(umiPageLink===null)?url:"%content get_page_url("+umiPageLink[1]+")%"}};WYSIWYG.prototype.umiFileBrowserCallback=function(fieldName,url,type,win){switch(type){case"file":return uAdmin.wysiwyg.umiTreeLink(fieldName,url,type,win);case"image":case"media":var input=win.document.getElementById(fieldName);if(!input){return false}var folder="";var file="";if(input.value.length){folder=input.value.substr(0,input.value.lastIndexOf("/"));file=input.value}jQuery.ajax({url:"/admin/data/get_filemanager_info/",data:"folder="+folder+"&file="+file,dataType:"json",complete:function(data){data=jQuery.parseJSON(data.responseText);var folderHash=data.folder_hash;var fileHash=data.file_hash;var lang=data.lang;var fileManager=data.filemanager;if(fileManager==="elfinder"){return uAdmin.wysiwyg.umielfinderFileManager(fieldName,url,type,win,lang,folderHash,fileHash)}var functionName="uAdmin.wysiwyg.umi"+fileManager+"FileManager";eval(functionName+"(field_name, url, type, win, lang, folder_hash, file_hash)")}});break;default:throw"Invalid type"}return false};WYSIWYG.prototype.umielfinderFileManager=function(fieldName,url,type,win,lang,folderHash,fileHash){var query=[];query.push("id="+fieldName);switch(type){case"image":query.push("image=1");break;case"media":query.push("media=1");break}query.push("folder_hash="+folderHash);query.push("file_hash="+fileHash);query.push("lang="+lang);$.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:660,height:530,url:"/styles/common/other/elfinder/umifilebrowser.html?"+query.join("&")});var selector="#popupLayer_Filemanager .popupBody";var footerHtml='<div id="watermark_wrapper"><label for="add_watermark">'+getLabel("js-water-mark")+'</label><input type="checkbox" name="add_watermark" id="add_watermark"></div>';if(tinymce&&tinymce.activeEditor&&tinymce.activeEditor.settings.inline){jQuery(selector).append(footerHtml)}else{window.parent.jQuery(selector).append(footerHtml)}return false};WYSIWYG.prototype.umiTreeLink=function(fieldName,url,type,win){var domainFloated;var domainFloatedId;var langId;if(window.pageData){domainFloated=window.pageData.domain;domainFloatedId=window.pageData.domain_id;langId=window.pageData.lang_id}else{if(uAdmin&&uAdmin.data){domainFloated=uAdmin.data["domain-floated"];domainFloatedId=uAdmin.data["domain-id"];langId=uAdmin.data["lang-id"]}else{throw"Page data is not defined"}}var query="?domain="+domainFloated+"&domain_id="+domainFloatedId+"&lang_id="+langId;var treeLinkUrl="/js/cms/wysiwyg/tinymce47/skins/lightgray/treelink/treelink.html"+query;var pageHeight=320;if(tinyMCE.majorVersion==3){treeLinkUrl="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/themes/umi/treelink.html"+query;pageHeight=308}tinyMCE.activeEditor.windowManager.open({url:treeLinkUrl,title:getLabel("js-choose-page"),width:525,height:pageHeight,inline:true,scrollbars:false,resizable:false,maximizable:false,close_previous:false},{window:win,input:fieldName,editor_id:tinyMCE.activeEditor.id});return false};WYSIWYG.prototype.getFilemanagerFooter=function(filemanager){var footer="";if(filemanager==="elfinder"){footer='<div id="watermark_wrapper" class="ui-widget-header">';footer+='<label for="remember_last_folder">';footer+=getLabel("js-remember-last-dir");footer+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"';if(jQuery.cookie("remember_last_folder")!=="null"){footer+='checked="checked"'}footer+="/></div>"}return footer};defineDeprecatedWysiwygFunctions(WYSIWYG);return extend(WYSIWYG,this)});uAdmin.onLoad("wysiwyg",function(){uAdmin.wysiwyg.curr_mouse_position={top:0,left:0};$("body").click(function(a){uAdmin.wysiwyg.curr_mouse_position={top:a.pageY-window.pageYOffset,left:a.pageX-window.pageXOffset}})});function defineDeprecatedWysiwygFunctions(a){a.prototype.inline=function(){jQuery('<script src="/js/cms/wysiwyg/inline/inlineWYSIWYG.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")};a.prototype.inline.init=function(b){return new inlineWYSIWYG(b)};a.prototype.tinymce=function(){window.tinyMCEPreInit={suffix:"",base:"/js/cms/wysiwyg/tinymce/jscripts/tiny_mce"};jQuery('<script src="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/tiny_mce.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head");jQuery('<script src="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/tinymce_custom.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")};a.prototype.tinymce.init=function(c){var e={},b="textarea.wysiwyg",d={};if(uAdmin.eip&&uAdmin.eip.editor){e={id:"mceEditor-"+new Date().getTime(),destroy:function(){tinyMCE.execCommand("mceToggleEditor",false,e.id)}};c.id=e.id;b="#"+e.id}d.language=uAdmin.data["interface-lang"]||uAdmin.data.lang;d=jQuery.extend(this.settings,d);d=jQuery.extend(d,window.mceCustomSettings);var f=c?(c.settings||{}):{};d=jQuery.extend(d,f);tinyMCE.init(d);if(c&&typeof c.selector==="string"){b=c.selector}jQuery(b).each(function(g,h){tinyMCE.execCommand("mceToggleEditor",false,h.id)});return e};a.prototype.tinymce.settings={mode:"none",theme:"umi",width:"100%",language:typeof window.interfaceLang=="string"?interfaceLang:"ru",plugins:"safari,spellchecker,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",inlinepopups_skin:"butterfly",toolbar_standart:"fontsettings,tablesettings,|,cut,copy,paste,|,pastetext,pasteword,|,selectall,cleanup,|,undo,redo,|,link,unlink,anchor,image,media,|,charmap,code",toolbar_tables:"table,delete_table,|,col_after,col_before,row_after,row_before,|,delete_col,delete_row,|,split_cells,merge_cells,|,row_props,cell_props",toolbar_fonts:"formatselect,fontselect,fontsizeselect,|,bold,italic,underline,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,outdent,indent,|,forecolor,backcolor,|,sub,sup",theme_umi_toolbar_location:"top",theme_umi_toolbar_align:"left",theme_umi_statusbar_location:"bottom",theme_umi_resize_horizontal:false,theme_umi_resizing:true,convert_urls:false,relative_urls:false,file_browser_callback:function(g,e,f,h){if(f=="file"){var d="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/themes/umi/treelink.html"+(window.lang_id?"?lang_id="+window.lang_id:"");tinyMCE.activeEditor.windowManager.open({url:d,width:525,height:308,inline:true,scrollbars:false,resizable:false,maximizable:false,close_previous:false},{window:h,input:g,editor_id:tinyMCE.selectedInstance.editorId});return false}else{var c=h.document.getElementById(g),j={},b=[];if(!c){return false}if(c.value.length){j.folder=c.value.substr(0,c.value.lastIndexOf("/"));j.file=c.value}b.push("id="+g);switch(f){case"image":b.push("image=1");break;case"media":b.push("media=1");break}jQuery.ajax({url:"/admin/data/get_filemanager_info/",data:j,dataType:"json",success:function(l){if(l.filemanager=="flash"){if(c.value.length){b.push("folder=."+j.folder);b.push("file="+c.value)}}else{b.push("folder_hash="+l.folder_hash);b.push("file_hash="+l.file_hash);b.push("lang="+l.lang)}var k={flash:{height:460,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+b.join("&")},elfinder:{height:530,url:"/styles/common/other/elfinder/umifilebrowser.html?"+b.join("&")}};jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:660,height:k[l.filemanager].height,url:k[l.filemanager].url});if(l.filemanager=="elfinder"){var m='<div id="watermark_wrapper"><label for="add_watermark">';m+=getLabel("js-water-mark");m+='</label><input type="checkbox" name="add_watermark" id="add_watermark"/>';m+='<label for="remember_last_folder">';m+=getLabel("js-remember-last-dir");m+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"';if(getCookie("remember_last_folder",true)>0){m+='checked="checked"'}m+="/></div>";window.parent.jQuery("#popupLayer_Filemanager .popupBody").append(m)}return false}})}return false},extended_valid_elements:"script[type=text/javascript|src|languge|lang],map[*],area[*],umi:*[*],input[*],noindex[*],nofollow[*],iframe[frameborder|src|width|height|name|align]",content_css:"/css/cms/style.css"};a.prototype.tinymce_umiru=function(){window.tinyMCEPreInit={suffix:"_src",base:"/js/cms/wysiwyg/tinymce/jscripts/tiny_mce"};if(!window.tinymce){jQuery('<script src="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/tiny_mce_src.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")}};a.prototype.tinymce_umiru.init=function(e){var d,b="textarea.wysiwyg",c={};if(uAdmin.eip&&uAdmin.eip.editor){d={id:"mceEditor-"+new Date().getTime(),destroy:function(){var h=jQuery("#"+d.id),f=jQuery("#"+d.id+"_parent"),j=jQuery("iframe",f)[0],g;g=j.contentDocument.body.innerHTML;h.html(g);f.remove();h.css("display","");h[0].id=""}};e.id=d.id;b="#"+d.id}c.language=uAdmin.data["interface-lang"]||uAdmin.data.lang;c=jQuery.extend(this.settings,c);tinyMCE.init(c);jQuery(b).each(function(f,g){tinyMCE.execCommand("mceAddControl",false,g.id)});return d};a.prototype.tinymce_umiru.settings={mode:"none",theme:"umiru",language:typeof window.interfaceLang=="string"?interfaceLang:"ru",width:"100%",suffix:"_src",body_class:"text",theme_umi_resizing_use_cookie:false,init_instance_callback:"uAdmin.wysiwyg.initInstance",theme_umi_path:false,constrain_menus:false,extended_valid_elements:"script[src|*],style[*],map[*],area[*],umi:*[*],input[*],noindex[*],nofollow[*],iframe[frameborder|src|width|height|name|align],div[*],span[*],a[*]",plugins:"safari,spellchecker,pagebreak,style,layer,table,save,advhr,umiimage,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",inlinepopups_skin:"butterfly",setup:function(b){function c(e,d){jQuery(e.getContainer()).children("table.mceLayout").eq(0).css("height","auto");var f=jQuery(e.getContentAreaContainer()).children("iframe")[0];var g=f.contentWindow.document.body;iHeight=Math.max(jQuery(g).parent().outerHeight(),jQuery(g).outerHeight());f.style.height=iHeight+"px";$("img",e.getBody()).on("load",function(){c(e,d)})}b.onChange.add(c);b.onKeyDown.add(c);b.onLoadContent.add(function(k,g){if(g.content=="&nbsp;"||g.content==" "){k.setContent("")}k.focus();function j(q){if(q.nodeType==3){return q}var r=$(q).contents();for(var p=0;p<r.length;p++){var o=j(r[p]);if(o){return o}}return false}var n=k.dom.select("body");var h=j(n[0]);if(!h){if(k.dom.select("body *").length>0){h=k.dom.select("body *")[0]}else{h=n[0]}}else{h=h.parentNode}var e=k.selection.getRng();if(!e||typeof e.selectNode=="undefined"){return}var m=k.getDoc().createTextNode(".");h.insertBefore(m,h.firstChild);e.selectNode(m);e.setStartBefore(m);e.setStartAfter(m);k.selection.setRng(e);h.removeChild(m);var f=$("#"+k.editorContainer+" .toolbarHolder");var d=1110;var l=$("body").width();f.css("position","fixed");f.css("top",40);if(l>d){f.css("left",(l-d)/2)}else{f.css("left",(l-800)/2)}})},toolbar_standart:"umiimage,tablesettings,|,pastetext,pasteword,|,cleanup,|,link,unlink,|,charmap,code",toolbar_tables:"table,delete_table,|,col_after,col_before,row_after,row_before,|,delete_col,delete_row,|,split_cells,merge_cells,|,row_props,cell_props",toolbar_fonts:"formatselect,fontselect,fontsizeselect,|,bold,italic,underline,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,outdent,indent,|,forecolor,backcolor,|,sub,sup",theme_umi_toolbar_location:"top",theme_umi_toolbar_align:"left",theme_umi_statusbar_location:"bottom",theme_umi_resize_horizontal:false,theme_umi_resizing:false,convert_urls:false,relative_urls:false,file_browser_callback:"uAdmin.wysiwyg.umiFileBrowserCallback",template_external_list_url:"js/template_list.js",external_link_list_url:"",external_image_list_url:"",media_external_list_url:""};a.prototype.tinymce4=function(){window.tinyMCEPreInit={suffix:".min",base:"/js/cms/wysiwyg/tinymce4"};if(!window.tinymce){jQuery('<script src="/js/cms/wysiwyg/tinymce4/tinymce.min.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")}var b=jQuery("<div/>").addClass("toolbarHolder").css({position:"fixed",top:"40px",display:"none"}).appendTo("body");var c=function(e){if(!e||e instanceof tinymce.Editor===false){e=tinymce&&tinymce.activeEditor}if(!e){return false}var h=jQuery(document).width(),d=Math.min(h*0.9,1025),f=(h-d)/2;var g=jQuery(e.theme.panel.getEl());b.width(d).offset({left:f}).draggable().css("cursor","move");g.find(".mce-toolbar").css("display","inline-block").parent().css("white-space","normal");if(jQuery.draggable){g.draggable()}};jQuery(document).add(window).on("resize",function(d){if(tinymce&&tinymce.activeEditor){c(tinymce.activeEditor)}});tinymce.on("AddEditor",function(d){d.editor.on("ShowPanel",function(e){c(e.target);window.setTimeout(function(){jQuery(".toolbarHolder").show()},0)})})};a.prototype.tinymce4.init=function(e){var d,b="textarea.wysiwyg",c={};if(uAdmin.eip&&uAdmin.eip.editor){d={id:"mceEditor-"+new Date().getTime(),destroy:function(){tinymce&&tinymce.activeEditor&&tinymce.activeEditor.destroy()}};e.id=d.id;b="#"+d.id;c.fixed_toolbar_container=".toolbarHolder";tinymce.on("AddEditor",function(f){f.editor.on("init",function(g){this.fire("focus")})})}c.language=uAdmin.data["interface-lang"]||uAdmin.data.lang;c=jQuery.extend(this.settings,c);c=jQuery.extend(c,window.mceCustomSettings);c.selector=b;tinymce.init(c);return d};a.prototype.tinymce4.settings={inline:true,theme:"modern",skin:"darkgray",language:typeof window.interfaceLang=="string"?interfaceLang:"ru",suffix:".min",schema:"html4",paste_as_text:true,convert_urls:false,toolbar_items_size:"small",extended_valid_elements:"script[src|*],style[*],map[*],area[*],umi:*[*],input[*],noindex[*],nofollow[*],iframe[frameborder|src|width|height|name|align],div[*],span[*],a[*]",plugins:"umiimage,spellchecker,pagebreak,layer,table,save,hr,image,link,emoticons,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,template,anchor,charmap,code,textcolor",inlinepopups_skin:"butterfly",toolbar1:"image table | paste pastetext | removeformat | link unlink | charmap code",toolbar2:"formatselect fontselect fontsizeselect",toolbar3:"bold italic underline",toolbar4:"alignleft aligncenter alignright alignjustify",toolbar5:"bullist numlist outdent indent",toolbar6:"forecolor backcolor",toolbar7:"subscript superscript",block_formats:getLabel("js-wysiwyg-paragraph")+"=p;Address=address;Pre=pre;Header 1=h1;Header 2=h2;Header 3=h3;Header 4=h4;Header 5=h5;Header 6=h6",menubar:false,statusbar:false,resize:false,object_resizing:false,convert_urls:false,relative_urls:false,file_browser_callback:function(){uAdmin.wysiwyg.umiFileBrowserCallback.apply(uAdmin.wysiwyg,arguments)},template_external_list_url:"js/template_list.js",external_link_list_url:"",external_image_list_url:"",media_external_list_url:""};a.prototype.initInstance=function(l){jQuery("div.toolbarHolder").draggable();var c=jQuery(l.getElement());var m=jQuery(l.getDoc()).find("body").eq(0);var e=["font-family","font-size","font-weight","font-style","color","text-transform","text-decoration","letter-spacing","word-spacing","line-height","text-align","vertical-align","direction","background-color","background-image","background-repeat","background-position","background-attachment","opacity","top","right","bottom","left","padding-top","padding-right","padding-bottom","padding-left","overflow-x","overflow-y","white-space","clip","list-style-image","list-style-position","list-style-type","marker-offset"];for(var k in e){m.css(e[k],c.css(e[k]))}function g(){var o=-1;if(navigator.appName=="Microsoft Internet Explorer"){var j=navigator.userAgent;var n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(n.exec(j)!=null){o=parseFloat(RegExp.$1)}}return o}var h=g();if(h>-1&&h<=8){m.css("background-color","")}m.css("height","auto");var d=["margin-top","margin-right","margin-bottom","margin-left"];jQuery("#"+l.editorContainer).css("display","block");for(var f in d){jQuery("#"+l.editorContainer).css(d[f],c.css(d[f]))}l.formatter.register({fontsize:{inline:"span",styles:{fontSize:"%value","line-height":"1.3em"}}});var b=tinymce.util.Cookie;b.set("tinymcePasteText","1",new Date(new Date().getFullYear()+1,12,31))};a.prototype.umiflashFileManager=function(f,c,j,g,e,k,b){var l=g.document.getElementById(f);if(!l){return false}var h=[];h.push("id="+f);switch(j){case"image":h.push("image=1");break;case"media":h.push("media=1");break}if(l.value.length){var d=l.value.substr(0,l.value.lastIndexOf("/"));h.push("folder=."+d);h.push("file="+l.value)}$.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:660,height:460,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+h.join("&")});return false}}uAdmin(".session",function(b){function a(){var c=this;c.access=!!c.access;c.lifetime=parseInt(c.lifetime)||10;c.pingInterval=Math.min((c.lifetime*60)/2,300);c.awayTimeout=0;c.lastPingedTime=new Date();c.currentMessage=null;this.lastActionTime=new Date();(function d(){jQuery(document).bind("click keydown mousedown",null,function(e){c.eventHandler(e)});setTimeout(function(){jQuery("iframe").each(function(){try{var g=this.contentWindow||this.contentDocument;if(g.document){jQuery(g.document).bind("click keydown mousedown",function(e){c.eventHandler(e)})}}catch(f){}})},5000);c.pingIntervalHandler=setInterval(function(){c.pingHandler()},c.pingInterval*1000)})()}a.prototype.sessionAjax=function(c,d){jQuery.get("/session.php",c,function(e){if(typeof d=="function"){d(e)}})};a.prototype.login=function(c,d,e){this.sessionAjax({"u-login":c,"u-password":d,a:"ping"},function(f){if(typeof e=="function"){e(f!="-1")}})};a.prototype.check=function(){var c=this;this.sessionAjax(null,function(d){c.checkHandler(d)})};a.prototype.ping=function(d){var c=this;if(((new Date()).getTime()-c.lastPingedTime.getTime()<5000)&&!d){return}c.lastPingedTime=new Date();c.sessionAjax({a:"ping"},function(e){c.checkHandler(e)})};a.prototype.checkHandler=function(d){switch(d){case"-1":case"0":this.showCloseMessage(true);break;default:this.awayTimeout=parseInt(d,10);if(this.awayTimeout<=this.pingInterval+10){this.showWarningMessage()}else{if(!this.pingIntervalHandler){var c=this;this.pingIntervalHandler=setInterval(function(){c.pingHandler()},this.pingInterval*1000)}this.closeMessage()}break}};a.prototype.isUserActive=function(){return(new Date().getTime()-this.lastActionTime.getTime())/1000<this.pingInterval};a.prototype.eventHandler=function(c){this.lastActionTime=new Date();switch(this.currentMessage){case"warning":this.closeMessage();this.ping(true);case"close":this.ping()}};a.prototype.pingHandler=function(){if(this.isUserActive()){this.ping()}else{this.check()}};a.prototype.showWarningMessage=function(d){var c=this;if(d){clearInterval(c.timer);c.timer=null}c.currentMessage="warning";if(c.timer){return}c.timer=setInterval(function(){if(c.awayTimeout>0){var j=c.awayTimeout;var f=parseInt(j/60);var g=j%60;if(g<10){g="0"+g}var h=f+":"+g;var e=parseInt((c.lifetime*60-c.awayTimeout)/60);c.message(getLabel("js-session-is-away")+" "+e+" "+getLabel("js-minutes")+". "+getLabel("js-session-warning")+"<br/>"+h);c.awayTimeout--}else{c.closeMessage();c.check()}},1000)};a.prototype.showCloseMessage=function(e){var c=this;if(e){clearInterval(c.timer);c.timer=null}if(c.currentMessage=="close"){return}c.currentMessage="close";if(c.pingIntervalHandler){clearInterval(c.pingIntervalHandler);c.pingIntervalHandler=0}var f=jQuery("<div><br />"+getLabel("js-session-was-away")+" "+c.lifetime+" "+getLabel("js-minutes")+", "+getLabel("js-session-close")+"<br/><br/></div>");var d=jQuery('\n			<form>\n				<table cellspacing="5" width="100%">\n					<tr>\n						<td>'+getLabel("js-label-login")+': </td>\n						<td><input type="text" name="session_contorl_login" /></td>\n					</tr>\n					<tr>\n						<td>'+getLabel("js-label-password")+':</td>\n						<td><input type="password" name="session_contorl_passsword" /></td>\n					</tr>\n				</table>\n				<br/>\n				<input type="submit" value="'+getLabel("js-label-login-do")+'">\n			</form>\n		').appendTo(f);if(c.access){jQuery("<br/> <br/><a href='/admin/config/main/' target='_blank'>"+getLabel("js-session-lifetime-configure")+"</a>").appendTo(d)}d.submit(function(){var h=jQuery.trim(this.session_contorl_login.value),g=jQuery.trim(this.session_contorl_passsword.value);if(h&&g){c.login(h,g,function(j){if(j){jQuery.getJSON("/admin/config/main/.json",{},function(k){if(uAdmin.csrf&&uAdmin.csrf!=k.csrf){uAdmin.csrf=k.csrf}else{if(csrfProtection&&csrfProtection.getToken()!=k.csrf){csrfProtection.changeToken(k.csrf)}}});c.closeMessage();c.pingIntervalHandler=setInterval(function(){c.pingHandler()},c.pingInterval*1000);jQuery.jGrowl(getLabel("js-session-restored"),{header:"UMI.CMS",life:5000})}else{jQuery.jGrowl(getLabel("js-label-text-error"),{header:"UMI.CMS",life:5000})}})}else{jQuery.jGrowl(getLabel("js-label-text-error"),{header:"UMI.CMS",life:5000})}return false});c.message(f)};a.prototype.message=function(e){var c=this;if(typeof e=="string"){e="<br/><p> "+e+" </p>"}if(!c.jgrowl){c.jgrowl=-1;jQuery.jGrowl(e,{header:"UMI.CMS",dont_close:true,beforeOpen:function(f){c.jgrowl=jQuery(f)},close:function(){c.closeMessage();c.ping(true)}});return}else{if(c.jgrowl!=-1){var d=c.jgrowl.find(".jGrowl-message");if(typeof e=="string"){d.html(e)}else{d.html("");d.append(e)}}}};a.prototype.closeMessage=function(){this.currentMessage=null;if(this.timer){clearInterval(this.timer);this.timer=null}if(this.jgrowl&&this.jgrowl!=-1){this.jgrowl.mouseout();this.jgrowl.remove();this.jgrowl=null}};a.prototype.destroy=function(){if(this.pingIntervalHandler){clearInterval(this.pingIntervalHandler);this.pingIntervalHandler=0}if(this.timer){clearInterval(this.timer);this.timer=null}return true};return b(a,this)});function RGBColor(g){this.ok=false;if(g.charAt(0)=="#"){g=g.substr(1,6)}g=g.replace(/ /g,"");g=g.toLowerCase();var a={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var c in a){if(g==c){g=a[c]}}var h=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(j){return[parseInt(j[1]),parseInt(j[2]),parseInt(j[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(j){return[parseInt(j[1],16),parseInt(j[2],16),parseInt(j[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(j){return[parseInt(j[1]+j[1],16),parseInt(j[2]+j[2],16),parseInt(j[3]+j[3],16)]}}];for(var b=0;b<h.length;b++){var e=h[b].re;var d=h[b].process;var f=e.exec(g);if(f){channels=d(f);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHash=function(){return{red:this.r,green:this.g,blue:this.b}};this.inverse=function(){this.r=255-this.r;this.g=255-this.g;this.b=255-this.b};this.toHex=function(){var l=this.r.toString(16);var k=this.g.toString(16);var j=this.b.toString(16);if(l.length==1){l="0"+l}if(k.length==1){k="0"+k}if(j.length==1){j="0"+j}return"#"+l+k+j}}function relationControl(r,b,j,h){var e=this;var d=r;var v=b||r;var q=true;var y=null;var B=null;var s=null;var f=null;var C=null;var a=null;var c=null;var A=null;var t=null;var m=0;var l=0;var z=h||"/admin/data/guide_items_all/";var w=function(){y=document.getElementById("relationSelect"+v);B=document.getElementById("relationInput"+v);s=document.getElementById("relationButton"+v);if(!y){alert("Select input for field #"+v+" not found");return}jQuery("option",y).each(function(){if(!this.selected&&this.value.length!==0){q=false}});if(s){s.onclick=function(){e.addObjectToGuide(null,null,function(F,G){e.addItem(F,G)})}}if(B){B.onkeyup=function(G){var F=G?G.keyCode:event.keyCode;if(F==13&&s){e.addItem();return false}else{e.doSearch()}};B.onkeydown=function(G){var F=G?G.keyCode:event.keyCode;if(F==13){return false}}}var E=function(){if(q){e.loadItemsAll();q=false}};y.onmouseover=E;y.onfocus=E;for(var D=0;D<y.childNodes.length;D++){if(y.childNodes[D].nodeType!=1){y.removeChild(y.childNodes[D]);D=0}}if(j&&jQuery("option[value='']",y).length==0){jQuery(y).prepend("<option value=''></option>")}};this.addObjectToGuide=function(K,J,M){var G=(typeof(B)==="object"?B.value:K);var L=(parseInt(d)>0?parseInt(d):parseInt(J));var F={url:"",data:null};var H={id:0,name:""};var I=document.getElementById("relationButton"+v);var E=null;var D=null;if(typeof(G)!=="string"||G.length<=0||L<=0){return}F.url="/admin/udata://data/addObjectToGuide/.json";F.data={param0:G,param1:L};I.setAttribute("disabled","");jQuery.ajax({url:F.url,dataType:"json",data:F.data,type:"post",success:function(N){if(typeof(N.data)!=="undefined"&&typeof(N.data.object)!=="undefined"){H.id=parseInt(N.data.object.id);if(isNaN(H.id)||H.id<=0){return}H.name=N.data.object.name;if(typeof(M)==="function"){M(H.name,H.id)}I.removeAttribute("disabled");if(C){E=jQuery("option:selected",y);D=jQuery("option:last",y);E=E.detach();jQuery(D).replaceWith(E)}}},error:function(){I.removeAttribute("disabled")}})};this.rescan=function(){B=document.getElementById("relationInput"+v);if(B){B.onkeyup=function(E){var D=E?E.keyCode:event.keyCode;if(D==13&&s){e.addItem()}else{e.doSearch()}}}};this.getValue=function(){var F=jQuery("option:selected",jQuery(y));var D={};for(var E=0;E<F.length;E++){D[F[E].value]=jQuery(F[E]).text()}return D};this.loadItems=function(D){jQuery.ajax({url:z+d+".xml?limit&search[]="+encodeURIComponent(D),type:"get",complete:function(F,E){e.updateItems(F)}})};this.loadItemsAll=function(){jQuery.ajax({url:z+d+".xml?allow-empty",type:"get",complete:function(E,D){e.updateItemsAll(E)}})};this.updateItemsAll=function(E){if(E.responseXML.getElementsByTagName("empty").length){if(B){B.onkeyup=function(P){var O=P?P.keyCode:event.keyCode;switch(O){case 38:if(A.length&&(t>0||t==null)){g((t===null)?(A.length-1):(t-1))}break;case 40:if(A.length&&(t<(A.length-1)||t==null)){g((t===null)?0:(t+1))}break;case 13:k();n();break;case 27:n();break;default:clearTimeout(c);c=setTimeout(function(){e.doSearchAjax()},500)}};B.onblur=function(){if(a){if(m<parseInt(a.style.left)||m>(parseInt(a.style.left)+parseInt(a.offsetWidth))||l<parseInt(a.style.top)||l>(parseInt(a.style.top)+parseInt(a.offsetHeight))){n()}}};var K=E.responseXML.getElementsByTagName("empty")[0].getAttribute("total");if(!C){C=new Option(" ","");C.innerHTML=getLabel("js-relation-total")+K+". "+getLabel("js-relation-use_search");y.insertBefore(C,y.firstChild)}}return}var I=E.responseXML.getElementsByTagName("object");var L=[];var F=0;for(F=0;F<y.options.length;F++){if(y.options[F].selected){L.push(y.options[F].value)}}jQuery("option",y).each(function(){if(!this.selected||this.value.length===0){jQuery(this).remove()}});if(j){$(y).prepend("<option value=''> </option>")}for(F=0;F<I.length;F++){var J=I[F].getAttribute("id");var G=false;for(var M in L){if(L[M]==J){G=true;delete L[M];break}}if(!G){var N=I[F].getAttribute("name");var D=new Option(N,J);D.innerHTML=N;y.appendChild(D)}}if(jQuery.browser.msie){var H=y.style.display;y.style.display="none";y.style.display=H}};this.updateItems=function(E){t=null;A=E.responseXML.getElementsByTagName("object");if(!A.length){return}var F=null;if(!a){a=document.createElement("div");a.className="relationAutosuggest";var H=jQuery(B).offset();a.style.position="absolute";a.style.zIndex=1050;a.style.width=B.clientWidth+"px";a.style.top=(H.top+B.offsetHeight)+"px";a.style.left=H.left+"px";F=document.createElement("ul");a.appendChild(F);document.body.appendChild(a)}a.style.display="";jQuery(document).mousemove(o);F=a.firstChild;while(F.firstChild){F.removeChild(F.firstChild)}for(i=0;i<A.length;i++){var G=A[i].getAttribute("name");var D=document.createElement("li");D.innerHTML=G;D.onmouseover=function(){g(this.suggestIndex)};D.onmouseout=function(){this.className=""};D.onclick=function(){k();n()};D.suggestIndex=i;F.appendChild(D)}};var o=function(D){if(!D){m=event.clientX+document.body.scrollLeft;l=event.clientY+document.body.scrollTop}else{m=D.pageX;l=D.pageY}return true};this.addItem=function(E,D){if(!(E&&E.length)&&!(B&&B.value.length)){return}x();u();if(!y.multiple&&f&&!E&&!D){f.innerHTML=(D?"":"&rarr;&nbsp;&nbsp;")+B.value;f.value=D?D:B.value;y.selectedIndex=0}else{f=new Option(E?E:B.value,D?D:B.value);f.innerHTML=(D?"":"&rarr;&nbsp;&nbsp;")+(E?E:B.value);if(y.options.length){y.insertBefore(f,y.firstChild)}else{y.appendChild(f)}}B.value="";f.selected=true;if(jQuery.browser.msie){setTimeout(function(){f.selected=false;f.selected=true},20)}};var g=function(E){if(a.style.display!="none"){var F=a.firstChild;var D=F.childNodes.item(t);if(D){D.className=""}F.childNodes.item(E).className="active";t=E}};var k=function(){if(a&&a.style.display!="none"&&t!==null){var G=A[t].getAttribute("name");var F=A[t].getAttribute("id");var E=false;for(var D=0;D<y.options.length;D++){if(y.options[D].value==F){E=true;y.options[D].selected=true;break}}if(!E){e.addItem(G,F)}}else{if(B.value.length&&s){e.addItem()}}};var n=function(){if(a&&a.style.display!="none"){a.style.display="none";jQuery(document).unbind("mousemove",o)}};this.doSearch=function(){var G=B.value.toLowerCase();x();if(G==""){if(y.multiple){u()}return}for(var E=0;E<y.options.length;E++){var H=y.options[E].text;var F=H.replace(/^.\s\s/,"");if(H.substring(0,G.length).toLowerCase()===G||F.substring(0,G.length).toLowerCase()===G){if(y.multiple){if(y.firstChild.nodeName.toLowerCase()!="optgroup"){p();searchGroup=y.firstChild;itemsGroup=y.lastChild}var D=y.options[E];if(D.parentNode==searchGroup){continue}D.oldPrevSibling=D.previousSibling;itemsGroup.removeChild(D);searchGroup.appendChild(D);if(searchGroup.childNodes.length==5){return}}else{y.selectedIndex=E;return}}}};this.doSearchAjax=function(){if(B.value){this.loadItems(B.value)}};var p=function(){var E=document.createElement("optgroup");E.label="Search results";var D=document.createElement("optgroup");D.label="------------------------------------------------";while(y.firstChild){var F=y.firstChild;y.removeChild(F);D.appendChild(F)}y.appendChild(E);y.appendChild(D)};var u=function(){if(y.firstChild&&y.firstChild.nodeName.toLowerCase()=="optgroup"){y.removeChild(y.firstChild);var D=y.firstChild;while(D.firstChild){var E=D.firstChild;D.removeChild(E);y.appendChild(E)}y.removeChild(D)}};var x=function(){if(y.firstChild&&y.firstChild.nodeName.toLowerCase()=="optgroup"){var E=y.firstChild;var D=y.lastChild;while(E.firstChild){var F=E.firstChild;E.removeChild(F);if(F.oldPrevSibling!==undefined||F.oldPrevSibling==null){if(F.oldPrevSibling&&F.oldPrevSibling.nextSibling){D.insertBefore(F,F.oldPrevSibling.nextSibling)}else{if(F.oldPrevSibling===null){D.insertBefore(F,D.firstChild)}else{D.appendChild(F)}}F.oldPrevSibling=undefined}}}};w()}function symlinkControl(C,n,K,N,M,j){M=(M instanceof Array)?M:[M];var h=this;var B=C;var I=(K instanceof Array)?K:[K];var d=(I)?"&hierarchy_types="+I.join("-"):"";var p=(M instanceof Array)?"&hierarchy_types="+M.join(","):"";var c=n||null;var y=null;var m=null;var A=null;var v=null;var P=null;var w=null;var H=null;var E=0;var D=0;if(!N){N={}}var O=N.iconsPath||"/images/cms/admin/mac/tree/";var G=N.fadeColorStart||[255,0,0];var s=N.fadeColorEnd||[255,255,255];var q=N.inputName||("symlinkInput"+B);var t=N.noImages||false;var e=N.treeURL||"/styles/common/js/tree.html";var F=N.rootId;var J=N.popupTitle||getLabel("js-cms-eip-symlink-choose-element");var o=typeof(N.showSuggestType)==="undefined"?true:N.showSuggestType;var b=typeof(N.cutSuggestNames)==="undefined"?true:N.cutSuggestNames;var a=parseInt(N.suggestDivWidth);var l={};var u=(j?"&callback=symlinkControlsList."+B+".onlyOne":"");var L=function(){if(!window.symlinkControlsList){window.symlinkControlsList={}}window.symlinkControlsList[B]=h;y=document.getElementById("symlinkInput"+B);if(!y){alert("Symlink container #"+B+" not found");return}var R=document.createElement("input");R.type="hidden";R.name=q;y.parentNode.insertBefore(R,y);v=document.createElement("ul");y.appendChild(v);var S=document.createElement("div");y.appendChild(S);m=document.createElement("input");m.setAttribute("placeholder",getLabel("js-cms-eip-symlink-search"));S.className="pick-element";S.appendChild(m);var T=18,U=28;m.style.width=S.parentNode.offsetWidth-(T+U)+"px";m.style.minWidth=S.parentNode.offsetWidth-(T+U)+"px";A=t?document.createElement("input"):document.createElement("img");S.appendChild(A);m.type="text";if(t){A.type="button";A.value="╘"}else{A.src="/images/cms/admin/mac/tree.png";A.height="18"}A.className="treeButton";A.onclick=function(){jQuery.openPopupLayer({name:"Sitetree",title:J,width:620,height:335,url:e+"?id="+B+(c?"&module="+c:"")+p+(window.lang_id?"&lang_id="+window.lang_id:"")+(F?"&root_id="+F:"")+u})};v.className="pageslist";m.onkeypress=function(W){var V=W?W.keyCode:window.event.keyCode;if(V==13){return false}};m.onkeyup=function(W){var V=W?W.keyCode:window.event.keyCode;switch(V){case 38:if(w.length&&(H>0||H==null)){r((H===null)?(w.length-1):(H-1))}break;case 40:if(w.length&&(H<(w.length-1)||H==null)){r((H===null)?0:(H+1))}break;case 13:x();Q();return false;break;case 27:Q();break;default:h.doSearch()}};m.onblur=function(){if(P){if(E<parseInt(P.style.left)||E>(parseInt(P.style.left)+parseInt(P.offsetWidth))||D<parseInt(P.style.top)||D>(parseInt(P.style.top)+parseInt(P.offsetHeight))){Q()}}}};this.loadItems=function(R){jQuery.ajax({url:"/admin/content/load_tree_node.xml?limit&domain_id[]="+(window.domain_id?window.domain_id:"1")+d+(window.lang_id?"&lang_id="+window.lang_id:"")+(F?"&rel="+F:"")+"&search-all-text[]="+encodeURIComponent(R),type:"get",complete:function(T,S){h.updateItems(T)}})};this.onlyOne=function(S,T,R,U){jQuery.closePopupLayer("Sitetree");if(confirm(getLabel("js-island-change-symlink-warning"))){jQuery("a.button",v).click();h.addItem(S,T,U,R);jQuery('form input[name="save-mode"]:first').click()}};this.updateItems=function(T){var U=(jQuery("html.u-eip").length>0);var R=null;H=null;R=T.responseXML.getElementsByTagName("page");if(!R.length){return}w=R;var V=[];for(var W=0;W<w.length;W++){if(l[w[W].getAttribute("id")]){continue}V[V.length]=w[W]}w=V;var X=null;if(!P){P=document.createElement("div");P.className="symlinkAutosuggest";var aa=jQuery(m).offset();P.style.position="absolute";P.style.zIndex=1100;P.style.width=m.clientWidth+"px";if(!isNaN(a)){P.style.width=a+"px"}P.style.top=(aa.top+m.offsetHeight)+"px";P.style.left=aa.left+"px";if(U){P.style.backgroundColor="white";P.style.border="1px solid #ccc"}X=document.createElement("ul");P.appendChild(X);document.body.appendChild(P)}z();jQuery(document).mousemove(g);X=P.firstChild;while(X.firstChild){X.removeChild(X.firstChild)}for(W=0;W<w.length;W++){if(l[w[W].getAttribute("id")]){continue}var S=k(w[W].getElementsByTagName("name")[0]);var Y=k(w[W].getElementsByTagName("basetype")[0]);var Z=w[W].getAttribute("link");var ad=document.createElement("li");var ac=document.createElement("span");var ab=document.createElement("a");ad.title=S;if(b){if(S.length>20){S=S.substr(0,20)+"..."}}if(Z.length>55){Z=Z.substr(0,55)+"..."}ad.appendChild(document.createTextNode(S));if(o){ad.appendChild(ac)}ac.appendChild(document.createTextNode(" ("+Y+")"));if(!U){ad.appendChild(document.createElement("br"));ad.appendChild(ab);ab.appendChild(document.createTextNode(Z));ab.href=Z;ab.target="_blank"}else{ac.style.display="block";ad.className="symlink-item-delete";ad.style.padding="3px"}ad.onmouseover=function(){r(this.suggestIndex)};ad.onclick=function(){x();Q()};ad.suggestIndex=W;X.appendChild(ad)}};this.doSearch=function(){var R=m.value;h.loadItems(R)};var r=function(T){var S=(jQuery("html.u-eip").length>0);if(P.style.display!="none"){var U=P.firstChild;var R=U.childNodes.item(H);if(R){if(S){R.style.backgroundColor=""}else{R.className=""}}if(S){U.childNodes.item(T).style.backgroundColor="#ceeaf6"}else{U.childNodes.item(T).className="active"}H=T}};var x=function(){if(P&&P.style.display!="none"&&H!==null){var X=w[H].getAttribute("id");var S=k(w[H].getElementsByTagName("name")[0]);var R=w[H].getAttribute("link");var V=w[H].getElementsByTagName("basetype")[0];var U="";var T=(U=V.getAttribute("module"))?U:"";var W=(U=V.getAttribute("method"))?U:"";h.addItem(X,S,[T,W],R)}};this.addItem=function(W,T,X,U){this.delPlaceHolder();if(l[W]!==undefined){return}var Y=(jQuery("html.u-eip").length>0);var Z=document.createElement("li");var ae=document.createElement("span");var ac=document.createElement("a");var V=document.createElement("a");var ad=document.createElement("input");var aa=this;ad.type="hidden";ad.name=q;ad.value=W;V.input=ad;ac.href=U;if(t){V.appendChild(document.createTextNode("[x]"))}else{var S=document.createElement("img");S.src=O+"symlink_delete.png";S.alt="delete";if(Y){S.className="symlink-item-delete"}V.appendChild(S)}V.href="javascript:void(0);";if(Y){V.style.marginRight="5px"}else{V.className="button"}V.onclick=function(){this.input.parentNode.removeChild(this.input);v.removeChild(this.parentNode);aa.addPlaceHolder();delete l[W]};ae.dataset.basetype=X[0]+" "+X[1];if(Y){ae.style.marginLeft="5px"}ae.appendChild(document.createTextNode(T));ac.appendChild(document.createTextNode(U));if(!t){var ab=document.createElement("img");ab.src=O+"ico_"+X[0]+"_"+X[1]+".png";Z.appendChild(ab)}Z.appendChild(ae);var af=32,R=38;ae.style.maxWidth=v.parentNode.offsetWidth-(af+R)+"px";Z.appendChild(V);if(Y){delete ac}else{Z.appendChild(ac)}v.appendChild(Z);y.parentNode.insertBefore(ad,y);Z.style.backgroundColor=makeHexRgb(G);Z.startColor=G;Z.endColor=s;Z.pname=T;Z.fade=f;setTimeout(function(){Z.fade()},2000);l[W]=true;if(jQuery("#eip_page").length){frameElement.height=(jQuery("#eip_page").height()>500)?500:jQuery("#eip_page").height()}};this.delPlaceHolder=function(){if(jQuery(".eip-placeholder",v).length>=1){jQuery(".eip-placeholder",v).remove()}};this.addPlaceHolder=function(U){var R=document.createElement("li"),T=U||getLabel("js-cms-eip-symlink-no-elements"),S="eip-placeholder";R.className=S;R.appendChild(document.createTextNode(T));if(jQuery("li",v).length<1){v.appendChild(R)}};var f=function(){if(this.fadeColor==undefined){this.fadeColor=[];this.fadeColor[0]=this.startColor[0];this.fadeColor[1]=this.startColor[1];this.fadeColor[2]=this.startColor[2]}if(Math.round(this.fadeColor[0]+this.fadeColor[1]+this.fadeColor[2])==Math.round(this.endColor[0]+this.endColor[1]+this.endColor[2])){return}this.fadeColor[0]+=(this.endColor[0]-this.startColor[0])/50;this.fadeColor[1]+=(this.endColor[1]-this.startColor[1])/50;this.fadeColor[2]+=(this.endColor[2]-this.startColor[2])/50;this.style.backgroundColor=makeHexRgb(this.fadeColor);var R=this;setTimeout(function(){R.fade()},20)};var z=function(){if(P){var R=jQuery(m).offset();P.style.width=m.clientWidth;P.style.top=R.top+m.offsetHeight;P.style.left=R.left;P.style.display=""}};var Q=function(){if(P&&P.style.display!="none"){P.style.display="none";jQuery(document).unbind("mousemove",g)}};var g=function(R){if(!R){E=event.clientX+document.body.scrollLeft;D=event.clientY+document.body.scrollTop}else{E=R.pageX;D=R.pageY}return true};var k=function(R){return(R.firstChild&&R.firstChild.nodeType==3)?R.firstChild.nodeValue:R.nodeValue};L()}var hex=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function makeHexRgb(b){var a="";for(var c=0;c<3;c++){a=a+hex[Math.floor(b[c]/16)]+hex[Math.floor(b[c]%16)]}return"#"+a};